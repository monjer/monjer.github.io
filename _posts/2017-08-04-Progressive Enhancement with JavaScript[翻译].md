---
title: Progressive Enhancement with JavaScript[翻译]
date: 2017-08-04
---

如果你已经读了本系列的前两遍文章，你应该开始进入到渐进增强的状态。在本篇中我们将要讨论如何将渐进增强的哲学应用到客户端脚本中。正如你将马上看到的，所有的值包含两件事：克制和计划。

### 明智的使用你的力量

你可能已经听说过“权利腐败”这个词。这个词包含了很多，但为了我们的目的，让我们先使用这两个简单的词。JavaScript是一个非常强大的工具，长久以来它都是网络上的一种腐败的力量。它不断抛出路障，错误消息，给大多数web冲浪者以大量的弹窗。他也被严重的误解了，这导致了它的滥用，在实践中成为了一种黑暗的艺术。

JavaScript不仅弊大于利，而且变得不守规矩。在表面之下，是一个凌乱类似于老鼠窝的代码，导致了所有人尖叫不已；代码维护简直是一场噩梦，因为JavaScript代码错综复杂而且经常神秘的扩散。当时，JavaScript确实比较丑陋：浏览器没有实现像样的标准支持，开发人员忙于在HTML方面编写大量的意大利面条式的代码。JavaScript必须通过绕许多圈子来实现跨浏览器兼容性的事情，及时是想图片滚动这样简单的事情也不例外。

值得庆幸的是，我们现在在这两方面都处于一个更好的位置，最终允许我们写出更干净的JavaScript代码。然而，我们仍需要尊重它的力量，并采取负责任的行为。我们需要关系的是，该如何使用JavaScript，以及它能做什么 —— 甚至更多。我们需要保持克制。渐进增强帮助我们达到这些，因为它迫使我们专注内容，并从那里开始。

### 建立一个基线

通过渐进增强，我们在可用的代码基础上构建站点。要记住的关键JavaScript概念是，任何用户需要理解页面目的的内容都应该存在该页面，即使是客户端脚本确实的情况下也一样。

一个例子：问题中的内容是你销售产品的比较表。如果站点需要指示数据需要通过列进行排序，那么你可以考虑通过Ajax将表加载到页面中，这样你就可以在接受到通知的时候重新在服务器端重新排列它。听起来很完美对吧？

错误！

如果潜在的客户在禁用JavaScript的情况下浏览这个页面怎么办？如果使用JavaScript加载页面上的内容，他们就不能访问任何那样的内容，即使是在未排序状态下的。你怎么奢求你的用户在没有看到产品的情况下就购买它们呢？

上面的场景甚至内有解决搜索后的结果。搜索引擎蜘蛛不会执行JavaScript，所以如果你使用JavaScript将内容载入到你的页面，搜索引擎蜘蛛将不会阅读或索引你的内容。如果你的产品信息不能为谷歌，微软或雅虎索引，你又会失去多少潜在的客户？

在考虑同样的渐进增强的需求时，你需要在标签中包含基本的表。多数情况下，它仍应该有后台生成，但它将直接嵌入到页面中，而不是有Ajax加载。你仍然可以编写脚本在DOM中查找到表格，然后使得它可交互，生成排序链接并将它的onclick调用链接到Ajax调用，以便重新排表。

通过这种方式，你不仅满足了需求，而且还为搜索引擎蜘蛛和不支持JavaScript的客户提供了“低保真”体验。

更进一步，你甚至可以手动将排序链接添加到表头，并让它们刷新页面，传递相应的变量重新排表。这将是非js用户能够重新对数据进行排序，是他们的响应稍微少一些，但仍然是功能齐全的“高保真”体验。

在您的脚本中进行一些简单的调整之后，您就可以调整这些链接来执行Ajax请求，将最佳的体验交给最有能力的用户。最后，你得到了一个渐进增强的完美范例。

既然你已经基本了解了JavaScript中的渐进增强，我们可以讨论几个你可以开始使用的技术了。

### 掌控你的脚本

有效集成渐进增强的关键之一是为你的脚本管理建立一个计划。要做到这点，你需要首先熟悉“非侵入式JavaScript”的概念。非侵入式的JavaScript是客户端脚本世界中渐进增强的基础。

最明显的“非侵入式”方法是去掉所有内联事件处理程序，因为它们很容易通过DOM注册。

```html
<a href="http://msdn.com">  newWin(this.href);"</del>>
```

下一步是姜所有的脚本链接到外部文件，而不是嵌入到`script`元素里。

```html
<script type="text/javascript">
  // my script
</script>
<script type="text/javascript" src="myscript.js"></script>
```
这使得脚本更易维护，并且添加一些可伸缩性。（老实说，这两种变化会花费一些工作，因为许多WYSIWYG编辑器和web应用程序开发框架都产生了许多可恶的代码。幸运的是，有一些补丁和附加组件可以在这些系统中使用，以克服它们的话习惯。）

下一步使得脚本变得无侵入式是决定何时以及如何包含它们。简单说来，这意味着需要检查以确保脚本能运行在用户浏览器上，可以在这是调用它们之前现在浏览器里测试。

```js
if( document.getElementById ){
  scriptUsingGetElementById();
}
```

你还需要测试任何你需要的对象，你甚至可能要测试特定元素是否存在，因为你的脚本可能需要在上面做hook。按照这个过程，您使用的每个脚本将在可处理脚本的用户浏览器中，创建一个顺畅的交互提样——这些都可以在当前页面的标签上运行。

要了解更多非侵入式JavaScript的内容，你应该重温[Jeremy Keith关于此主题的文章](https://alistapart.com/articles/behavioralseparation)。


### 保持样式分离

JavaScript不是单独存在的，因此就像脚本与标签分离一样（如我们之前讨论的）你应该保持脚本与样式的分离。

主要来说，你应该在创建的DOM元素中添加内联样式。相反，应该为其添加相关的样式名，不管是来自全局样式表还是特定的与JavaScript相关的样式表。

```js
var el = document.getElementById( 'message' );
el.style.color = '#f00';
el.style.backgroundColor = '#ffcfcf';
//替换为
el.className = 'highlighted';

```

如果你的脚本需要许多样式来启用它的交互性，那特定于脚本的样式表将是一个很好的选择。将其设置在单独的文件中，可以独立于站点上的其它样式进行维护，他还允许您尽在脚本可执行时再链接到样式表，从而减少在不适用脚本或不支持它的浏览器上下载的次数。

如果您决定将样式表嵌入到您的一个主样式表中，一定要编写编写它们，这样它们只在脚本执行成功时应用。

更多关于样式/脚本分离，你应该读一读关于[滚动问题的争论](http://scrollmagazine.com/number-1)的[文章](http://scrollmagazine.com/number-1/keeping-the-hot-side-hot)（当前只有打印版）

### 总结

我们已经回顾了在JavaScript中实现渐进增强所需的态度，并通过一些技术实现了它。我们还谈到了非侵入式脚本的概念，并学习了一些如何管理CSS和JavaScript之间关系的知识。

本文完成了关于渐进增强的介绍系列文章，以及如果在CSS和JavaScript中来实现它。我们希望它启发了你的思考，并极力你在之后你自己的工作六中开始使用渐进增强。

[原文](https://alistapart.com/article/progressiveenhancementwithjavascript)
