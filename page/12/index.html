<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="monjer's note" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="monjer&#39;s note">
<meta property="og:url" content="http://monjer.github.io/page/12/index.html">
<meta property="og:site_name" content="monjer&#39;s note">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="monjer&#39;s note">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://monjer.github.io/page/12/"/>





  <title>monjer's note</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2b4f08dbd457a5e207bff33f77b0eafc";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>











  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">monjer's note</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/03/15/MySQL数据库最大连接数的查看与修改/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/03/15/MySQL数据库最大连接数的查看与修改/" itemprop="url">MySQL数据库最大连接数的查看与修改</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-03-15T00:00:00+08:00">
                2014-03-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/03/15/MySQL数据库最大连接数的查看与修改/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/03/15/MySQL数据库最大连接数的查看与修改/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>当连接到MySQL服务器的并发连接数超过上限时，之后的连接会失败并会收到MySQL服务器返回的Too many connections错误。在服务器硬件负载支持的话，可以设置更大的并发连接数来避免这个错误的发生的几率。</p>
<p>MySQL服务器中使用<a href="1">max_connections</a>系统变量来设置服务器的最大连接数。发生连接被服务器拒绝的时候，服务器会将<a href="2">Connection_errors_max_connections</a>状态变量进行累加，以此来作为记录服务器的连接状况的指标之一。</p>
<h3 id="查看最大连接数"><a href="#查看最大连接数" class="headerlink" title="查看最大连接数"></a>查看最大连接数</h3><p>本机Mac OS安装的MySQL5.6版数据库，连接到MySQL服务器，使用<code>show variables like &#39;max_connections&#39;</code>语句查看，MySQL5.6默认的并发连接数为<strong>151</strong>，之前的默认值为<strong>100</strong></p>
<p>示例：
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">192:support-files manjun.han$ mysql -u root -p;</div><div class="line">Enter password:</div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 1</div><div class="line">Server version: 5.6.15 MySQL Community Server (GPL)</div><div class="line"></div><div class="line">Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> help. Type <span class="string">'\c'</span> to clear the current input 	statement.</div><div class="line"></div><div class="line">mysql&gt; show variables like <span class="string">'max_connections'</span>;</div><div class="line">+-----------------+-------+</div><div class="line">| Variable_name   | Value |</div><div class="line">+-----------------+-------+</div><div class="line">| max_connections | 151   |</div><div class="line">+-----------------+-------+</div><div class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt;</div></pre></td></tr></table></figure></p>
<h3 id="修改最大连接数"><a href="#修改最大连接数" class="headerlink" title="修改最大连接数"></a>修改最大连接数</h3><ol>
<li><p>使用<code>set global</code>语句，如设置最大连接数量为<strong>200</strong>，操作如下</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">mysql&gt; <span class="built_in">set</span> global max_connections=200;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; show variables like <span class="string">'max_connections'</span>;</div><div class="line">+-----------------+-------+</div><div class="line">| Variable_name   | Value |</div><div class="line">+-----------------+-------+</div><div class="line">| max_connections | 200   |</div><div class="line">+-----------------+-------+</div><div class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt;</div></pre></td></tr></table></figure>
<blockquote>
<p><code>max_connections</code>为系统变量(System variables),所以需要在set后添加global关键字</p>
</blockquote>
<p> 此设置的有效范围仅限于当前数据库此次的运行周期，MySQL服务器重启后，此设置将失效，    <code>max_connections</code>的值将重新设置为默认值，或设置为选项文件中的配置的值。</p>
</li>
<li><p>修改<strong>my.cnf</strong>配置文件</p>
<p> 在mysql的安装目录下放置了其选项配置文件<strong>my.cnf</strong>（MySQL选择默认安装的话，安装目录在<code>/usr/lib/local/mysql</code>下,不同平台下MySQL的安装路径和选项文件的命名有差异，具体参考官网的安装说明）,该文件用来设置MySQL启动时要读取和加载的启动选项。</p>
<p> 首先关闭MySQL服务器</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">192:bin manjun.han$ sudo ./mysqladmin -u root -p shutdown</div><div class="line">Password:</div><div class="line">Enter password:</div><div class="line">192:bin manjun.han$</div></pre></td></tr></table></figure>
<p> 打开my.cnf配置文件，在<code>[mysqld]</code>选项组下面添加如下<code>max_connections</code>选项设置</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">max_connections=200</div></pre></td></tr></table></figure>
<p> 如图示：</p>
 <img src="/2014/03/15/MySQL数据库最大连接数的查看与修改/1.png" alt="1.png" title="">
<p> 重启MySQL服务器，重新查看<code>max_connections</code>的当前值</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">192:bin manjun.han$ sudo ./mysqladmin -u root -pnewpass shutdown</div><div class="line">Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</div><div class="line">192:bin manjun.han$ <span class="built_in">cd</span> ../support-files/</div><div class="line">192:support-files manjun.han$ sudo ./mysql.server start</div><div class="line">Starting MySQL</div><div class="line">. SUCCESS!</div><div class="line">192:support-files manjun.han$ mysql -u root -p</div><div class="line">Enter password:</div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 1</div><div class="line">Server version: 5.6.15 MySQL Community Server (GPL)</div><div class="line"></div><div class="line">Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> help. Type <span class="string">'\c'</span> to clear the current input 	statement.</div><div class="line"></div><div class="line">mysql&gt; show variables like <span class="string">'max_connections'</span>;</div><div class="line">+-----------------+-------+</div><div class="line">| Variable_name   | Value |</div><div class="line">+-----------------+-------+</div><div class="line">| max_connections | 200   |</div><div class="line">+-----------------+-------+</div><div class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt;</div></pre></td></tr></table></figure>
<p> 可见，选项配置文件的设置已经生效。</p>
</li>
</ol>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="1">max_connections</a></li>
<li><a href="2">Connection_errors_max_connections</a></li>
<li><a href="http://dev.mysql.com/doc/refman/5.6/en/set-statement.html" target="_blank" rel="external">Set syntax</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/03/15/修改Tomcat的Server标识/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/03/15/修改Tomcat的Server标识/" itemprop="url">修改Tomcat的Server标识</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-03-15T00:00:00+08:00">
                2014-03-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/03/15/修改Tomcat的Server标识/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/03/15/修改Tomcat的Server标识/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>默认情况下访问Tomcat提供的Web应用中的文件或泛起HTTP请求，Tomcat会为每个HTTP响应添加<code>Server</code>消息头，默认该消息头设置如下：</p>
<pre><code>Server: Apache-Coyote/1.1
</code></pre><p>这是一个服务器的行为，之前好奇于该行为的是如何进行集中控制的，发现其实这个消息头是通过<code>conf/server.xml</code>中的<code>Connector</code>配置元素提供的名为<code>server</code>的属性进行配置的，如更改Server的标识为<code>Apache/Tomcat</code>,可以打开<code>conf/server.xml</code>文件并找到HTTP Connector配置元素，之后添加自定义的<code>server</code>标识即可，如：
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;Connector connectionTimeout=<span class="string">"20000"</span></div><div class="line">            port=<span class="string">"8080"</span></div><div class="line">            protocol=<span class="string">"HTTP/1.1"</span></div><div class="line">            redirectPort=<span class="string">"8443"</span></div><div class="line">            server=<span class="string">"Apache/Tomcat"</span>/&gt;</div></pre></td></tr></table></figure></p>
<p>这样所有的来自于Tomcat的HTTP响应中的<code>server</code>字段都会变为：</p>
<pre><code>Server: Apache/Tomcat
</code></pre><p>其实这个表示的设置并没有太大的实际意义，只是一个简单的小技巧记录之！</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="http://tomcat.apache.org/tomcat-7.0-doc/config/http.html#BIO_specific_configuration" target="_blank" rel="external">Apache HTTP Connector</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/03/15/使用apachectl操作Apache服务器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/03/15/使用apachectl操作Apache服务器/" itemprop="url">使用apachectl操作Apache服务器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-03-15T00:00:00+08:00">
                2014-03-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/03/15/使用apachectl操作Apache服务器/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/03/15/使用apachectl操作Apache服务器/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="2">apachectl</a>是Apache HTTP服务器的前端脚本程序，设计用于帮助管理员控制Apache <a href="1">httpd</a> 守护进程的功能。以单独守护进程运行的<a href="1">httpd</a> 是Apache真正的服务器程序。<a href="2">apachectl</a>可以接受<a href="1">httpd</a>的所有运行参数，就好像其代理一样，但使用<a href="2">apachectl</a>会在成功设置一些与服务器相关的脚本之后，再调用启动<a href="1">httpd</a>，完成Apache服务器的启动。</p>
<p>本篇使用Mac OS X自带的Apache服务器，演示使用<a href="2">apachectl</a>的常见使用以及涉及到的命令参数，以下命令的执行，需要有root权限。</p>
<h3 id="启动Apache"><a href="#启动Apache" class="headerlink" title="启动Apache"></a>启动Apache</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">shell&gt; sudo apachectl start</div><div class="line">shell&gt; Password:******</div></pre></td></tr></table></figure>
<h3 id="关闭Apache"><a href="#关闭Apache" class="headerlink" title="关闭Apache"></a>关闭Apache</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">shell&gt; sudo apachectl stop</div><div class="line">shell&gt; Password:******</div></pre></td></tr></table></figure>
<h3 id="重启Apache"><a href="#重启Apache" class="headerlink" title="重启Apache"></a>重启Apache</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">shell&gt; sudo apachectl restart</div><div class="line">shell&gt; Password:******</div></pre></td></tr></table></figure>
<h3 id="优雅的重启Apache"><a href="#优雅的重启Apache" class="headerlink" title="优雅的重启Apache"></a>优雅的重启Apache</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">shell&gt; sudo apachectl graceful</div><div class="line">shell&gt; Password:******</div></pre></td></tr></table></figure>
<p>与<code>restart</code>参数不同的是，使用<code>graceful</code>选项重启Apache服务器，不会中断现有的连接。</p>
<h3 id="检查Apache配置文件的语法"><a href="#检查Apache配置文件的语法" class="headerlink" title="检查Apache配置文件的语法"></a>检查Apache配置文件的语法</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">shell&gt; sudo apachectl configtest</div><div class="line">shell&gt; Password:******</div></pre></td></tr></table></figure>
<blockquote>
<p>apachectl configtest 等价于 apachectl -t    </p>
</blockquote>
<p>配置正常，命令行输出
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Syntax OK</div></pre></td></tr></table></figure></p>
<h3 id="查看编译的模块"><a href="#查看编译的模块" class="headerlink" title="查看编译的模块"></a>查看编译的模块</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shell &gt; sudo apachectl <span class="_">-l</span></div></pre></td></tr></table></figure>
<p>输出类似于
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Compiled <span class="keyword">in</span> modules:</div><div class="line">  core.c</div><div class="line">  prefork.c</div><div class="line">  http_core.c</div><div class="line">  mod_so.c</div></pre></td></tr></table></figure></p>
<h3 id="产看apache版本"><a href="#产看apache版本" class="headerlink" title="产看apache版本"></a>产看apache版本</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shell&gt; sudo apachectl -v</div></pre></td></tr></table></figure>
<p>输出类似于
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Server version: Apache/2.2.26 (Unix)</div><div class="line">Server built:   Dec 10 2013 22:09:38</div></pre></td></tr></table></figure></p>
<p>其它一些参数更详细的说明参考Apache官网。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/03/15/几种查看MySQL版本信息的方式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/03/15/几种查看MySQL版本信息的方式/" itemprop="url">几种查看MySQL版本信息的方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-03-15T00:00:00+08:00">
                2014-03-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/03/15/几种查看MySQL版本信息的方式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/03/15/几种查看MySQL版本信息的方式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>以下命令及示例在本机Mac OS下安装的MySQL5.6版本上进行的演示及测试</p>
<h3 id="使用mysqladmin"><a href="#使用mysqladmin" class="headerlink" title="使用mysqladmin"></a>使用mysqladmin</h3><ol>
<li><p>使用<strong><code>--version</code></strong>选项**</p>
<p> <code>--version</code>选项的作用是:<strong>显示MySQL服务器的版本信息并退出,</strong>简写形式为<code>-V</code>.以下两种写法等同，如</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysqladmin --version</div></pre></td></tr></table></figure>
<p> 或</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysqladmin -V</div></pre></td></tr></table></figure>
<p> 示例：</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">192:bin manjun.han$&gt; sudo ./mysqladmin -u root -p -V;</div><div class="line">./mysqladmin  Ver 8.42 Distrib 5.6.15, <span class="keyword">for</span> osx10.7 on x86_64</div><div class="line">192:bin manjun.han$&gt; sudo ./mysqladmin -u root -p --version;</div><div class="line">./mysqladmin  Ver 8.42 Distrib 5.6.15, <span class="keyword">for</span> osx10.7 on x86_64</div><div class="line">192:bin manjun.han$</div></pre></td></tr></table></figure>
<blockquote>
<p><strong>附注:</strong></p>
<ul>
<li><p>连接时需要指定mysql的服务器地址(<code>-h</code>),账户名称(<code>-u</code>),密码(<code>-p</code>),端口号(<code>-P</code>),以上命令使用的是默
认值。</p>
</li>
<li><p>以上命令等价于</p>
<pre><code>mysqladmin --version;
</code></pre></li>
</ul>
</blockquote>
</li>
<li><p>使用<strong><code>version</code></strong>命令**</p>
<p> <code>version</code>命令的作用是:<strong>显示MySQL服务器的版本信息。</strong>如</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysqladmin version</div></pre></td></tr></table></figure>
<p> 示例:</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">192:bin manjun.han$ sudo ./mysqladmin -u root  -p version;</div><div class="line">Enter password: </div><div class="line">./mysqladmin  Ver 8.42 Distrib 5.6.15, <span class="keyword">for</span> osx10.7 on x86_64</div><div class="line">Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Server version		5.6.15</div><div class="line">Protocol version	10</div><div class="line">Connection		Localhost via UNIX socket</div><div class="line">UNIX socket		/tmp/mysql.sock</div><div class="line">Uptime:			5 min 27 sec</div><div class="line"></div><div class="line">Threads: 1  Questions: 8  Slow queries: 0  Opens: 67  Flush tables: 1  Open tables: 60  	Queries per second avg: 0.024</div><div class="line">192:bin manjun.han$</div></pre></td></tr></table></figure>
<p> <code>version</code>命令会将mysql服务器版本信息及当前的运行状态显示出来。</p>
<h3 id="使用mysqlshow"><a href="#使用mysqlshow" class="headerlink" title="使用mysqlshow"></a>使用mysqlshow</h3></li>
</ol>
<p>同<strong>mysqladmin</strong>一样，<strong>mysqlshow</strong>也提供了一个<code>--version</code>(简写<code>-V</code>)选项来显示数据库的版本信息，以下两种写法等同，如
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysqlshow --version</div></pre></td></tr></table></figure></p>
<p>或
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysqlshow -V</div></pre></td></tr></table></figure></p>
<p>示例:
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">192:bin manjun.han$ sudo ./mysqlshow -u root -p -V</div><div class="line">./mysqlshow  Ver 9.10 Distrib 5.6.15, <span class="keyword">for</span> osx10.7 (x86_64)</div><div class="line">192:bin manjun.han$ sudo ./mysqlshow -u root -p --version</div><div class="line">./mysqlshow  Ver 9.10 Distrib 5.6.15, <span class="keyword">for</span> osx10.7 (x86_64)</div><div class="line">192:bin manjun.han$</div></pre></td></tr></table></figure></p>
<h3 id="使用mysql命令行工具"><a href="#使用mysql命令行工具" class="headerlink" title="使用mysql命令行工具"></a>使用mysql命令行工具</h3><ol>
<li><p>使用<strong><code>--version</code></strong>选项**</p>
<p> <code>-version</code>选项用来显示MySQL版本信息并退出，其简写为<code>-V</code>,如下</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shell&gt; mysql -V</div></pre></td></tr></table></figure>
<p> 示例</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">192:bin manjun.han$ mysql -V;</div><div class="line">mysql  Ver 14.14 Distrib 5.6.15, <span class="keyword">for</span> osx10.7 (x86_64) using  EditLine wrapper</div><div class="line">192:bin manjun.han$</div></pre></td></tr></table></figure>
</li>
<li><p>连接后查看终端输出，里面包含了当前数据库的版本**</p>
<p> 如</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">192:bin manjun.han$ mysql -u root -V;</div><div class="line">mysql  Ver 14.14 Distrib 5.6.15, <span class="keyword">for</span> osx10.7 (x86_64) using  EditLine wrapper</div><div class="line">192:bin manjun.han$ mysql -u root -v;</div><div class="line">ERROR 1045 (28000): Access denied <span class="keyword">for</span> user <span class="string">'root'</span>@<span class="string">'localhost'</span> (using password: NO)</div><div class="line">192:bin manjun.han$ mysql -u root -p;</div><div class="line">Enter password: </div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 2558</div><div class="line">Server version: 5.6.15 MySQL Community Server (GPL)</div><div class="line"></div><div class="line">Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> help. Type <span class="string">'\c'</span> to clear the current input statement.</div></pre></td></tr></table></figure>
</li>
<li><p>连接MySQL服务器后，使用<strong><code>status</code></strong>命令，或简写的<strong><code>\s</code></strong>命令**</p>
<p> 如</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; \s</div></pre></td></tr></table></figure>
<p> 承接以上连接mysql后，示例:</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">mysql&gt; \s</div><div class="line">--------------</div><div class="line">mysql  Ver 14.14 Distrib 5.6.15, <span class="keyword">for</span> osx10.7 (x86_64) using  EditLine wrapper</div><div class="line"></div><div class="line">Connection id:		2558</div><div class="line">Current database:	</div><div class="line">Current user:		root@localhost</div><div class="line">SSL:			Not <span class="keyword">in</span> use</div><div class="line">Current pager:		stdout</div><div class="line">Using outfile:		<span class="string">''</span></div><div class="line">Using delimiter:	;</div><div class="line">Server version:		5.6.15 MySQL Community Server (GPL)</div><div class="line">Protocol version:	10</div><div class="line">Connection:		Localhost via UNIX socket</div><div class="line">Server characterset:	latin1</div><div class="line">Db     characterset:	latin1</div><div class="line">Client characterset:	utf8</div><div class="line">Conn.  characterset:	utf8</div><div class="line">UNIX socket:		/tmp/mysql.sock</div><div class="line">Uptime:			1 hour 37 min 45 sec</div><div class="line"></div><div class="line">Threads: 1  Questions: 36  Slow queries: 0  Opens: 71  Flush tables: 1  Open tables: 64  Queries per second avg: 0.006</div><div class="line">--------------</div><div class="line"></div><div class="line">mysql&gt;</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="使用select语句"><a href="#使用select语句" class="headerlink" title="使用select语句"></a>使用select语句</h3><p>使用SQL的<code>select</code>语句，结合<code>version()</code>函数，如
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select version();</div><div class="line">+-----------+</div><div class="line">| version() |</div><div class="line">+-----------+</div><div class="line">| 5.6.15    |</div><div class="line">+-----------+</div><div class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt;</div></pre></td></tr></table></figure></p>
<p><code>version()</code>函数用来返回MySQL服务器版本字符串，该字符串使用utf-8字符集。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://dev.mysql.com/doc/refman/5.6/en/mysql-commands.html" target="_blank" rel="external">mysql Commands(MySQL 5.6)</a></li>
<li><a href="http://dev.mysql.com/doc/refman/5.1/zh/client-side-scripts.html#mysql-commands" target="_blank" rel="external">mysql：MySQL命令行工具(MySQL5.1)</a></li>
<li><a href="http://dev.mysql.com/doc/refman/5.6/en/information-functions.html#function_version" target="_blank" rel="external">version()(MySQL5.6)</a></li>
<li><a href="http://dev.mysql.com/doc/refman/5.6/en/mysql-command-options.html" target="_blank" rel="external">mysql Options(MySQL 5.6)</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/03/15/查看MySQL的运行状态/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/03/15/查看MySQL的运行状态/" itemprop="url">查看MySQL的运行状态</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-03-15T00:00:00+08:00">
                2014-03-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/03/15/查看MySQL的运行状态/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/03/15/查看MySQL的运行状态/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-运行时间-单位-秒"><a href="#1-运行时间-单位-秒" class="headerlink" title="1.运行时间(单位:秒)"></a>1.运行时间(单位:秒)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show status like <span class="string">"Uptime"</span>;</div><div class="line">+---------------+---------+</div><div class="line">| Variable_name | Value   |</div><div class="line">+---------------+---------+</div><div class="line">| Uptime        | 3560978 |</div><div class="line">+---------------+---------+</div><div class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div></pre></td></tr></table></figure>
<h3 id="2-连接信息"><a href="#2-连接信息" class="headerlink" title="2.连接信息"></a>2.连接信息</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show status like <span class="string">'Threads%'</span>;</div><div class="line">+-------------------+-------+</div><div class="line">| Variable_name     | Value |</div><div class="line">+-------------------+-------+</div><div class="line">| Threads_cached    | 0     |</div><div class="line">| Threads_connected | 51    |</div><div class="line">| Threads_created   | 6371  |</div><div class="line">| Threads_running   | 1     |</div><div class="line">+-------------------+-------+</div><div class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div></pre></td></tr></table></figure>
<ul>
<li>Threads_cached - 线程缓存内的线程的数量。</li>
<li>Threads_connected - 当前打开的连接的数量。</li>
<li><p>Threads_created - 创建用来处理连接的线程数。如果Threads_created较大，你可能要增加thread_cache_size值。缓存访问率的计算方法
Threads_created/Connections。</p>
</li>
<li><p>Threads_running - 激活的（非睡眠状态）线程数。</p>
</li>
</ul>
<h3 id="3-试图连接到-不管是否成功-MySQL服务器的连接数。"><a href="#3-试图连接到-不管是否成功-MySQL服务器的连接数。" class="headerlink" title="3.试图连接到(不管是否成功)MySQL服务器的连接数。"></a>3.试图连接到(不管是否成功)MySQL服务器的连接数。</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show status like <span class="string">'Connections'</span>;</div><div class="line">+---------------+-------+</div><div class="line">| Variable_name | Value |</div><div class="line">+---------------+-------+</div><div class="line">| Connections   | 6374  |</div><div class="line">+---------------+-------+</div><div class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</div></pre></td></tr></table></figure>
<h3 id="4-服务器处理的最大并发连接数"><a href="#4-服务器处理的最大并发连接数" class="headerlink" title="4.服务器处理的最大并发连接数"></a>4.服务器处理的最大并发连接数</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show status like <span class="string">'Max_used_connections'</span>;</div><div class="line">+----------------------+-------+</div><div class="line">| Variable_name        | Value |</div><div class="line">+----------------------+-------+</div><div class="line">| Max_used_connections | 115   |</div><div class="line">+----------------------+-------+</div><div class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div></pre></td></tr></table></figure>
<h3 id="5-是否是从属服务器"><a href="#5-是否是从属服务器" class="headerlink" title="5.是否是从属服务器"></a>5.是否是从属服务器</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show status like <span class="string">'Slave_running'</span>;</div><div class="line">+---------------+-------+</div><div class="line">| Variable_name | Value |</div><div class="line">+---------------+-------+</div><div class="line">| Slave_running | OFF   |</div><div class="line">+---------------+-------+</div><div class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div></pre></td></tr></table></figure>
<p>如果该服务器是连接到主服务器的从服务器，则该值为ON。</p>
<h3 id="6-试图连接到服务器而失败的连接数"><a href="#6-试图连接到服务器而失败的连接数" class="headerlink" title="6.试图连接到服务器而失败的连接数"></a>6.试图连接到服务器而失败的连接数</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show status like <span class="string">'Aborted_connects'</span>;</div><div class="line">+------------------+-------+</div><div class="line">| Variable_name    | Value |</div><div class="line">+------------------+-------+</div><div class="line">| Aborted_connects | 11    |</div><div class="line">+------------------+-------+</div><div class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div></pre></td></tr></table></figure>
<h3 id="7-客户端原因造成的连接中断次数"><a href="#7-客户端原因造成的连接中断次数" class="headerlink" title="7.客户端原因造成的连接中断次数"></a>7.客户端原因造成的连接中断次数</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show status like <span class="string">'Aborted_clients'</span>;</div><div class="line">+-----------------+-------+</div><div class="line">| Variable_name   | Value |</div><div class="line">+-----------------+-------+</div><div class="line">| Aborted_clients | 3713  |</div><div class="line">+-----------------+-------+</div><div class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</div></pre></td></tr></table></figure>
<p>由于客户端没有正确关闭MySQL的数据库连接,导致中断的连接总数。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://dev.mysql.com/doc/refman/5.6/en/server-status-variables.html#statvar_Max_used_connections" target="_blank" rel="external">Server Status Variables(MySQL5.6)</a></li>
<li><a href="http://dev.mysql.com/doc/refman/5.1/zh/problems.html#communication-errors" target="_blank" rel="external">通信错误和失效连接(MySQl5.1)</a></li>
<li><a href="http://dev.mysql.com/doc/refman/5.1/zh/database-administration.html#server-status-variables" target="_blank" rel="external">服务器状态变量(MySQL5.1)</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/02/15/Apache服务器指定访问目录时返回的资源/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/02/15/Apache服务器指定访问目录时返回的资源/" itemprop="url">Apache服务器指定访问目录时返回的资源</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-02-15T00:00:00+08:00">
                2014-02-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/02/15/Apache服务器指定访问目录时返回的资源/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/02/15/Apache服务器指定访问目录时返回的资源/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>默认情况下当我们访问Apache服务器某个目录URL时，Apache服务器会返回该目录下名为<code>index.html</code>的页面文件内容。如访问<code>http://localhost</code>时，Apache服务器会返回<code>DocumentRoot</code>下存在的用来测试的<code>index.html</code>页面。如我本机Mac OS自带的Apache，默认的<code>DocumentRoot</code>位置为:</p>
<pre><code>DocumentRoot &quot;/Library/WebServer/Documents&quot;
</code></pre><p>该目录下存在默认的<code>index.html</code>文件，启动Apache服务器</p>
<pre><code>shell&gt; sudo apachectl start
</code></pre><p>并在地址栏中输入<code>http://localhost</code>(Apache服务器默认端口80),可以看到返回的是<code>index.html</code>页面。</p>
<img src="/2014/02/15/Apache服务器指定访问目录时返回的资源/1.png" alt="1.png" title="">
<p>在<code>DocumentRoot</code>新建一个名为<code>dir</code>的空目录并将<code>index.html</code>复制一份到该目录下。之后访问目录<code>http://localhost/dir/</code>,可以看到同样会把dir目录下拷贝过去的<code>index.html</code>内容返回回去。</p>
<img src="/2014/02/15/Apache服务器指定访问目录时返回的资源/3.png" alt="3.png" title="">
<h3 id="DirectoryIndex指令"><a href="#DirectoryIndex指令" class="headerlink" title="DirectoryIndex指令"></a>DirectoryIndex指令</h3><p>Apache服务器下访问目录时返回的资源是通过<code>DirectoryIndex</code>指令进行配置的。<code>DirectoryIndex</code>指令的作用是:<strong>指定当客户端在请求目录索引时，服务器所要访问的资源列表</strong>。默认值为<code>DirectoryIndex index.html</code>，如设置：</p>
<pre><code>DirectoryIndex index.html
</code></pre><p>那么当请求<code>http://server.com/docs/</code>时会返回<code>http://server.com/docs/index.html</code>。</p>
<p>也可以为<code>DirectoryIndex</code>设置由多个文件名称组成的列表，如:</p>
<pre><code>DirectoryIndex index.html index.php root.html root.php
</code></pre><p>那么当请求<code>http://server.com/docs/</code>时,服务器会在<code>docs</code>目录下依次查看是否存在文件<code>index.html</code> <code>index.php</code> <code>root.html</code> <code>root.php</code>，并优先返回第一个查找到的文件。</p>
<p>在之前的<code>dir</code>目录下复制index.html文件并重命名为root.html，再将root.html文件内容改为</p>
<pre><code>It works!Root.html
</code></pre><p>以示区分，之后在<code>httpd.conf</code>配置文件中的<code>&lt;Directory &quot;/Library/WebServer/Documents&quot;&gt;…&lt;/Directory&gt;</code>中添加如下配置</p>
<pre><code>DirectoryIndex root.html index.html
</code></pre><p>之后保存文件，重启Apache服务器</p>
<pre><code>shell&gt; sudo apachectl restart
</code></pre><p>并访问<code>http://localhost/dir/</code>，以下是访问结果</p>
<img src="/2014/02/15/Apache服务器指定访问目录时返回的资源/2.png" alt="2.png" title="">
<p>可以看到优先返回的是root.html页面的内容，并验证了<code>DirectoryIndex</code>指令的索引顺序。</p>
<h3 id="DirectoryIndex的路径"><a href="#DirectoryIndex的路径" class="headerlink" title="DirectoryIndex的路径"></a>DirectoryIndex的路径</h3><p><code>DirectoryIndex</code>指定后的文件路径，既可以是相对路径也可以是绝对路径,如：</p>
<pre><code>DirectoryIndex /index.html index.html
</code></pre><p><code>/index.html</code>是绝对路径下的文件，<code>index.html</code>是相对于当前目录下的文件。</p>
<h3 id="同一上下文下多个DirectoryIndex的配置"><a href="#同一上下文下多个DirectoryIndex的配置" class="headerlink" title="同一上下文下多个DirectoryIndex的配置"></a>同一上下文下多个DirectoryIndex的配置</h3><p>在同一个上下中，可以添加多个DirectoryIndex指令，相互之间依旧是按顺序索引关系，非替代关系，如：</p>
<pre><code>&lt;Directory /site&gt;
    DirectoryIndex index.html
    DirectoryIndex index.php
&lt;/Directory&gt;
</code></pre><p>等同于</p>
<pre><code>&lt;Directory /site&gt;
    DirectoryIndex index.html index.php
&lt;/Directory&gt;
</code></pre><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="1">DirectoryIndex Directive</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/02/15/关闭Tomcat的自动部署功能/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/02/15/关闭Tomcat的自动部署功能/" itemprop="url">关闭Tomcat的自动部署功能</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-02-15T00:00:00+08:00">
                2014-02-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/02/15/关闭Tomcat的自动部署功能/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/02/15/关闭Tomcat的自动部署功能/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>默认配置下Tomcat在运行期会定期的检测是否有新的工程部署进来，或对现有工程进行了局部更新。这是通过开启server.xml文件中的<code>Host</code>元素的<code>autoDeploy</code>属性来完成的。Tomcat的默认配置中自动部署功能默认是开启的，如：
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">appBase</span>=<span class="string">"webapps"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span> <span class="attr">name</span>=<span class="string">"localhost"</span> <span class="attr">unpackWARs</span>=<span class="string">"true"</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><code>autoDeploy</code>设置为true时，Tomcat会定期对<code>appBase</code>或<code>xmlBase</code>指定的目录的变更进行检测，保证部署到<code>appBase</code>下的新工程和添加到<code>xmlBase</code>目录中的context XML描述文件指向的新工程得到加载，以及当检测到有更新的web application后，能够对其进行重部署。背后机制是Tomcat会启动一个自动部署检测进程来监视web application的变化。这种检测伴随着占用更多的cpu资源和内存资源，这在实际的生产环境中是一种资源的浪费，所以需要将自动部署检测关闭掉，设置<code>autoDeloy</code>标记为false即可，如
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">appBase</span>=<span class="string">"webapps"</span> <span class="attr">autoDeploy</span>=<span class="string">"false"</span> <span class="attr">name</span>=<span class="string">"localhost"</span> <span class="attr">unpackWARs</span>=<span class="string">"true"</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://tomcat.apache.org/tomcat-7.0-doc/config/host.html" target="_blank" rel="external">Tomcat Host Config</a></li>
<li><a href="http://tomcat.apache.org/tomcat-7.0-doc/config/host.html#Automatic_Application_Deployment" target="_blank" rel="external">Automatic Application Deployment</a></li>
<li><a href="http://community.jaspersoft.com/wiki/how-disable-automatic-deployment-production-servers-using-tomcat" target="_blank" rel="external">How to Disable automatic deployment on production servers using Tomcat</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/02/15/window的beforeunload事件处理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/02/15/window的beforeunload事件处理/" itemprop="url">window的beforeunload事件处理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-02-15T00:00:00+08:00">
                2014-02-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/02/15/window的beforeunload事件处理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/02/15/window的beforeunload事件处理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在网页浏览中，有时我们需要在用户刷新或退出当前页面之前做些特殊处理，如提示用户保存数据，或者防止用户在无意识状态下关闭当前打开的页面，导致重要数据的丢失。这可以通过为window对象添加<code>beforeunload</code>事件得以实现,该事件触发时，浏览器会弹出显示自定义信息的确认对话框来提示用户，是选择留在当前页面还是要继续之后的退出操作。</p>
<h3 id="监听处理"><a href="#监听处理" class="headerlink" title="监听处理"></a>监听处理</h3><p>下面是为window添加<code>beforeunload</code>事件的方式:
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.onbeforeunload = eventHandlerFun;</div></pre></td></tr></table></figure></p>
<p>也可以使用<code>addEventListener</code>方法添加事件处理，如:
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"beforeunload"</span>,eventHandlerFun);</div></pre></td></tr></table></figure></p>
<p><code>eventHandlerFun</code>指定的是事件处理的函数，例如我们需要在用户刷新或关闭页面时提示用户保存数据，示例代码如下：
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!doctype html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>beforeunload事件<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="built_in">window</span>.onbeforeunload = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="string">'请确认保存数据'</span>;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>jQuery写法
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$(windw).on(<span class="string">"beforeunload"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$e</span>)</span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">return</span>  <span class="string">'请确认保存数据'</span> ;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>页面加载完毕后，点击浏览器的刷新按钮，在Chrome下的执行结果如图：</p>
<img src="/2014/02/15/window的beforeunload事件处理/1.png" alt="1.png" title="">
<p><code>beforeunload</code>事件处理函数的返回值是添加自定义提示信息的地方，可以返回一个字符串来对用户做出提示，只要返回值不为空，<strong>多数</strong>浏览器都会将该信息显示在提示对话框上，但也有例外，如在我本机的火狐中执行以上代码，虽然也弹出了确认对话框，但未将提示信息显示在上面，如图：</p>
<img src="/2014/02/15/window的beforeunload事件处理/2.png" alt="2.png" title="">
<p>本机系统为Mac OS，火狐版本为FF26.0</p>
<img src="/2014/02/15/window的beforeunload事件处理/3.png" alt="3.png" title="">
<p>来自火狐MDN的注释说明在Firefox4及以后版本，<code>beforeunload</code>处理函数返回的字符串不会显示给用户</p>
<blockquote>
<p>Note that in Firefox 4 and later the returned string is not displayed to the user. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=588292" target="_blank" rel="external">bug 588292</a>.</p>
</blockquote>
<p>如果<code>beforeunload</code>的处理函数的没有添加返回值，那么浏览器不会弹出确认对话框，如以下示例不会确认对话框
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;!doctype html&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>beforeunload事件<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="built_in">window</span>.onbeforeunload = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">                <span class="comment">// 添加处理代码，省去返回值</span></div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>需要注意的是<code>beforeunload</code>事件触发时，当前页面的文档仍处于显示状态，我们可以在处理函数中进行任何页面操作，并且该事件也是可以<a href="https://developer.mozilla.org/en-US/docs/Web/API/event.preventDefault" target="_blank" rel="external">取消的</a>。</p>
<h3 id="标准和兼容性"><a href="#标准和兼容性" class="headerlink" title="标准和兼容性"></a>标准和兼容性</h3><p><code>beforeunload</code>最早是由微软在IE4中引入的，早期并没有一个浏览器间的统一标准，但HTML5中已经添加了对该事件的<a href="http://dev.w3.org/html5/spec-LC/history.html#unloading-documents" target="_blank" rel="external">标准化定义</a>。PC版浏览器下该事件的兼容性如下:</p>
<table class="compat-table">
    <tbody>
      <tr>
        <th>Feature</th>
        <th>Chrome</th>
        <th>Firefox(Gecko)</th>
        <th>IE</th>
        <th>Opera</th>
        <th>Safari</th>
      </tr>
      <tr>
        <td>Basic support</td>
        <td>1</td>
        <td>1</td>
        <td>4</td>
        <td>12</td>
        <td>3</td>
      </tr>
    </tbody>
  </table>

<h3 id="触发时机"><a href="#触发时机" class="headerlink" title="触发时机"></a>触发时机</h3><p>以下是来自MSDN中关于<code>beforeunload</code>事件的触发时机的描述：</p>
<ul>
<li>关闭当前窗口</li>
<li>在地址栏中输入新的地址并导航到新的位置</li>
<li>点击链接到其它文档的链接(<a href="http://msdn.microsoft.com/en-us/library/ie/ms535173\(v=vs.85\" target="_blank" rel="external">anchor</a>.aspx))</li>
<li>调用<a href="http://msdn.microsoft.com/en-us/library/ie/ms535173\(v=vs.85\" target="_blank" rel="external">anchor.click</a>.aspx)方法</li>
<li>调用<a href="http://msdn.microsoft.com/en-us/library/ie/ms536782\(v=vs.85\" target="_blank" rel="external">document.write</a>.aspx)方法</li>
<li>调用<a href="http://msdn.microsoft.com/en-us/library/ie/ms536369\(v=vs.85\" target="_blank" rel="external">document.close</a>.aspx)方法</li>
<li>调用<a href="http://msdn.microsoft.com/en-us/library/ie/ms536367(\v=vs.85\" target="_blank" rel="external">window.close</a>.aspx)方法</li>
<li>调用<a href="http://msdn.microsoft.com/en-us/library/ie/ms536638\(v=vs.85\" target="_blank" rel="external">window.navigate</a>.aspx)或<a href="http://msdn.microsoft.com/en-us/library/ie/ms536641\(v=vs.85\" target="_blank" rel="external">NavigateAndFind</a>.aspx)方法</li>
<li>调用<a href="http://msdn.microsoft.com/en-us/library/ie/ms536712\(v=vs.85\" target="_blank" rel="external">location.replace</a>.aspx)方法</li>
<li>调用<a href="http://msdn.microsoft.com/en-us/library/ie/ms536691\(v=vs.85\" target="_blank" rel="external">location.reload</a>.aspx)方法</li>
<li>为<a href="http://msdn.microsoft.com/en-us/library/ie/ms533867\(v=vs.85\" target="_blank" rel="external">location.href</a>.aspx)赋新值</li>
<li>通过<a href="http://msdn.microsoft.com/en-us/library/ie/ms535840\(v=vs.85\" target="_blank" rel="external">input type=submit</a>.aspx)空间提交有action属性指定地址的表单，或调用<a href="http://msdn.microsoft.com/en-us/library/ie/ms536771\(v=vs.85\" target="_blank" rel="external">form.submit</a>.aspx)方法</li>
<li>调用<a href="http://msdn.microsoft.com/en-us/library/ie/ms536651\(v=vs.85\" target="_blank" rel="external">window.open</a>.aspx)方法</li>
<li>调用<a href="http://msdn.microsoft.com/en-us/library/ie/ms536652\(v=vs.85\" target="_blank" rel="external">document.open</a>.aspx)方法</li>
<li>点击浏览器的回退，刷新或主页按钮</li>
</ul>
<p>对于其它浏览器的触发情况参见<a href="http://www.w3help.org/zh-cn/causes/BX2047" target="_blank" rel="external">各浏览器对 onbeforeunload 事件的支持与触发条件实现有差异</a>中的描述。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.onbeforeunload" target="_blank" rel="external">Window.onbeforeunload</a></li>
<li><a href="http://msdn.microsoft.com/en-us/library/ie/ms536907(v=vs.85).aspx" target="_blank" rel="external">beforeunload | onbeforeunload event</a></li>
<li><a href="http://www.w3help.org/zh-cn/causes/BX2047" target="_blank" rel="external">各浏览器对 onbeforeunload 事件的支持与触发条件实现有差异</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/02/15/使用X-Requested-With消息头来识别Ajax请求/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/02/15/使用X-Requested-With消息头来识别Ajax请求/" itemprop="url">使用X-Requested-With消息头来识别Ajax请求</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-02-15T00:00:00+08:00">
                2014-02-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/02/15/使用X-Requested-With消息头来识别Ajax请求/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/02/15/使用X-Requested-With消息头来识别Ajax请求/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Web页面中我们可以使用Ajax向后台服务器异步发送请求，从而完成页面无刷新状态下的数据交互，优化了前端的交互体验。对于同一个后台的数据接口有时需要根据请求的来源来做出不同的处理流程，例如对于一个请求的错误处理方式来说，来自于网页端的同步请求，我们可以以重定向的方式做出回应；对于Ajax发出异步的请求，可能会以返回JSON错误提示的方式在网页端给出指导性的错误提示而非跳转。</p>
<p>那么该如何区分请求的来源呢？一种实现方式是使用<code>X-Requested-With</code>请求头作为区分标记。</p>
<h3 id="非标准的X-Requested-With"><a href="#非标准的X-Requested-With" class="headerlink" title="非标准的X-Requested-With"></a>非标准的X-Requested-With</h3><p><code>X-Requested-With</code>属于HTTP的请求消息头中的一种，但并未标准化，它的主要作用就是用来标识网页端的Ajax请求。格式如下:</p>
<pre><code>X-Requested-With: XMLHttpRequest
</code></pre><p>使用Ajax原生代码示例如下:
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> httpRequest;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123; <span class="comment">// standard</span></div><div class="line"></div><div class="line">    httpRequest = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line"></div><div class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">window</span>.ActiveXObject) &#123; <span class="comment">// IE</span></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        httpRequest = <span class="keyword">new</span> ActiveXObject(<span class="string">"Msxml2.XMLHTTP"</span>);</div><div class="line">    &#125;<span class="keyword">catch</span> (e) &#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            httpRequest = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</div><div class="line">        &#125;<span class="keyword">catch</span> (e) &#123;&#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">httpRequest.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line"></div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line">httpRequest.open(<span class="string">'GET'</span>, <span class="string">"server.action"</span>,<span class="literal">true</span>);</div><div class="line"></div><div class="line"><span class="comment">// set http request header</span></div><div class="line">httpRequest.setRequestHeader(<span class="string">"X-Requested-With"</span>,<span class="string">"XMLHttpRequest"</span>);</div><div class="line"></div><div class="line">httpRequest.send();</div></pre></td></tr></table></figure></p>
<h3 id="前端框架中的支持示例"><a href="#前端框架中的支持示例" class="headerlink" title="前端框架中的支持示例"></a>前端框架中的支持示例</h3><p>当前多数的JavaScript框架在自己的Ajax模块实现中都加入了对该消息头的支持，在发送Ajax请求时，这些框架都会自动为请求添加<code>X-Requested-With</code>消息头。</p>
<p>jQuery中<a href="http://api.jquery.com/jQuery.ajax/#jQuery-ajax-settings" target="_blank" rel="external">jQuery.ajax( [settings ] )</a>参数部分中关于<strong><code>headers</code></strong>的描述如下:</p>
<blockquote>
<p>headers (default: {})</p>
<p>Type: PlainObject</p>
<p>An object of additional header key/value pairs to send along with requests using
the XMLHttpRequest transport. The header X-Requested-With: XMLHttpRequest is
always added, but its default XMLHttpRequest value can be changed here. Values
in the headers setting can also be overwritten from within the beforeSend
function. <strong>(version added: 1.5)</strong></p>
</blockquote>
<p>Ajax模块中的代码实现如下
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// X-Requested-With header</span></div><div class="line"><span class="comment">// For cross-domain requests, seeing as conditions for a preflight are</span></div><div class="line"><span class="comment">// akin to a jigsaw puzzle, we simply never set it to be sure.</span></div><div class="line"><span class="comment">// (it can always be set on a per-request basis or even using ajaxSetup)</span></div><div class="line"><span class="comment">// For same-domain requests, won't change header if already provided.</span></div><div class="line"><span class="keyword">if</span> ( !s.crossDomain &amp;&amp; !headers[<span class="string">"X-Requested-With"</span>] ) &#123;</div><div class="line">    headers[<span class="string">"X-Requested-With"</span>] = <span class="string">"XMLHttpRequest"</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Need an extra try/catch for cross domain requests in Firefox 3</span></div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">for</span> ( i <span class="keyword">in</span> headers ) &#123;</div><div class="line">        xhr.setRequestHeader( i, headers[ i ] );</div><div class="line">    &#125;</div><div class="line">&#125; <span class="keyword">catch</span>( err ) &#123;&#125;</div></pre></td></tr></table></figure></p>
<p>Prototype文档中<a href="http://api.prototypejs.org/ajax/" target="_blank" rel="external">Ajax Section</a>部分关于请求头的描述如下</p>
<blockquote>
<p><strong>Request headers</strong></p>
<p>The following headers are sent with all Ajax requests (and can be overridden with the
<code>requestHeaders</code> option described below):</p>
<ul>
<li><code>X-Requested-With</code> is set to <code>XMLHttpRequest</code>.</li>
<li><code>X-Prototype-Version</code> is set to Prototype’s current version (e.g.,<code>&lt;%= PROTOTYPE_VERSION %&gt;</code>).</li>
<li><code>Accept</code> is set to <code>text/javascript, text/html, application/xml, text/xml, * / *</code></li>
<li><code>Content-type</code> is automatically determined based on the <code>contentType</code> and <code>encoding</code> options.</li>
</ul>
</blockquote>
<p>代码部分
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> headers = &#123;</div><div class="line">  <span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span>,</div><div class="line">  <span class="string">'X-Prototype-Version'</span>: Prototype.Version,</div><div class="line">  <span class="string">'Accept'</span>: <span class="string">'text/javascript, text/html, application/xml, text/xml, */*'</span></div><div class="line">&#125;;</div><div class="line"><span class="comment">// 省略多余部分</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> name <span class="keyword">in</span> headers)</div><div class="line">  <span class="keyword">if</span> (headers[name] != <span class="literal">null</span>)</div><div class="line">    <span class="keyword">this</span>.transport.setRequestHeader(name, headers[name]);</div><div class="line">  &#125;,</div></pre></td></tr></table></figure></p>
<p>其它框架中，<a href="https://github.com/madrobby/zepto/blob/master/src/ajax.js" target="_blank" rel="external">zepto</a>,<a href="https://github.com/yui/yui3/blob/master/src/io/js/io-base.js" target="_blank" rel="external">YUI 3</a>中，Ajax请求中都有添加<code>X-Requested-With</code>消息头。</p>
<h3 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h3><p>以jQuery为基础，服务器端使用jsp，来简单实现<code>X-Requested-With</code>的判断流程。</p>
<p>前台页面<strong>ajaxRequest.html</strong>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>X-Requested-With测试<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"http://code.jquery.com/jquery-1.10.2.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            $.ajax(&#123;</div><div class="line">                <span class="attr">url</span>:<span class="string">"readAjaxHeader.jsp"</span></div><div class="line">            &#125;);</div><div class="line"></div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>服务器端<strong>readAjaxHeader.jsp</strong>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</div><div class="line">&lt;%</div><div class="line">    String xhrHeader = request.getHeader(<span class="string">"X-Requested-With"</span>);</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(<span class="string">"XMLHttpRequest"</span>.equalsIgnoreCase(xhrHeader))&#123;</div><div class="line">        System.out.println(<span class="string">"From Ajax Request"</span>);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        System.out.println(<span class="string">"From Normal Request"</span>);</div><div class="line">    &#125;</div><div class="line">%&gt;</div></pre></td></tr></table></figure></p>
<p>部署完毕后，我使用的是Chrome浏览器，打开控制台并在浏览器中访问<strong>ajaxRequest.html</strong>页面，控制台输出信息如图示：</p>
<img src="/2014/02/15/使用X-Requested-With消息头来识别Ajax请求/1.png" alt="1.png" title="">
<p>以上显示了jQuery的Ajax请求自动添加了<code>X-Requested-With</code>消息头。此时后台控制台log显示为</p>
<pre><code>From Ajax Request
</code></pre><p>这样在后台便完成了对Ajax请求的区分。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest" target="_blank" rel="external">MDN XMLHttpRequest</a></li>
<li><a href="1">List of HTTP header fields</a></li>
<li><a href="2">Cross-domain AJAX using XMLHttpRequest</a></li>
<li><a href="http://api.jquery.com/jQuery.ajax/" target="_blank" rel="external">jQuery.ajax()</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/02/15/Tomcat下GZip文件压缩/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/02/15/Tomcat下GZip文件压缩/" itemprop="url">Tomcat下GZip文件压缩</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-02-15T00:00:00+08:00">
                2014-02-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/02/15/Tomcat下GZip文件压缩/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/02/15/Tomcat下GZip文件压缩/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>压缩网络传输的文件，通过减小文件大小，可以节省带宽，提高站点的响应速度，优化前端的页面展示体验。Tomcat中支持<a href="4">GZip</a>压缩。本篇以Tomcat7.0为例，介绍Tomcat如何开启<a href="4">GZip</a>功能。</p>
<h3 id="配置属性及说明"><a href="#配置属性及说明" class="headerlink" title="配置属性及说明"></a>配置属性及说明</h3><p>通过浏览器请求服务器资源，使用的是HTTP协议，Tomcat中server.xml配置文件中的HTTP Connector组件用来支持HTTP/1.1协议，负责处理所有的HTTP请求和响应，默认配置如下：</p>
<pre><code>&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;
         connectionTimeout=&quot;20000&quot;
         redirectPort=&quot;8443&quot; /&gt;
</code></pre><p> 需要在该配置上添加与Gzip相关的属性来开启<a href="4">GZip</a>压缩，配置如下：</p>
<pre><code>&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;
        connectionTimeout=&quot;20000&quot;
        redirectPort=&quot;8443&quot;
        compression=&quot;on&quot;
        compressionMinSize=&quot;2048&quot;
        compressableMimeType=&quot;text/html,text/xml,text/plain&quot;
        noCompressionUserAgents=&quot;Chrome&quot;/&gt;
</code></pre><p>新增的四个属性都是与GZip相关的配置，其中</p>
<ul>
<li><p><code>comprress</code> - 控制是否开启HTTP/1.1 Gzip压缩，设置为</p>
<ul>
<li><code>on</code>，开启GZip；</li>
<li><code>off</code>，关闭GZip；</li>
<li><code>force</code>，强制所有文件都进行压缩；</li>
<li><p><code>正整数数值</code>，等同于    设置为<code>on</code>并指定被压缩的数据量的最小阀值；</p>
<p>默认设置为<code>off</code>关闭。如果compress设置为<code>on</code>或数值，并且响应消息头中没有添加<code>content-length</code>消息头，数据同样会被压缩。</p>
</li>
</ul>
</li>
<li><p><code>compressableMimeType</code> - 指定允许压缩的文件的MIME类型，可以以<code>,</code>分隔符指定一个类型列表，默认为<code>text/html,text/xml,text/plain</code>。</p>
</li>
<li><code>noCompressionUserAgents</code> - 指定一个字符串，过滤HTTP请求中的<code>user-agent</code>消息头，忽略来自匹配的HTTP客户端的<a href="4">GZip</a>压缩请求,支持正则表达式，默认为空字符串。</li>
<li><code>compressionMinSize</code> - <code>compression</code>设置为<code>on</code>后，该属性用以指定可以被压缩的数据量的最小阀值，小于该值的数据将不会被压缩，默认为<strong>2048KB</strong>。</li>
</ul>
<h3 id="基于浏览器的示例"><a href="#基于浏览器的示例" class="headerlink" title="基于浏览器的示例"></a>基于浏览器的示例</h3><p>下面围绕这几个属性介绍几个简单的示例作为解释。本机Mac OS系统，7.0.42版本的Tomcat，使用Chrome浏览器请求页面并查看测试效果。此处省略环境的配置过程，直接跳到测试环节，通过对比来查看配置的效果。</p>
<ol>
<li><p><strong>开启GZip压缩</strong></p>
<p> 默认情况下Tomcat关闭了<a href="4">GZip</a>，我们启动Tomcat，Chrome地址栏中输入<code>http://localhost:8080</code>请求Tomcat的默认页面，并打开控制台，查看默认页面的交互情况，页面如下：</p>
 <img src="/2014/02/15/Tomcat下GZip文件压缩/1.png" alt="1.png" title="">
<p> 可以看到页面(localhost)当前的大小为<strong>11.1KB</strong>，之后开启<a href="4">GZip</a>配置，</p>
<pre><code>&lt;Connector connectionTimeout=&quot;20000&quot;
      port=&quot;8080&quot;
      protocol=&quot;HTTP/1.1&quot;
      redirectPort=&quot;8443&quot;
      compression=&quot;on&quot;
      /&gt;
</code></pre><p> 重启Tomcat再次刷新页面，查看结果，如下</p>
 <img src="/2014/02/15/Tomcat下GZip文件压缩/2.png" alt="2.png" title="">
<p> <code>localhost</code>页面被压缩到了<strong>2.2KB</strong></p>
<p> 打开<code>localhost</code>页面的请求详情</p>
 <img src="/2014/02/15/Tomcat下GZip文件压缩/6.png" alt="6.png" title="">
<p> 可以看到请求消息中的消息头</p>
<pre><code>Accept-Encoding:gzip,deflate,sdch
</code></pre><p> 响应消息的消息头</p>
<pre><code>Content-Encoding:gzip
</code></pre><p> 正式这两个消息头协调浏览器和服务器完成压缩的协商过程。</p>
</li>
<li><p><strong>添加对其它类型文件压缩的支持</strong></p>
<p> 默认情况下Tomcat的<a href="4">GZip</a>压缩配置为支持<code>text/html,text/xml,text/plain</code>三种文件的类型，下面添加<code>text/css</code>类型来支持CSS文件的压缩，如下：</p>
<pre><code>&lt;Connector connectionTimeout=&quot;20000&quot;
  port=&quot;8080&quot;
  protocol=&quot;HTTP/1.1&quot;
  redirectPort=&quot;8443&quot;
  compression=&quot;on&quot;
   compressableMimeType=&quot;text/html,text/xml,text/plain,text/css&quot;
  /&gt;
</code></pre><p> 压缩前tomcat.css的大小为<strong>5.7KB</strong>,重启Tomcat，刷新页面</p>
 <img src="/2014/02/15/Tomcat下GZip文件压缩/3.png" alt="3.png" title="">
<p> tomcat.css压缩到<strong>2.0KB</strong>。要压缩其它的文件，只要将其MIME类型字符串依次添加进去即可。</p>
</li>
<li><p><strong>屏蔽来自Chrome浏览器</strong></p>
<p> 在Chrome的控制台打开locahost页面的请求详情，查看请求<code>User-Agent</code>的字符串描述</p>
 <img src="/2014/02/15/Tomcat下GZip文件压缩/4.png" alt="4.png" title="">
<pre><code>User-Agent:Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36
</code></pre><p> 配置Tomcat，添加正则表达式<code>.*Chrome.*</code>来匹配Chrome浏览器，如下</p>
<pre><code>&lt;Connector connectionTimeout=&quot;20000&quot;
      port=&quot;8080&quot;
      protocol=&quot;HTTP/1.1&quot;
      redirectPort=&quot;8443&quot;
      compression=&quot;on&quot;
      compressableMimeType=&quot;text/html,text/xml,text/plain,text/css&quot;
      noCompressionUserAgents=&quot;.*Chrome.*&quot;
      /&gt;
</code></pre><p>  重启Tomcat，刷新页面</p>
<img src="/2014/02/15/Tomcat下GZip文件压缩/5.png" alt="5.png" title="">
<p> 可以看到页面和CSS文件都未被压缩！类似的情况我们可以根据请求消息中的<code>User-Agent</code>消息头来屏蔽来自不同的浏览器或其它类型的客户端的<a href="4">GZip</a>请求。</p>
</li>
<li><p>限定可被压缩数据的最小值</p>
<p> 设置<code>compression=&#39;on&#39;</code>之后，可以使用<code>compressionMinSize</code>属性来设置可以被压缩数据的最小值，如果HTTP的响应返回的数据或文件小于<code>compressionMinSize</code>指定的值则不会被压缩，但这有一个前提是<strong>HTTP响应中必须以<code>content-length</code>消息头返回数据的总长度</strong>，否则<code>compressionMinSize</code>设置不会起作用，返回的数据或文件照样会被Tomcat压缩。</p>
<p> 由于要控制响应中<code>content-length</code>消息的设置，我们需要一个动态的JSP页面为例进行验证。Tomcat的<code>webapps</code>目录默认安装了几个web应用，其中<code>examples</code>应用中包含了一些学习jsp/servlet的实例代码，地址栏中输入<code>http://localhost:8080/examples/jsp/index.html</code>，该页面列出了所有示例代码，我们现在拷贝<code>index.html</code>页面中的HTML代码，在同级目录下新建名为<code>demo.jsp</code>的页面并将代码拷贝到其中，该页面其实还是一个纯静态的页面，现在我们关闭<a href="4">GZip</a>压缩，请求页面来查看该文件的大小，配置如下：</p>
<pre><code>&lt;Connector connectionTimeout=&quot;20000&quot;
  port=&quot;8080&quot;
  protocol=&quot;HTTP/1.1&quot;
  redirectPort=&quot;8443&quot;
  compression=&quot;off&quot;
  /&gt;
</code></pre><p> 地址栏中输入<code>http://localhost:8080/examples/jsp/demo.jsp</code>,请求该页面：</p>
 <img src="/2014/02/15/Tomcat下GZip文件压缩/7.png" alt="7.png" title="">
<p> 可以看到页面大小为<strong>18.9KB</strong>,这是页面未经压缩的原始大小。之后我们将<code>compressionMinSize</code>限定在<strong>100KB</strong>,配置如下:</p>
<pre><code>&lt;Connector connectionTimeout=&quot;20000&quot;
      port=&quot;8080&quot;
      protocol=&quot;HTTP/1.1&quot;
      redirectPort=&quot;8443&quot;
      compression=&quot;on&quot;
      compressionMinSize=&quot;102400&quot;
      /&gt;
</code></pre><p> 如上配置，想象中，当返回数据或文件小于<strong>100KB</strong>时将不会被压缩，但实际上我们重启服务器再次请求页面查看结果便知：</p>
 <img src="/2014/02/15/Tomcat下GZip文件压缩/8.png" alt="8.png" title="">
<p> 可以看到<code>demo.jsp</code>文件被压缩到了<strong>3.4KB</strong>。下面我们在<code>demo.jsp</code>页面中加入设置<code>content-length</code>响应头的代码。</p>
<pre><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%
    response.addHeader(&quot;content-length&quot;, &quot;19353&quot;);//设置大小为18.9KB
%&gt;
</code></pre><p> 再次刷新页面</p>
 <img src="/2014/02/15/Tomcat下GZip文件压缩/9.png" alt="9.png" title="">
<p> 可以看到<code>demo.jsp</code>页面没有再被压缩，<code>content-length</code>属性的设置确实发生作用。</p>
</li>
</ol>
<blockquote>
<p>注:<code>compressionMinSize</code>属性是在Tomcai7.0版本中新增的属性，Tomcat6.0中不存在该属性。</p>
</blockquote>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="1">compressionMinSize does not work on Tomcat 6</a></li>
<li><a href="2">The HTTP Connector - Tomcat6</a></li>
<li><a href="3">The HTTP Connector - Tomcat7</a></li>
<li><a href="4">GZip</a></li>
<li><a href="5">互联网媒体类型</a></li>
<li><a href="6">多用途互聯網郵件擴展</a></li>
<li><a href="7">Tomcat 7 GZIP compression not working</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="monjer" />
          <p class="site-author-name" itemprop="name">monjer</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">135</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">82</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">monjer</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"monjer"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  
















  





  

  

  

  

  

</body>
</html>
