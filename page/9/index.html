<!doctype html>




<html class="theme-next muse" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="monjer's note" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="monjer&#39;s note">
<meta property="og:url" content="http://monjer.github.io/page/9/index.html">
<meta property="og:site_name" content="monjer&#39;s note">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="monjer&#39;s note">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://monjer.github.io/page/9/"/>





  <title>monjer's note</title>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-5347284824666460",
    enable_page_level_ads: true
  });
</script>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2b4f08dbd457a5e207bff33f77b0eafc";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>











  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">monjer's note</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/06/20/Mac-OS-X下安装Homebrew/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/06/20/Mac-OS-X下安装Homebrew/" itemprop="url">Mac OS X下安装Homebrew</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-06-20T00:00:00+08:00">
                2014-06-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="什么是Homebrew"><a href="#什么是Homebrew" class="headerlink" title="什么是Homebrew"></a>什么是Homebrew</h3><p>关于Homebrew，其官网主页简单的定义为：</p>
<p><strong>The missing package manager for OS X.</strong></p>
<p>Homebrew其实就是Mac OS X下的一款开源的<strong>软件包管理器</strong>，用来安装和管理Mac OS X中未提供的需要我们自己手工安装的软件或工具。</p>
<p>关于 <strong>软件包管理系统</strong> Wiki上给出的定义是:</p>
<blockquote>
<p>软件包管理系统是在电脑中自动安装、配制、卸载和升级软件包的工具组合，在各种系统软件和应用软件的安装管理中均有广泛应用。</p>
</blockquote>
<p>那么，这也可以作为Homebrew的一个更为完整的说明。Homebrew作用与Debian的dpkg和Red Hat的RPM是类似的。</p>
<h3 id="安装Homebrew"><a href="#安装Homebrew" class="headerlink" title="安装Homebrew"></a>安装Homebrew</h3><p>安装Homebrew的需要Mac OS X 10.5及以上版本的系统。并且需要提供在Mac OS X中安装ruby,Mac OS X10.5版本之后默认已经安装了 <em>ruby</em>，打开终端可以输入以下命令查看系统中是否已经安装 <em>ruby</em> ：
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ruby -v</div></pre></td></tr></table></figure></p>
<p>如我的Mac OS X版本为10.8.5，运行以上命名在终端会输出以下内容
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ruby 1.8.7 (2012-02-08 patchlevel 358) [universal-darwin12.0]</div></pre></td></tr></table></figure></p>
<p>在确认我们的系统安装了 <em>ruby</em> 之后，安装Homebrew的过程将非常简单，根据官网提示，在终端输入以下命令，然后根据提示就可以完成Homebrew的安装：
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ruby <span class="_">-e</span> <span class="string">"<span class="variable">$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)</span>"</span></div></pre></td></tr></table></figure></p>
<p>以下是我的安装过程的截图</p>
<img src="/2014/06/20/Mac-OS-X下安装Homebrew/a1.png" alt="a1.png" title="">
<img src="/2014/06/20/Mac-OS-X下安装Homebrew/a2.png" alt="a2.png" title="">
<img src="/2014/06/20/Mac-OS-X下安装Homebrew/a3.png" alt="a3.png" title="">
<p>这样在经过几个简单的步骤后Homebrew就安装成功了。安装成功后，可以使用<code>brew</code>命令才使用Homebrew提供的管理功能，如查看Homebrew的版本:
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">www:~ manjun.han$ brew --version</div><div class="line">0.9.5</div><div class="line">www:~ manjun.han$</div></pre></td></tr></table></figure></p>
<p>查看Homebrew的安装路径，默认为<code>/usr/local</code>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">www:~ manjun.han$ brew --prefix</div><div class="line">/usr/<span class="built_in">local</span></div><div class="line">www:~ manjun.han$</div></pre></td></tr></table></figure></p>
<p>或者是查看Homebrew的构建环境
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">www:~ manjun.han$ brew --env</div><div class="line">HOMEBREW_CC: clang</div><div class="line">HOMEBREW_CXX: clang++</div><div class="line">MAKEFLAGS: -j4</div><div class="line">CMAKE_PREFIX_PATH: /usr/<span class="built_in">local</span></div><div class="line">CMAKE_INCLUDE_PATH: /usr/include/libxml2:/System/Library/Frameworks/OpenGL.framework/Versions/Current/Headers</div><div class="line">CMAKE_LIBRARY_PATH: /System/Library/Frameworks/OpenGL.framework/Versions/Current/Libraries</div><div class="line">PKG_CONFIG_LIBDIR: /usr/lib/pkgconfig:/usr/<span class="built_in">local</span>/Library/ENV/pkgconfig/10.8</div><div class="line">ACLOCAL_PATH: /usr/<span class="built_in">local</span>/share/aclocal</div><div class="line">PATH: /usr/<span class="built_in">local</span>/Library/ENV/4.3:/usr/bin:/bin:/usr/sbin:/sbin</div><div class="line">www:~ manjun.han$</div></pre></td></tr></table></figure></p>
<p>关于<code>brew</code>命令的更多详细说明，请使用<code>man brew</code>查看。</p>
<h3 id="简单的使用"><a href="#简单的使用" class="headerlink" title="简单的使用"></a>简单的使用</h3><p>关于使用Homebrew，我们最先用到的功能就是用它来帮助安装所需的软件或工具，这是最基本的需求，免去了我们对工具的下载，编译，或构建等过程。</p>
<p>在Homebrew中，每个安装的软件或工具被命名为一个<strong>方案</strong>(formula——其实就是那些被管理的package)，可以使用<code>brew install formula-name</code>命令来安装我们需要的同时Homebrew又支持的软件或工具，其中命令行中的<code>formula-name</code>为待安装的方formula名称，我们以ant为例来查看下该命令的使用过程。</p>
<p>打开终端，输入<code>brew install ant</code>,以下是我的安装过程截图</p>
<img src="/2014/06/20/Mac-OS-X下安装Homebrew/a4.png" alt="a4.png" title="">
<p>从log输出可以看到安装工具的 <em>版本号(1.9.4)</em>，<em>安装大小(39M)</em> ，以及<em>安装目录(/usr/local/Cellar/ant/1.9.4)</em>,并且如果之前该软件有未经Homebrew而安装到你的机器上时，在你使用Homebrew再次安装相同的软件时，它会给出提示。</p>
<p>这里每个formula都会被安装到自己私有目录中去，之后文件会被链接到<code>/usr/local</code>目录下，所有的formula都会被安装到<code>/usr/local/Cellar</code>目录下面，<code>Cellar</code>就是所有formula的 <strong>仓库</strong>。可以通过命令<code>brew --cellar</code>查看<code>Cellar</code>的安装路径，如
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">manjunhan:~ manjun.han$ brew --cellar</div><div class="line">/usr/<span class="built_in">local</span>/Cellar</div><div class="line">manjunhan:~ manjun.han$</div></pre></td></tr></table></figure></p>
<p>以及命令<code>brew --cellar formula-name</code>，查看formula的安装路径：
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">manjunhan:~ manjun.han$ brew --cellar ant</div><div class="line">/usr/<span class="built_in">local</span>/Cellar/ant</div><div class="line">manjunhan:~ manjun.han$</div></pre></td></tr></table></figure></p>
<p>以上只是个人关于Homebrew的一些概念的理解和最基本的用例展示，难免有误。关于Homebrew支持的formula列表，可以<a href="https://github.com/Homebrew/homebrew/tree/master/Library/Formula/" target="_blank" rel="external">在此查看</a>,也可以通过一个第三方的<a href="http://braumeister.org/" target="_blank" rel="external">开源工具</a>进行搜索，或者是通过在终端输入<code>brew search</code>来查看Homebrew当前支持的所有formula的名字。更多高级功能需要参见Homebrew在github<a href="https://github.com/Homebrew/homebrew/wiki/Installation" target="_blank" rel="external">项目wiki</a>上的描述</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://github.com/Homebrew/homebrew" target="_blank" rel="external">Homebrew Github</a></li>
<li><a href="http://brew.sh/" target="_blank" rel="external">Homebrew Homepage</a></li>
<li><a href="http://zh.wikipedia.org/wiki/%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F" target="_blank" rel="external">软件包管理系统</a></li>
<li><a href="https://developer.apple.com/library/mac/releasenotes/OpenSource/PerlExtensionsRelNotes/" target="_blank" rel="external">Creating Universal Extensions for Perl, Python and Ruby</a></li>
<li><a href="https://developer.apple.com/legacy/library/documentation/Cocoa/Conceptual/RubyPythonCocoa/Introduction/Introduction.html" target="_blank" rel="external">Ruby and Python Programming Topics for Mac</a></li>
<li><a href="https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/OSX_Technology_Overview/SoftwareProducts/SoftwareProducts.html" target="_blank" rel="external">Mac Technology Overview</a></li>
<li><a href="http://tetsu.iteye.com/blog/1507524" target="_blank" rel="external">比较Fink, macports 和 homebrew</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/06/20/Mac-OS-X下安装memcached/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/06/20/Mac-OS-X下安装memcached/" itemprop="url">Mac OS X下安装memcached</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-06-20T00:00:00+08:00">
                2014-06-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>memcache是一个C程序，依赖于最新版本的GCC编译器和一个名为<a href="http://www.monkey.org/~provos/libevent/" target="_blank" rel="external">libevent</a>的第三方库。memcache支持两种安装方式，</p>
<ul>
<li>基于Package方式，可以通过系统的package manager来安装。</li>
<li>基于源码构建方式。</li>
</ul>
<p>本文简单描述在本机Mac OS X(10.8.5)下以源码方式安装memcache的步骤。</p>
<blockquote>
<p>libevent是一个异步事件处理函数库，用来处理网络IO、定时器、信号三种事件类型的事件回调处理。</p>
</blockquote>
<h3 id="下载并安装GCC"><a href="#下载并安装GCC" class="headerlink" title="下载并安装GCC"></a>下载并安装GCC</h3><p>默认情况下Mac OS X并没有安装GCC编译器，需要我们自己手工安装。这里有两种方式。</p>
<ul>
<li><p>如果本机安装过Apple的Xcode集成开发环境，可以打开Xcode,在其菜单栏选择 <em>Preference…</em> ，之后在弹出的窗口中选择 <em>Downloads</em> 面板，在 <em>Components</em> 一栏中下载 <em>Commoand Line Tools</em> </p>
<p>  <img src="/2014/06/20/Mac-OS-X下安装memcached/a1.png" alt="a1.png" title="">}</p>
</li>
<li><p>如果本机事先没有安装Xcode的话，也可以选择到Apple的开发者站点上去单独<a href="https://developer.apple.com/downloads/index.action?=Command%20Line%20Tools%20%28OS%20X%20Mountain%20Lion%29" target="_blank" rel="external">下载</a><strong>Command Line Tools</strong>的dmg安装包，选择合适的版本下载之后直接运行安装就可以了。当然前提是你有申请Apple的开发者账号。</p>
<p>  <img src="/2014/06/20/Mac-OS-X下安装memcached/a2.png" alt="a2.png" title="">}</p>
</li>
</ul>
<p>安装完成后，打开终端来输入<code>gcc -v</code>来验证是否安装成功。安装成功后如图显示
    <img src="/2014/06/20/Mac-OS-X下安装memcached/a3.png" alt="a3.png" title="">}</p>
<h3 id="下载安装libevent"><a href="#下载安装libevent" class="headerlink" title="下载安装libevent"></a>下载安装libevent</h3><p>在的官网上下载libevent，我下载的是 <em>libevent-2.0.21-stable.tar.gz</em> ,之后切换到 <em>libevent-2.0.21-stable.tar.gz</em> 的目录，依次执行以下命令：
    <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ tar -zvxf libevent-2.0.21-stable.tar.gz</div><div class="line">$ <span class="built_in">cd</span> libevent-2.0.21-stable</div><div class="line">$ ./configure --prefix=/usr/<span class="built_in">local</span></div><div class="line">$ make</div><div class="line">$ sudo make install</div></pre></td></tr></table></figure></p>
<p>正常的话，如果安装过程中的log输出没有提示报错的话，那么libevent就已经安装完毕。可以用以下命令查看libevent安装后的结果
    <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ls /usr/<span class="built_in">local</span>/lib | grep libevent</div></pre></td></tr></table></figure></p>
<p>我这里输出显示
    <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">libevent-2.0.5.dylib</div><div class="line">libevent.a</div><div class="line">libevent.dylib</div><div class="line">libevent.la</div><div class="line">libevent_core-2.0.5.dylib</div><div class="line">libevent_core.a</div><div class="line">libevent_core.dylib</div><div class="line">libevent_core.la</div><div class="line">libevent_extra-2.0.5.dylib</div><div class="line">libevent_extra.a</div><div class="line">libevent_extra.dylib</div><div class="line">libevent_extra.la</div><div class="line">libevent_openssl-2.0.5.dylib</div><div class="line">libevent_openssl.a</div><div class="line">libevent_openssl.dylib</div><div class="line">libevent_openssl.la</div><div class="line">libevent_pthreads-2.0.5.dylib</div><div class="line">libevent_pthreads.a</div><div class="line">libevent_pthreads.dylib</div><div class="line">libevent_pthreads.la</div></pre></td></tr></table></figure></p>
<h3 id="安装memcached"><a href="#安装memcached" class="headerlink" title="安装memcached"></a>安装memcached</h3><p>首先到memcached的官网<a href="http://memcached.org/downloads" target="_blank" rel="external">下载</a>最新的memcache，当前最新版本是 <em>memcached-1.4.20.tar.gz</em> 。之后在终端中切换到 <em>memcached-1.4.20.tar.gz</em> 文件的目录，依次在终端中输入以下命令:
    <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ tar memcached-1.4.20.tar.gz</div><div class="line">$ <span class="built_in">cd</span> memcached-1.4.20.</div><div class="line">$ ./configure</div><div class="line">$ make </div><div class="line">$ sudo make install</div></pre></td></tr></table></figure></p>
<p>所有命令运行完成之后，memcache服务器现在已经成功安装到了你的机器上，默认的安装路径在<code>/usr/local/bin</code>。</p>
<p>安装完成之后，需要验证是否安装成功。使用以下命令来查看<code>memcached</code>命令行说明
    <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ man memcached</div></pre></td></tr></table></figure></p>
<p>如果有显示<code>memcached</code>命令行说明的话，那表明已经安装成功了。</p>
<h3 id="启动memcached服务器"><a href="#启动memcached服务器" class="headerlink" title="启动memcached服务器"></a>启动memcached服务器</h3><p>默认情况下，memcached服务器启动后会监听TCP的11211端口，和UDP的11211端口，可以用下面的命令按照默认的端口号设置启动memcached服务器
    <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ memcached <span class="_">-d</span></div></pre></td></tr></table></figure></p>
<p> <em>-d</em> 参数指示以守护进程(daemon)的方式运行memcached服务器，之后可以查看memcached的启动进程
    <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ps <span class="_">-a</span> | grep memcached</div></pre></td></tr></table></figure></p>
<p>我本机的输出为
    <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">manjunhan:~ manjun.han$ ps|grep memcached</div><div class="line">51685 ttys006    0:00.00 grep memcached</div><div class="line">manjunhan:~ manjun.han$</div></pre></td></tr></table></figure></p>
<p>服务器启动之后，可以使用<code>telnet</code>连接到服务器进行并输入memcached的命令与memcached服务器进行通信,如
    <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">manjunhan:~ manjun.han$ telnet localhost 11211</div><div class="line">Trying ::1...</div><div class="line">Connected to localhost.</div><div class="line">Escape character is <span class="string">'^]'</span>.</div></pre></td></tr></table></figure></p>
<p>使用<code>set</code>命令添加一个缓存条目,如添加一个名为<code>uid,</code>值为<code>1</code>的条目</p>
<pre><code>set uid 0 0 1
1
daemon
</code></pre><p>使用<code>get</code>命令获取<code>uid</code>的值
    <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">get uid</div><div class="line">VALUE uid 0 1</div><div class="line">1</div><div class="line">END</div></pre></td></tr></table></figure></p>
<p>使用<code>stats</code>命令查看memcache服务器的运行状况
    <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">stats</div><div class="line">STAT pid 47659</div><div class="line">STAT uptime 99699</div><div class="line">STAT time 1403169221</div><div class="line">STAT version 1.4.13</div><div class="line">STAT libevent 2.0.17-stable</div><div class="line">STAT pointer_size 64</div><div class="line">STAT rusage_user 0.600472</div><div class="line">STAT rusage_system 0.886140</div><div class="line">STAT curr_connections 10</div><div class="line">STAT total_connections 25</div><div class="line">STAT connection_structures 20</div><div class="line">STAT reserved_fds 20</div><div class="line">STAT cmd_get 19</div><div class="line">STAT cmd_set 20</div><div class="line">STAT cmd_flush 1</div><div class="line">STAT cmd_touch 0</div><div class="line">STAT get_hits 11</div><div class="line">STAT get_misses 8</div><div class="line">STAT delete_misses 0</div><div class="line">STAT delete_hits 2</div><div class="line">STAT incr_misses 0</div><div class="line">STAT incr_hits 0</div><div class="line">STAT decr_misses 0</div><div class="line">STAT decr_hits 0</div><div class="line">STAT cas_misses 1</div><div class="line">STAT cas_hits 0</div><div class="line">STAT cas_badval 2</div><div class="line">STAT touch_hits 0</div><div class="line">STAT touch_misses 0</div><div class="line">STAT auth_cmds 0</div><div class="line">STAT auth_errors 0</div><div class="line">STAT bytes_read 1087</div><div class="line">STAT bytes_written 2076</div><div class="line">STAT limit_maxbytes 67108864</div><div class="line">STAT accepting_conns 1</div><div class="line">STAT listen_disabled_num 0</div><div class="line">STAT threads 4</div><div class="line">STAT conn_yields 0</div><div class="line">STAT hash_power_level 16</div><div class="line">STAT hash_bytes 524288</div><div class="line">STAT hash_is_expanding 0</div><div class="line">STAT expired_unfetched 1</div><div class="line">STAT evicted_unfetched 0</div><div class="line">STAT bytes 341</div><div class="line">STAT curr_items 5</div><div class="line">STAT total_items 12</div><div class="line">STAT evictions 0</div><div class="line">STAT reclaimed 1</div><div class="line">END</div></pre></td></tr></table></figure></p>
<p>输入<code>quit</code>结束并退出telnet连接会话</p>
<p>此外，可以使用<code>killall</code>命令停止memcached服务器：
    <figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ killall memcached</div></pre></td></tr></table></figure></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://www.monkey.org/~provos/libevent/" target="_blank" rel="external">libevent</a></li>
<li><a href="http://zh.wikipedia.org/wiki/Libevent" target="_blank" rel="external">libevent wiki</a></li>
<li><a href="http://stackoverflow.com/questions/9353444/how-to-use-install-gcc-on-mac-os-x-10-8-xcode-4-4" target="_blank" rel="external">How to use/install gcc on Mac OS X 10.8 / Xcode 4.4</a></li>
<li><a href="http://memcached.org/downloads" target="_blank" rel="external">memcached download</a></li>
<li><a href="https://code.google.com/p/memcached/wiki/NewCommands" target="_blank" rel="external">memcached Protocol Commands</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/06/20/Tomcat访问控制配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/06/20/Tomcat访问控制配置/" itemprop="url">Tomcat访问控制配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-06-20T00:00:00+08:00">
                2014-06-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Tomcat提供基于主机名和IP两种方式，提供访问控制功能，达到过滤请求的效果，可以限定应用只能被指定的主机或IP访问，也可以拒绝指定的主机或IP访问的请求。Tomcat通过两个特殊的<strong>Value配置</strong>来实现访问控制，其中<code>RemoteHostValve</code>实现基于主机名的过滤，<code>RemoteAddrValve</code>实现基于IP地址的过滤，二者的配置过程类似，</p>
<ul>
<li>支持<code>deny</code>和<code>allow</code>两种模式。</li>
<li>每个模式均已正则表达式的方式来添加访问控制列表项。</li>
<li>支持<code>denyStatus</code>配置，自定义被拒绝请求的HTTP响应状态码(默认为403)。</li>
<li>试用范围为<strong>Engine</strong>,<strong>Host</strong>,<strong>Context</strong></li>
</ul>
<p>在Tomcat的<code>conf/server.xml</code>或<code>$CATALINA_HOME/Catalina/{host_name}/{app_name}.xml</code>配置文件中，通过<code>&lt;Value\/&gt;</code>标签可以添加访问控制并指定控制规则。</p>
<h3 id="基于IP地址的访问控制RemoteAddrValve"><a href="#基于IP地址的访问控制RemoteAddrValve" class="headerlink" title="基于IP地址的访问控制RemoteAddrValve"></a>基于IP地址的访问控制<code>RemoteAddrValve</code></h3><p>基于IP地址的访问控制，服务器会获取提交请求的客户端的IP地址，来匹配访问控制列表。</p>
<p>如，限定名为<code>myApp</code>的应用只能在本地访问
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">"/myApp"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">Value</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.valves.RemoteAddrValve"</span></span></div><div class="line">    	 <span class="attr">allow</span>=<span class="string">"127.0.0.1"</span> <span class="attr">deny</span>=<span class="string">""</span>&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="基于主机名的访问控制RemoteHostValve"><a href="#基于主机名的访问控制RemoteHostValve" class="headerlink" title="基于主机名的访问控制RemoteHostValve"></a>基于主机名的访问控制<code>RemoteHostValve</code></h3><p>基于主机名的访问控制，服务器会获取提交请求的客户端的主机名称，来匹配访问控制列表。</p>
<p>如，限定<code>myApp</code>应用拒绝来自名为<code>www.dangersite.com</code>的请求
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">"/myApp"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">Value</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.valves.RemoteHostValve"</span></span></div><div class="line">    	 <span class="attr">allow</span>=<span class="string">""</span> <span class="attr">deny</span>=<span class="string">"www\.dangersite\.com"</span>&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>需要注意的是，在基于主机名的过滤过程，在<code>Connector</code>配置中必须开启<strong>DNS查询</strong>功能，因为Tomcat是通过<code>ServletRequest.getRemoteHost()</code>的方式来获取主机名称的。Tomcat首先获取提交请求主机的IP地址，然后通过DNS查询方式获取该IP地址对应的主机名，之后在与过滤规则进行匹配。<a href="http://tomcat.apache.org/tomcat-7.0-doc/config/http.html" target="_blank" rel="external">HTTP Connector</a>中通过设置<code>enableLookups</code>属性为<code>true</code>,可以开启DNS查询功能，但因为这个DNS查询的过程会影响Tomcat服务器的性能，因此默认情况下<a href="http://tomcat.apache.org/tomcat-7.0-doc/config/http.html" target="_blank" rel="external">HTTP Connector</a>不支持DNS查询的，因此<code>ServletRequest.getRemoteHost()</code>获取到的是提交请求的主机的IP地址。</p>
<blockquote><p><code>RemoteHostValve</code>中关于过滤请求的入口方法调用
    <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(Request request, Response response)</span></span></div><div class="line">              <span class="keyword">throws</span> IOException, ServletException &#123;</div><div class="line">      process(request.getRequest().getRemoteHost(), request, response);</div><div class="line">     &#125;</div><div class="line">     </div></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="扩大访问控制的范围"><a href="#扩大访问控制的范围" class="headerlink" title="扩大访问控制的范围"></a>扩大访问控制的范围</h3><p>以上描述都是基于单应用的访问控制，<code>&lt;Value&gt;</code>是配置在<code>&lt;Context&gt;</code>下面的，此外可以通过在<code>&lt;Host&gt;</code>或<code>&lt;Engine&gt;</code>下来添加<code>&lt;Value&gt;</code>配置以扩大访问控制的粒度。如，
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">"localhost"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">Value</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.valves.RemoteHostValve"</span></span></div><div class="line">    	 <span class="attr">allow</span>=<span class="string">""</span> <span class="attr">deny</span>=<span class="string">"www\.dangersite\.com"</span>&gt;</div><div class="line">   	<span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">"appA"</span>/&gt;</span></div><div class="line">   	<span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">"appB"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>以上的配置会阻止<code>www.dangersite.com</code>主机访问<code>localhost</code>下任何一个应用。</p>
<h3 id="自定义HTTP响应状态码"><a href="#自定义HTTP响应状态码" class="headerlink" title="自定义HTTP响应状态码"></a>自定义HTTP响应状态码</h3><p>开启访问控制后，被拒绝的请求，Tomcat定义一个HTTP响应状态码，以说明请求失败的原因，可通过<code>&lt;Value&gt;</code>的<code>denyStatus</code>属性来设置该状态码，该属性的默认值为<code>403</code>（拒绝请求）。如，我们可以配置该属性的值为404，
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">"/myApp"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">Value</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.valves.RemoteAddrValve"</span></span></div><div class="line">    	 <span class="attr">allow</span>=<span class="string">"127.0.0.1"</span> <span class="attr">deny</span>=<span class="string">""</span> <span class="attr">denyStatus</span>=<span class="string">"404"</span>&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>这样，外网发送到<code>myApp</code>的请求，都会被重定返回404错误，我们可以配置<code>myApp</code>的<code>web.xml</code>来自定义发生404错误后的跳转，如
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></div><div class="line">  	<span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></div><div class="line">  	<span class="tag">&lt;<span class="name">location</span>&gt;</span>/404.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://tomcat.apache.org/tomcat-7.0-doc/config/http.html" target="_blank" rel="external">The HTTP Connector</a></li>
<li><a href="http://tomcat.apache.org/tomcat-7.0-doc/config/valve.html#Access_Control" target="_blank" rel="external">Access Control</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/06/10/Firefox-v23以后Javascript的禁用设置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/06/10/Firefox-v23以后Javascript的禁用设置/" itemprop="url">Firefox v23以后Javascript的禁用设置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-06-10T00:00:00+08:00">
                2014-06-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>早期版本的Firefox在首选项的<strong>高级</strong>选项面板中可以设置浏览器中javascript的启用状态，Firefox V23版本后将javascript的设置从首选项面板中移除。在<a href="https://www.mozilla.org/en-US/firefox/23.0.1/releasenotes/" target="_blank" rel="external">Firefox V23发布说明</a>中，关于该移除”Enable JavaScript”设置的变更说明如下：</p>
<blockquote>
<p>“Enable JavaScript” preference checkbox has been removed and user-set values will be reset to the default</p>
</blockquote>
<p>关于移除禁用javascript的功能，在Firefox的<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=873709" target="_blank" rel="external">Bug 873709</a>中有关于为什么移除禁用javascript复选框的说明。大意是Firefox选项面板中提供的禁用javascript的功能会让用户感到困惑，对于没有编程经验的普通用户来说，他们不清楚在设置或更改javascript选项后会有什么后果，用户在禁用javascript后，会导致加载的新页面无法正常显示或工作，不但浪费了web开发者提供的页面功能，更严重的是这使得用户体验变得糟糕。而且，随着Web技术的发展，网页提供的功能和服务也越来越丰富，越来越多的用户依赖于浏览器来获得他们所需要的Web服务，所有这些的都极大的依赖Javascript来实现。基于这些考虑，所以V23及以后版本的Firefox将javascript禁用的功能从选项面板中移除出去。</p>
<h3 id="Firefox-v23之后的javascript禁用设置"><a href="#Firefox-v23之后的javascript禁用设置" class="headerlink" title="Firefox v23之后的javascript禁用设置"></a>Firefox v23之后的javascript禁用设置</h3><p>虽然在v23以后的Firefox中，无法在选项面板中进行javascript的设置，但还有其它的方式来完成该功能。</p>
<h4 id="方式一：使用Firefox的about-config"><a href="#方式一：使用Firefox的about-config" class="headerlink" title="方式一：使用Firefox的about:config"></a><strong>方式一：</strong>使用Firefox的<strong>about:config</strong></h4><ol>
<li><p>在Firefox中打开新的空白页面，在地址栏中输入<code>about:config</code>,并回车确定,在显示的页面中点击<strong>我保证小心</strong>的按钮。</p>
 <img src="/2014/06/10/Firefox-v23以后Javascript的禁用设置/1.png" alt="1.png" title="">
</li>
<li><p>在新页面顶部的搜索框中，输入关键字<strong>javascript</strong>，并找到<code>javascript.enable</code>选项，该选项就是用来控制firefox是否禁用javascript，默认为<code>true</code>，启用javascript</p>
 <img src="/2014/06/10/Firefox-v23以后Javascript的禁用设置/2.png" alt="2.png" title="">
</li>
<li><p>在列表中双击<code>javascript.enable</code>选项，可以看到该选项值被设置为了<code>false</code>，同时状态变为了<code>用户设置</code>,这样就禁用了Firefox中的脚本。</p>
 <img src="/2014/06/10/Firefox-v23以后Javascript的禁用设置/3.png" alt="3.png" title="">
</li>
</ol>
<h4 id="方式二：使用NoScript插件"><a href="#方式二：使用NoScript插件" class="headerlink" title="方式二：使用NoScript插件"></a>方式二：使用NoScript插件</h4><ol>
<li>在Firefox的菜单栏中，点击<em>工具</em>&gt;<em>附加选项</em></li>
<li>在附加组件页面中搜索<strong>NoScript</strong>插件，并安装 <img src="/2014/06/10/Firefox-v23以后Javascript的禁用设置/4.png" alt="4.png" title=""></li>
<li>安装成功后在Firefox的顶部工具条上会有NoScript的按钮，点击该按钮，会显示当前加载页面上所有来源的脚本，并允许我们根据来源选择性的禁用。 <img src="/2014/06/10/Firefox-v23以后Javascript的禁用设置/5.png" alt="5.png" title="">
</li>
</ol>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://www.mozilla.org/en-US/firefox/23.0.1/releasenotes/" target="_blank" rel="external">Firefox V23发布说明</a></li>
<li><a href="ftp://ftp.mozilla.org/pub/firefox/releases/" target="_blank" rel="external">Firefox各版本FTP下载地址</a></li>
<li><a href="https://support.mozilla.org/zh-CN/kb/%E9%A6%96%E9%80%89%E9%A1%B9%E7%AA%97%E5%8F%A3%20-%20%E5%AE%89%E5%85%A8%E9%9D%A2%E6%9D%BF?redirectlocale=en-US&amp;as=u&amp;redirectslug=Options+window+-+Security+panel&amp;utm_source=inproduct" target="_blank" rel="external">首选项窗口 - 安全面板</a></li>
<li><a href="https://addons.mozilla.org/zh-CN/firefox/addon/noscript/" target="_blank" rel="external">Firefox附加组件:<strong>NoScript</strong></a></li>
<li><a href="https://support.mozilla.org/zh-CN/questions/994809?esab=a&amp;s=javascript&amp;r=3&amp;as=s" target="_blank" rel="external">How to disable javascript in Firefox 29.0 ?</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/06/09/更改Tomcat虚拟主机的默认Web-Application/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/06/09/更改Tomcat虚拟主机的默认Web-Application/" itemprop="url">更改Tomcat虚拟主机的默认Web Application</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-06-09T00:00:00+08:00">
                2014-06-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Tomcat默认打开的Web-Application说明"><a href="#Tomcat默认打开的Web-Application说明" class="headerlink" title="Tomcat默认打开的Web Application说明"></a>Tomcat默认打开的Web Application说明</h3><p>在Tomcat的配置中，<strong>Context</strong>元素代表了服务器上部署的一个Web Application，所有的Web Application都要部署在所属的虚拟主机（由<strong>Host</strong>元素指定）对应的文件目录下面。默认的Tomcat配置下，打开<code>conf/server.xml</code>配置文件，默认虚拟主机配置如下：
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">"localhost"</span>  <span class="attr">appBase</span>=<span class="string">"webapps"</span> <span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- SingleSignOn valve, share authentication between web applications</span></div><div class="line">     Documentation at: /docs/config/valve.html --&gt;</div><div class="line"><span class="comment">&lt;!--</span></div><div class="line">&lt;Valve className="org.apache.catalina.authenticator.SingleSignOn" /&gt;</div><div class="line">--&gt;</div><div class="line"></div><div class="line"><span class="comment">&lt;!-- Access log processes all example.</span></div><div class="line">     Documentation at: /docs/config/valve.html</div><div class="line">     <span class="doctag">Note:</span> The pattern used is equivalent to using pattern="common" --&gt;</div><div class="line"><span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.valves.AccessLogValve"</span> <span class="attr">directory</span>=<span class="string">"logs"</span></span></div><div class="line">       <span class="attr">prefix</span>=<span class="string">"localhost_access_log."</span> <span class="attr">suffix</span>=<span class="string">".txt"</span></div><div class="line">       <span class="attr">pattern</span>=<span class="string">"%h %l %u %t &amp;quot;%r&amp;quot; %s %b"</span> /&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>以Tomcat的安装目录(_$CATALINA_BASE_)目录为基准目录的<code>webapps</code>文件夹下包含了虚拟主机<code>locahost</code>的所有Web Appliactions,默认安装有以下几个application</p>
<ul>
<li><strong>Root</strong></li>
<li><strong>docs</strong></li>
<li><strong>examples</strong></li>
<li><strong>host-manager</strong></li>
<li><strong>manager</strong></li>
</ul>
<p>启动Tomcat之后，输入<code>http://location:8080</code>,默认加载的是<code>webapps</code>文件下的<code>Root</code>应用，显示的也就是Tomcat的信息页面，一般用来测试Tomcat是否安装成功。如我本机安装的7.0.50版本的Tomcat的默认打开目录：</p>
<img src="/2014/06/09/更改Tomcat虚拟主机的默认Web-Application/1.png" alt="1.png" title="">
<h3 id="Tomcat中context-path的匹配过程"><a href="#Tomcat中context-path的匹配过程" class="headerlink" title="Tomcat中context path的匹配过程"></a>Tomcat中context path的匹配过程</h3><p>每个虚拟主机下面可以同时部署N多个Context，要求是每个Context都必须有唯一的context name，无特殊情况下context name和context path是一样的。当<strong>Host</strong>元素的 <code>autoDeploy</code>和<code>deployOnStartup</code>选项设置为<code>true</code>时，Tomcat在启动时会以部署在<code>webapps</code>下的web application的根目录名称来自动生成<strong>同名的</strong>context name 和 context path。例如，我们要部署名为appA，appB的web application到Tomcat中，最简单的方式是在默认配置下直接将appA，appB的工程目录和文件文件分别放置到webapps目录下面，如：</p>
<pre><code>webapps
    --&gt; appA
        --&gt; WEB-INF
            --&gt; web.xml
        --&gt; app-files            
        --&gt; login
            --&gt;index.jsp
        --&gt; index.jsp
        --&gt; *.html
        --&gt; *.jsp

    --&gt; appB
        --&gt; WEB-INF
            --&gt; web.xml
        --&gt; app-files            
        --&gt; login
            --&gt;index.jsp
        --&gt; index.jsp
        --&gt; *.html
        --&gt; *.jsp
</code></pre><p>这里context path，context name，base file name的关系如</p>
<table border="1" style="border:1px solid #ccc">
    <tr>
        <th>Context name</th>
        <th>Context path</th>
        <th>Base file name</th>
    </tr>
    <tr>
        <td>/appA</td>
        <td>/appA</td>
        <td>appA</td>
    </tr>
    <tr>
        <td>/appB</td>
        <td>/appB</td>
        <td>appB</td>
    </tr>
</table>

<p>以上的关系表我们可以将其简单的理解为Tomcat的context path映射表，如果收到一个请求<code>http://localhost:8080/appA/login/index.jsp</code>时，Tomcat会截取url中的的uri的前缀部分(去除URL端口号之前的部分和文件名称部分之后剩下的部分)，也就是<code>/appA/login</code>部分来依次与虚拟主机下所有的context path进行匹配，未找到的话，会从后面逐级递减，也就是继续取出<code>/appA</code>部分重复与所有context path比较，直到找到相等的context path(<code>/appA</code>)对应的Web Application，并将请求交给它处理。如果所有遍历完成之后都为找到匹配的context path，那么Tomcat会返回404错误，例如我们在浏览器中访问<code>http://localhost:8080/appC/login/index.jsp</code>。</p>
<p>前面我们已经知道，如果访问<code>http://localhost:8080</code>,Tomcat会将请求映射到默认<code>ROOT</code>应用来处理，这个又是怎么做到的呢？其实，默认情况下，<strong>HOST</strong>元素规定其包含的<strong>Context</strong>中必须有一个默认的Context，满足context path为空字符串，用来处理url中未指定Context path的请求。这个默认的Contex的context path，context name，base file name的关系如</p>
<table border="1" style="border:1px solid #ccc">
    <tr>
        <th>Context name</th>
        <th>Context path</th>
        <th>Base file name</th>
    </tr>
    <tr>
        <td>空字符串</td>
        <td>空字符串</td>
        <td>ROOT</td>
    </tr>
</table>

<p>那么其实完整的Contex的context path，context name，base file name的关系应该是</p>
<table border="1" style="border:1px solid #ccc">
    <tr>
        <th>Context name</th>
        <th>Context path</th>
        <th>Base file name</th>
    </tr>
    <tr>
        <td>/appA</td>
        <td>/appA</td>
        <td>appA</td>
    </tr>
    <tr>
        <td>/appB</td>
        <td>/appB</td>
        <td>appB</td>
    </tr>
    <tr>
        <td>空字符串</td>
        <td>空字符串</td>
        <td>ROOT</td>
    </tr>
</table>

<p>所以为添加context path的请求都交由<code>ROOT</code>应用处理。</p>
<blockquote>
<p>注：本节只是从概念上简单分析了Tomcat选择context path的逻辑过程，实际的处理过程要复杂的多，详细解释应以Tomcat的官方Doc为准。</p>
</blockquote>
<h3 id="更改Tomcat虚拟主机的默认Context"><a href="#更改Tomcat虚拟主机的默认Context" class="headerlink" title="更改Tomcat虚拟主机的默认Context"></a>更改Tomcat虚拟主机的默认Context</h3><p>实际应用中，我们需要在输入<code>http://localhost:8080</code>时，显示的是我们指定的Web Application,而不是默认的<code>ROOT</code>应用，也就是将我们指定的应用映射为服务器的root URI(“/“),以下有几种方式来达到这种效果：</p>
<ul>
<li>方式一 : 删除默认的<code>ROOT</code>应用，将你的web application命名为<code>ROOT</code>并部署上去。</li>
<li>方式二 : 将你的应用<strong>部署在<code>webapps</code>之外</strong>的目录中，在<code>$CATALINA_BASE/conf/[enginename]/[hostname]/</code>目录下新建<code>ROOT.xml</code>的文件，并将写入以下内容  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version='1.0' encoding='utf-8'?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">docBase</span>=<span class="string">"/Applications/apache-tomcat-7.0.50/appA"</span> <span class="attr">path</span>=<span class="string">""</span>/&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p><code>docBase</code>指定的是你应用的磁盘路径。</p>
<ul>
<li>方式三 : 打开<code>conf/server.xml</code>,在对应的<code>Host</code>中添加  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">"localhost"</span>  <span class="attr">appBase</span>=<span class="string">"webapps"</span> <span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Context</span> <span class="attr">docBase</span>=<span class="string">"/Applications/apache-tomcat-7.0.50/appA"</span> <span class="attr">path</span>=<span class="string">""</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>需要强调的是</strong><code>path</code>必须是空字符串，<code>docBase</code>指定的是你应用的磁盘路径，可以是绝对路径，也可以是相对于<code>webapps</code>的路径，依工程的部署情况而定。</p>
<blockquote>
<p>当<strong>Context</strong>元素的<code>docBase</code>路径是相对于<strong>Host</strong>元素的<code>appBase</code>路径的时候，一定要注意将<strong>Host</strong>元素的<code>autoDeploy</code>属性设置为<code>false</code>，以避免这个指定的web application在服务器启动时被加载两次。（一次发生server.xml中的Context配置而被部署（deployOnStartup=true），第二次发生设置autoDeploy=true而发生的自动部署。</p>
</blockquote>
<p><strong>方式一</strong>中，更好的做法是为<code>ROOT</code>应用更换新的名称，这样可以保留<code>ROOT</code>应用主页上提供的所有链接内容。</p>
<p>Tomcat的文档中不推荐在<code>conf/server.xml</code>中去添加<strong>Context</strong>元素，也就是<strong>方式三</strong>中的配置，因为这污染了该配置文件，并且<code>conf/server.xml</code>中配置的变更只有在重启Tomcat服务器后才能生效。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://tomcat.apache.org/tomcat-7.0-doc/config/context.html" target="_blank" rel="external">Tomcat7.0 The Context Container</a></li>
<li><a href="http://stackoverflow.com/questions/715506/tomcat-6-how-to-change-the-root-application" target="_blank" rel="external">Tomcat 6: How to change the ROOT application</a></li>
<li><a href="http://tomcat.apache.org/tomcat-6.0-doc/config/context.html" target="_blank" rel="external">Tomcat 6.0 The Context Container</a></li>
<li><a href="http://staraphd.blogspot.com/2009/10/change-default-root-folder-in-tomcat.html" target="_blank" rel="external">Change default ROOT folder in TOMCAT</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/06/09/设置Firebug网络日志显示个数的上限/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/06/09/设置Firebug网络日志显示个数的上限/" itemprop="url">设置Firebug网络日志显示个数的上限</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-06-09T00:00:00+08:00">
                2014-06-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用Firebug的网络面板，我们可以查看页面与服务器交互的HTTP详情，每个HTTP请求在都会以日志的格式现在在网络面板中。这些请求可以是加载文件的请求，如页面内嵌的外部CSS样式,外部JavaScript文件，图片，媒体，字体，和诸如flash插件，以及ajax请求。对于一个信息量较大页面来说，一个页面可能了N多个请求，默认情况下Firebug网络面板的日志显示格式是有上限的，查过上限的部分将不予显示。但有时我们调试查看的请求就包含在了这部分未显示的日志中，导致我们没办法调试和查看该条日志的记录。其实，日志显示的上限是以变量的形式设置的，可以设置一个较大的个数来显示所有日志。</p>
<p>以天猫首页为例，使用Firebug查看该页面的所有请求，可以看到日志很轻易的就达到了上限，因为该页面包含了许多图片资源和ajax请求，如</p>
<img src="/2014/06/09/设置Firebug网络日志显示个数的上限/1.png" alt="1.png" title="">
<p>其实，在超过日志上限的提示工具条中，可以看到在右侧有个<strong>首选项</strong>的按钮，点击这个按钮便可以设置控制网络日志个数的变量进行设置，第一次点击该按钮会弹出提示页面，该页面便是火狐的<strong>about:config</strong>页面，里面包含了关于火狐浏览器的高级设置。</p>
<img src="/2014/06/09/设置Firebug网络日志显示个数的上限/2.png" alt="2.png" title="">
<p>点击<strong>我保证会小心</strong>的按钮，继续下一步。在显示的页面中的搜索框中输入<strong>firebug</strong>关键字并找到<code>extentions.firebug.net.logLimit</code>,如</p>
<img src="/2014/06/09/设置Firebug网络日志显示个数的上限/3.png" alt="3.png" title="">
<p>望文生义一下，可以判断该变量就是用来控制网络面板日志的上限的，默认为500条，超出500条的剩余请求的日志将不显示，双击该选项，在弹出的设置框中，我们可以为该变量设置一个较大的值，我这里设置为10000，</p>
<img src="/2014/06/09/设置Firebug网络日志显示个数的上限/4.png" alt="4.png" title="">
<p>设置完成点击确定</p>
<img src="/2014/06/09/设置Firebug网络日志显示个数的上限/5.png" alt="5.png" title="">
<p>之后回去刷新页面，可以看到该页面上的所有HTTP请求的日志都显示在网络面板上了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/06/09/Tomcat中主机别名的配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/06/09/Tomcat中主机别名的配置/" itemprop="url">Tomcat中主机别名的配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-06-09T00:00:00+08:00">
                2014-06-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Tomcat的<code>server.xml</code>中<code>Host</code>元素代表着服务器上关联了一个域名的虚拟主机，通过已经在DNS服务上注册的域名，我们可以访问在该虚拟主机下部署的所有Web Application，通常情况下一个<code>Host</code>元素只需要关联一个网络名称，如
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">"www.molasync.com"</span>  <span class="attr">appBase</span>=<span class="string">"webapps"</span> <span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><code>name</code>属性代表当前虚拟主机的域名。</p>
<p>但有时一个IP地址可能在DNS服务器上注册并关联多个域名，同时我们又希望将多个域名都能统一映射到Tomcat下的同一个虚拟主机上，<code>Host</code>元素中可以添加<code>Alias</code>元素，用来提供域名别名功能，以完成多域名映射到同一虚拟主机的效果。假如需要将<code>developer.molasync.com</code>与<code>www.molasync.com</code>映射到同一个虚拟主机下，可以如下配置:
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">"www.molasync.com"</span>  <span class="attr">appBase</span>=<span class="string">"webapps"</span> <span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Alias</span>&gt;</span>developer.molasync.com<span class="tag">&lt;/<span class="name">Alias</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>当然，真实环境中这样配置的前提是需要<code>developer.molasync.com</code>和<code>www.molasync.com</code>在DNS服务器上注册Tomcat所在服务器所指向的同一IP地址，在普通PC下可以通过更改<strong>hosts文件</strong>来简单模拟这个效果，如在<strong>hosts文件</strong>中添加以下IP与域名的映射：</p>
<pre><code># hosts文件中新的ip与域名映射
127.0.0.1 developer.molasync.com
127.0.0.1 www.molasync.com
</code></pre><p>这样重启tomcat，在浏览器中输入<code>http://developer.molasync.com:8080</code>或<code>http://www.molasync.com:8080</code>，二者都会访问到同一个虚拟主机了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/05/23/MySQL中几条select结合函数获取信息的查询语句/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/05/23/MySQL中几条select结合函数获取信息的查询语句/" itemprop="url">MySQL中几条select结合函数获取信息的查询语句</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-05-23T00:00:00+08:00">
                2014-05-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="获取数据库版本信息"><a href="#获取数据库版本信息" class="headerlink" title="获取数据库版本信息"></a>获取数据库版本信息</h3><p>使用<code>version()</code>函数，如
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select version();</div></pre></td></tr></table></figure></p>
<p>返回值是以<code>-log</code>结尾的表示版本的字符串，如<code>5.1.73-log</code>    。</p>
<h3 id="获取当前会话关联的数据库名称"><a href="#获取当前会话关联的数据库名称" class="headerlink" title="获取当前会话关联的数据库名称"></a>获取当前会话关联的数据库名称</h3><p>使用<code>database()</code>函数，如
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; use <span class="built_in">test</span>;</div><div class="line">mysql&gt; select database();</div></pre></td></tr></table></figure></p>
<p>返回值是当前数据库的名称，本例中为<code>test</code>。</p>
<h3 id="获取当前连接到mysql的账户名称"><a href="#获取当前连接到mysql的账户名称" class="headerlink" title="获取当前连接到mysql的账户名称"></a>获取当前连接到mysql的账户名称</h3><p>使用<code>user()</code>函数，如
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># mysql -h localhost -u root</span></div><div class="line">mysql&gt; select user();</div></pre></td></tr></table></figure></p>
<p>返回值为<code>root@localhost</code>,其中<code>root</code>为账户名称，<code>localhost</code>为账户的连接地址。</p>
<p>可以使用字符串的截取函数，只获取用户名称，如
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select substring_index(user(),<span class="string">'@'</span>,1);</div></pre></td></tr></table></figure></p>
<p>只返回用户的名称<code>root</code>。    </p>
<h3 id="获取SQl的update，insert，delete语句执行完毕后所影响的表的行数"><a href="#获取SQl的update，insert，delete语句执行完毕后所影响的表的行数" class="headerlink" title="获取SQl的update，insert，delete语句执行完毕后所影响的表的行数"></a>获取SQl的update，insert，delete语句执行完毕后所影响的表的行数</h3><p>使用<code>row_count()</code>函数，如
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; insert into user values(<span class="string">'bob'</span>,<span class="string">'peter'</span>);</div></pre></td></tr></table></figure></p>
<p>插入两行新数据，之后执行
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select row_count();</div></pre></td></tr></table></figure></p>
<p>则返回之前<strong>insert</strong>语句所插入的行数<code>2</code>。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/05/10/iOS7下应用程序评级跳转的空白页面问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/05/10/iOS7下应用程序评级跳转的空白页面问题/" itemprop="url">iOS7下应用程序评级跳转的空白页面问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-05-10T00:00:00+08:00">
                2014-05-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>应用程序的内部的评级跳转是iOS开发中的一个最常用的模块，作用是在应用程序的内部引导用户直接跳转到App Store上的程序展示页面，来为自己收集用户评价和反馈，同时提高程序的知名度。</p>
<p>iOS6及之前，引导用户跳转到App Stroe的评价页面的代码如下，
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#define rateBaseLink  @<span class="meta-string">"itms-apps://ax.itunes.apple.com/WebObjects/MZStore.woa/wa/viewContentsUserReviews?type=Purple+Software&amp;id="</span> ;</span></div><div class="line"><span class="meta">#define AppID @<span class="meta-string">"xxxxx"</span></span></div><div class="line"></div><div class="line"><span class="built_in">NSString</span> *rateAppURLString = [reviewAppBaseURL stringByAppendingString:AppID];     </div><div class="line"></div><div class="line">[[<span class="built_in">UIApplication</span> sharedApplication] openURL:[<span class="built_in">NSURL</span> urlWithString:rateAppURLString]];</div></pre></td></tr></table></figure></p>
<p>此部分代码会直接跳转值App Stroe上程序的评级页面。</p>
<p>但在iOS7下直接使用以上的<code>rateBaseLink</code>变量指向的基准地址跳转到App Stroe时，界面在刷新等待完毕后不会显示评级页面，而显示的只是一个没有内容的空白页面。苹果iOS SDK的每次大小版本的更新或多或少都会伴随一些隐秘接口的变动，而且又没有官方正式的接口变更通知，所以也无从查证，网上找到的资料说明在iOS7下要使用以下链接地址形式来替换原来在iOS6下的地址，如：</p>
<pre><code>itms-apps://itunes.apple.com/app/idAPP_ID
</code></pre><p>其中链接地址最后的<code>APP_ID</code>代表的是应用程序的Apple ID。也就是以上的代码现在变为
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#define rateBaseLink  @<span class="meta-string">"itms-apps://itunes.apple.com/app/id"</span> ;</span></div><div class="line"><span class="meta">#define AppID xxxx</span></div><div class="line"></div><div class="line"><span class="built_in">NSString</span> *rateAppURLString = [reviewAppBaseURL stringByAppendingString:AppID];     </div><div class="line"></div><div class="line">[[<span class="built_in">UIApplication</span> sharedApplication] openURL:[<span class="built_in">NSURL</span> urlWithString:rateAppURLString]];</div></pre></td></tr></table></figure></p>
<p>尝试了下，以上链接在iOS7下调用后，应用程序的展示页面是打开了，但显示的是 <em>详情页面</em> ，用户需要点击切换到 <em>评价页面</em> 才能进行评价，虽然交互上多了一步，但无奈暂时只能以这种方式解决跳转的问题。</p>
<p>考虑到兼容iOS6和iOS7的情况，可以使用以下代码
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#define  IS_iOS7 (floor(NSFoundationVersionNumber) <span class="meta-string">&lt;= NSFoundationVersionNumber_iOS_6_1 ? false : true)</span></span></div><div class="line">#define rateBaseLink_iOS6  @"itms-apps://ax.itunes.apple.com/WebObjects/MZStore.woa/wa/viewContentsUserReviews?type=Purple+Software&amp;id=" ;</div><div class="line">#define rateBaseLink_iOS7  @"itms-apps://itunes.apple.com/app/id" ;</div><div class="line">#define AppID @"xxxx"</div><div class="line"></div><div class="line"></div><div class="line">NSString *rateAppURLString = [rateBaseLink_iOS6 stringByAppendingString:AppID];     </div><div class="line"></div><div class="line">if(IS_iOS7)&#123;</div><div class="line">    rateAppURLString = [rateBaseLink_iOS7 stringByAppendingString:AppID];    </div><div class="line">&#125;</div><div class="line"></div><div class="line">[[UIApplication sharedApplication] openURL:[NSURL urlWithString:rateAppURLString]];</div></pre></td></tr></table></figure></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://stackoverflow.com/questions/18905686/itunes-review-url-and-iOS-7-ask-user-to-rate-our-app-appstore-show-a-blank-pag/18907231#18907231" target="_blank" rel="external">iTunes review URL and iOS 7 (ask user to rate our app) AppStore show a blank page</a></li>
<li><a href="https://github.com/arashpayan/appirater" target="_blank" rel="external">appirater</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2014/05/10/关于使用Search-API获取App信息进行版本检测/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/05/10/关于使用Search-API获取App信息进行版本检测/" itemprop="url">关于使用Search API获取App信息进行版本检测</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-05-10T00:00:00+08:00">
                2014-05-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="iOS版本检测"><a href="#iOS版本检测" class="headerlink" title="iOS版本检测"></a>iOS版本检测</h3><p>一般的iOS应用程序在开发时都会在内部添加个新版本检测或提示功能，为的是当应用程序有新的版本发布时，能以最快的速度告之用户升级新的应用程序。虽然在App Store程序的底部<strong>更新</strong>一栏可以提示用户有新版本程序可以更新，但这个有赖于用户自己去打开App Store再点击更新，交互上会多几步，如果用户在使用某个应用程序时，程序会自动提示版本更新并通过一步跳转就到了更新页面，这无意是简化了更新的操作，虽然这种提示有点扰民的嫌疑，但我们通常可以设定提示的间隔来减弱这个影响。</p>
<h3 id="Search-API简介"><a href="#Search-API简介" class="headerlink" title="Search API简介"></a>Search API简介</h3><p><a href="https://www.apple.com/itunes/affiliates/resources/documentation/itunes-store-web-service-search-api.html" target="_blank" rel="external">Search API</a>是苹果针对iTunes Store,App Store,iBooks Store和Mac App Store提供的查询接口。使用该查询接口可以查询多种内容的信息，包括：<strong>apps, iBooks, movies, podcasts, music, music videos, audiobooks, and TV shows</strong>，返回的查询信息可根据需要自行使用。搜索接口的全链接格式如下：</p>
<pre><code>https://itunes.apple.com/search?parameterkeyvalue
</code></pre><p><code>parameterkeyvalue</code>指待的是查询参数，如<code>key1=value1&amp;key2=value2&amp;key3=value3</code>。</p>
<p>此外，<a href="https://www.apple.com/itunes/affiliates/resources/documentation/itunes-store-web-service-search-api.html" target="_blank" rel="external">Search API</a>提供了<strong>Lookup</strong>形式的请求，来基于ID进行（<em>iTunes IDs, UPCs/ EANs, and All Music Guide (AMG) IDs</em>）查询的方式，这种方式更快更精准。官网示例</p>
<pre><code>// 查询根据iTunes ID查询Yelp的软件
https://itunes.apple.com/lookup?id=284910350
</code></pre><p>有关<a href="https://www.apple.com/itunes/affiliates/resources/documentation/itunes-store-web-service-search-api.html" target="_blank" rel="external">Search API</a>更多的接口参数说明，调用说明，请参考苹果的官网的示例。</p>
<h3 id="版本检测的提示的实现方式"><a href="#版本检测的提示的实现方式" class="headerlink" title="版本检测的提示的实现方式"></a>版本检测的提示的实现方式</h3><p>进行版本检测的思路也比较直观，首先每个应用程序在创建时，都会为程序分配一个唯一的App ID，应用程序在每个版本正式发布时都会添加并升级一个字符串描述发布版本号<code>Version</code>(标准格式是由<code>&#39;.&#39;</code>号分割的<strong>数字</strong>组成，例如当前的版本是<code>1.0.2</code>，新的版本会在旧的基础上迭，保证下一个版本号从高位到低位都比之前的版本号要高，如新的版本可能是<code>1.0.3</code>,或<code>1.1.2</code>,再或者是<code>2.0.0</code>比<code>1.0.2</code>都要高)，这个版本号是配置在 <em>Info.plist</em> 文件中的，其所属key的名称为<code>CFBundleShortVersionString</code>，这样首先在程序内部就可以在本地拿到这个<code>Version</code>的值。以下是在Xcode5.0版本中的程序target配置图示：</p>
<img src="/2014/05/10/关于使用Search-API获取App信息进行版本检测/1.png" alt="1.png" title="">
<p>与此同时，苹果提供了<a href="https://www.apple.com/itunes/affiliates/resources/documentation/itunes-store-web-service-search-api.html" target="_blank" rel="external">Search API</a>可以方便的根据App ID来获取当前商店里最新版本程序的描述信息，以下是链接地址的格式</p>
<pre><code>https://itunes.apple.com/lookup?id=App_ID
</code></pre><p>其中<code>App_ID</code>指的就是程序创建时的<code>Apple ID</code>。App的描述信息是以JSON格式返回的，其中一项就是的应用程序的<code>Version</code>，这样我们可以拿到这个远程的<code>Version</code>描述与之前拿到的本地的<code>Version</code>描述进行比较，以获取是否由新版本的程序发布，以下是实现代码片段
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 定义版本检测后的回调</span></div><div class="line"><span class="comment">// newVersion 是否有新版本</span></div><div class="line"><span class="comment">// appInfo app的描述信息</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> (^VersionCheckCallBack)(<span class="built_in">BOOL</span> newVersion , <span class="built_in">NSDictionary</span> *appInfo);</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="built_in">NSOperationQueue</span> *urlConnectionQueue ;</div><div class="line"></div><div class="line"><span class="comment">// Search API的基准链接</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">NSString</span> *iTunesAppSearchAPILookUpBaseURL = <span class="string">@"https://itunes.apple.com/lookup?id="</span> ;</div><div class="line"></div><div class="line"><span class="comment">// Apple ID值</span></div><div class="line"><span class="meta">#define APPID @<span class="meta-string">"XXXXX"</span></span></div><div class="line"></div><div class="line"><span class="comment">// 获取当前本地的Version</span></div><div class="line">+ (<span class="built_in">NSString</span>*)appReleaseVersion</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> (<span class="built_in">NSString</span>*)[[<span class="built_in">NSBundle</span> mainBundle] objectForInfoDictionaryKey:<span class="string">@"CFBundleShortVersionString"</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 进行新版本检测</span></div><div class="line"><span class="comment">// callback 版本检测的回调</span></div><div class="line">+ (<span class="keyword">void</span>)checkAppIsNewVersion:(VersionCheckCallBack)callback</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSString</span> *appInfoLink = [iTunesAppSearchAPILookUpBaseURL stringByAppendingString:APPID];</div><div class="line">    </div><div class="line">    <span class="built_in">NSMutableURLRequest</span> *request = [[<span class="built_in">NSMutableURLRequest</span> alloc] initWithURL:[<span class="built_in">NSURL</span> URLWithString:appInfoLink]];</div><div class="line"></div><div class="line">    request.HTTPMethod = <span class="string">@"POST"</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span>(urlConnectionQueue == <span class="literal">nil</span>)&#123;</div><div class="line">        urlConnectionQueue = [[<span class="built_in">NSOperationQueue</span> alloc]init] ;</div><div class="line">    &#125;		</div><div class="line">    </div><div class="line">    [<span class="built_in">NSURLConnection</span> sendAsynchronousRequest:request	     </div><div class="line">                                       queue:urlConnectionQueue	     </div><div class="line">                           completionHandler:^(<span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *error) &#123;</div><div class="line">                               </div><div class="line">                               <span class="keyword">if</span>(!error)&#123;</div><div class="line">                                   <span class="built_in">NSError</span> *jsonParsingError = [<span class="built_in">NSError</span> new] ;</div><div class="line"></div><div class="line">                                   <span class="keyword">if</span> (!data) &#123;</div><div class="line">                                       data = [<span class="built_in">NSData</span> new];</div><div class="line">                                   &#125;</div><div class="line">                                   <span class="built_in">NSDictionary</span> *rootObj = [<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:data</div><div class="line">                                                                                           options:<span class="built_in">NSJSONReadingAllowFragments</span></div><div class="line">                                                                                             error:&amp;jsonParsingError] ;</div><div class="line">                                   <span class="comment">// 判断返回结构中是否有值	                                                                                          </span></div><div class="line">                                   <span class="built_in">NSNumber</span> *resultCount = (<span class="built_in">NSNumber</span>*)[rootObj objectForKey:<span class="string">@"resultCount"</span>];</div><div class="line">                                   </div><div class="line">                                   <span class="keyword">if</span> ([resultCount integerValue] == <span class="number">1</span>) &#123;</div><div class="line">                                       </div><div class="line">                                       <span class="built_in">NSArray</span> *resultList = (<span class="built_in">NSArray</span>*)[rootObj objectForKey:resultsKeyName];</div><div class="line">                                       </div><div class="line">                                       <span class="keyword">if</span> (!resultList || resultList.count ==<span class="number">0</span>) &#123;</div><div class="line">                                           <span class="keyword">return</span> ;</div><div class="line">                                       &#125;</div><div class="line">                                       </div><div class="line">                                       <span class="built_in">NSDictionary</span> *resultItem = (<span class="built_in">NSDictionary</span>*)[resultList objectAtIndex:<span class="number">0</span>];</div><div class="line">                                       </div><div class="line">                                       <span class="built_in">NSString</span> *remoteVersion = [resultItem objectForKey:versionKeyName];</div><div class="line">                                       </div><div class="line">                                       <span class="built_in">NSString</span> *localVersion = [<span class="keyword">self</span> appReleaseVersion];</div><div class="line">                                       </div><div class="line">                                       <span class="built_in">BOOL</span> newVersion = <span class="literal">NO</span> ;</div><div class="line">                                       </div><div class="line">                                       <span class="comment">// 需要更新</span></div><div class="line">                                       <span class="keyword">if</span> ([localVersion compare:remoteVersion] == <span class="built_in">NSOrderedAscending</span>) &#123;</div><div class="line">                                           newVersion = <span class="literal">YES</span> ;</div><div class="line">                                       &#125;</div><div class="line">                                       <span class="keyword">if</span>(callback)&#123;</div><div class="line">                                           <span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">                                               <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">                                                   </div><div class="line">                                                  callback(newVersion , rootObj);</div><div class="line">                                               &#125;);</div><div class="line">                                           &#125;</div><div class="line">                                           </div><div class="line">                                       &#125;                                   </div><div class="line">                                   &#125;	                                   </div><div class="line">                               &#125;	                               </div><div class="line">                           &#125;]; <span class="comment">// sendAsynchronousRequest end</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这样通过调用<code>checkAppIsNewVersion</code>方法，结合<code>VersionCheckCallBack</code>回调，就完成了版本检测的基本过程，具体的提示显示可根据情况来定。</p>
<h3 id="关于Search-API地址的问题"><a href="#关于Search-API地址的问题" class="headerlink" title="关于Search API地址的问题"></a>关于Search API地址的问题</h3><p>关于<a href="https://www.apple.com/itunes/affiliates/resources/documentation/itunes-store-web-service-search-api.html" target="_blank" rel="external">Search API</a>的基准链接有一点要注意的是，如果应用程序的发布国家不包含美国，那么在拼接最终的链接地址时，地址后面需要添加一个名为<code>country</code>的查询参数，该参数的值为应用程序发布国家的<strong>ISO country码</strong>,例如，美国地区的为<code>us</code>，中国地区的为<code>cn</code>,具体标识列表参见<a href="http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2" target="_blank" rel="external">ISO Country Codes</a>中的说明。默认<code>country=us</code>,如果你的应用程序不在美国上架发布的话，忽略该参数会导致上一步描述的版本检测查询获取app的描述信息返回为空，也就是代码行中
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSNumber</span> *resultCount = (<span class="built_in">NSNumber</span>*)[rootObj objectForKey:<span class="string">@"resultCount"</span>];</div></pre></td></tr></table></figure></p>
<p>中的<code>resultCount</code>的返回值为<code>0</code>    ,这样虽然你的app已上架发布，但版本检测的功能等于是无法使用的，这是程序的bug。因此如果程序只在特定的地区上架，那么查询接口的格式如下</p>
<pre><code>https://itunes.apple.com/lookup?id=xxxxxx&amp;country=xx
</code></pre><p>请不要将应用程序支持的语言与上架地区混淆，只支持中文的应用也可以在美国上架，例如iPhone版的QQ支持中文，但同样可以在美国地区上架，所以可以忽略<code>country</code>参数。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://linkmaker.itunes.apple.com/cn" target="_blank" rel="external">Link Maker</a></li>
<li><a href="https://www.apple.com/itunes/affiliates/resources/documentation/itunes-store-web-service-search-api.html" target="_blank" rel="external">Search API</a></li>
<li><a href="https://github.com/arashpayan/appirater" target="_blank" rel="external">appirater</a></li>
<li><a href="http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2" target="_blank" rel="external">ISO Country Codes</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="monjer" />
          <p class="site-author-name" itemprop="name">monjer</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">136</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">84</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">monjer</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  


</body>
</html>
