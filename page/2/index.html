<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="monjer's note" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="monjer&#39;s note">
<meta property="og:url" content="http://monjer.github.io/page/2/index.html">
<meta property="og:site_name" content="monjer&#39;s note">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="monjer&#39;s note">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://monjer.github.io/page/2/"/>





  <title>monjer's note</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2b4f08dbd457a5e207bff33f77b0eafc";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>











  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">monjer's note</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2016/05/17/button点击后的键盘事件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/17/button点击后的键盘事件/" itemprop="url">button点击后的键盘事件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-17T21:48:16+08:00">
                2016-05-17
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/05/17/button点击后的键盘事件/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/17/button点击后的键盘事件/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>在Web页面上，使用鼠标点击一个按钮<code>&lt;button&gt;</code>后，通常情况下它会获得页面的焦点，所谓页面焦点是指那个当前可以接收键盘事件的DOM元素，<code>document.activeElement</code>只读属性用来保存当前获得焦点的那个DOM元素。通常情况下我们需要为button绑定一个click事件来添加后续的交互动作，比如执行一个Action或者弹出一个窗口等等，比如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">button.addEventListener(<span class="string">'click'</span> , <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">  <span class="comment">// button的事件处理</span></div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"do something"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>这是一个比较常见的代码逻辑，但问题是在点击button后继续连续按键盘的Enter键会一直触发click绑定的事件处理，因为点击后当前button获取了焦点，问题重现如下：</p>
<iframe width="100%" height="300" src="//jsfiddle.net/za0387b6/embedded/result,html,css,js/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>上面的代码中，使用HTML的button标签创建一个按钮，并设置了一些简单样式，其中<code>.btn:focus</code>选择器指定的是button获得焦点时的外观，此处只是将button的背景色进行了变更。由以上的Demo可以看出在用鼠标点击button后，触发click的事件只是简单的打印了一行log，但与此同时button马上获得了页面焦点，因为它的背景变了。这时我们继续连续按键盘的Enter键，会发现button的click事件处理一次又一次的触发了，但当我们用鼠标点击页面的其它地方时button失去了焦点，也就不再接收键盘事件。</p>
<p>此处click只是简单的输出了log，但正常开发中此时的click事件会处理一定的业务逻辑，如果在没有跑通整个流程的话，那么用户随时误按Enter键，从而造成click事件被重复的触发，这是我们不愿意看到的。</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>以上问题的出现是button在点击后自动获得了页面焦点，所以围绕这个点可以提出以下方法来解决该问题。</p>
<h4 id="方法一，点击后取消焦点"><a href="#方法一，点击后取消焦点" class="headerlink" title="方法一，点击后取消焦点"></a>方法一，点击后取消焦点</h4><p>HTML DOM对象上拥有一个<code>blur()</code>方法，用来从当前元素上移除焦点，因此可以在点击button后马上将其焦点取消，这样button将不会再接收键盘事件，如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'.btn'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">$e</span>)</span>&#123;</div><div class="line">  <span class="keyword">this</span>.blur();</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"do somethings"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>效果如下：</p>
<iframe width="100%" height="300" p="" src="//jsfiddle.net/za0387b6/1/embedded/result,html,css,js/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>


<h4 id="方法二，使用别的标签代替button标签"><a href="#方法二，使用别的标签代替button标签" class="headerlink" title="方法二，使用别的标签代替button标签"></a>方法二，使用别的标签代替button标签</h4><p>在HTML元素中，并不是所有的元素在点击事件后都会自动获得页面焦点，也不是所有获得焦点的元素都会在按下键盘Enter键后触发click事件，不同操作系统下以及不同浏览器在处理元素获得焦点的问题上是不一致的，这里不再展开。此处我们只要用别的标签类型替换button标签来模拟button就可以了，如span，div，a标签，等等。</p>
<iframe width="100%" height="300" src="//jsfiddle.net/za0387b6/2/embedded/result,html,css,js/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>


<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button" target="_blank" rel="external">MDN button</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/activeElement" target="_blank" rel="external">MDN document.activeElement</a></li>
<li><a href="https://www.sitepoint.com/when-do-elements-take-the-focus/" target="_blank" rel="external">When Do Elements Take the Focus?</a></li>
<li><a href="http://stackoverflow.com/questions/19053181/how-to-remove-focus-around-buttons-on-click" target="_blank" rel="external">How to remove focus around buttons on click</a></li>
<li><a href="http://stackoverflow.com/questions/4763638/enter-triggers-button-click" target="_blank" rel="external">Enter triggers button click</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/tabIndex" target="_blank" rel="external">MDN HTMLElement.tabIndex</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/Keyboard-navigable_JavaScript_widgets" target="_blank" rel="external">MDN Keyboard-navigable JavaScript widgets</a></li>
<li><a href="http://w3c.github.io/html-reference/button.html" target="_blank" rel="external">W3C button</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2016/05/17/ES6笔记-Set和Map/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/17/ES6笔记-Set和Map/" itemprop="url">ES6笔记 - Set和Map</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-17T21:38:53+08:00">
                2016-05-17
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/05/17/ES6笔记-Set和Map/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/17/ES6笔记-Set和Map/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一直以来JavaScript中的集合类型只有数组Array，对于集合类型支持比较弱，因此ES6新增了新的集合类型Set和Map。</p>
<h3 id="Set类型"><a href="#Set类型" class="headerlink" title="Set类型"></a>Set类型</h3><p>Set集合用来存储一组没有重复的值，这些值可以是基本数据类型和对象类型，试图在集合中插入重复的值会被自动忽略。以下时集合的一些使用方式。</p>
<h4 id="1-集合的创建"><a href="#1-集合的创建" class="headerlink" title="1.集合的创建"></a>1.集合的创建</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>();</div></pre></td></tr></table></figure>
<h4 id="2-添加元素"><a href="#2-添加元素" class="headerlink" title="2. 添加元素"></a>2. 添加元素</h4><p>可以使用<code>add(value)</code>方法向集合中添加新元素</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">set.add(<span class="string">'string'</span>);</div><div class="line">set.add(<span class="number">10</span>);</div><div class="line">set.add(<span class="number">10</span>); <span class="comment">// 插入重复的值会被自动忽略，集合中的值永远时唯一的</span></div><div class="line">set.add(&#123;&#125;);</div><div class="line"><span class="built_in">console</span>.log(set); <span class="comment">// Set&#123;"string", 10, Object &#123;&#125;&#125;</span></div></pre></td></tr></table></figure>
<h4 id="3-元素个数"><a href="#3-元素个数" class="headerlink" title="3.元素个数"></a>3.元素个数</h4><p>集合的<code>size</code>属性保存了当前元素的个数
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(set.size); <span class="comment">//3</span></div></pre></td></tr></table></figure></p>
<h4 id="4-删除元素"><a href="#4-删除元素" class="headerlink" title="4. 删除元素"></a>4. 删除元素</h4><p>集合的<code>remove(value)</code>方法可以从集合中删除给定的元素</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">set.delete(<span class="number">10</span>);</div></pre></td></tr></table></figure>
<h4 id="5-判断元素存在与否"><a href="#5-判断元素存在与否" class="headerlink" title="5. 判断元素存在与否"></a>5. 判断元素存在与否</h4><p>集合的<code>has(value)</code>方法可以判断元素是否存在于集合中，该方法会返回一个布尔值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> exist = set.has(<span class="number">10</span>); <span class="comment">// false</span></div></pre></td></tr></table></figure>
<h4 id="6-遍历集合"><a href="#6-遍历集合" class="headerlink" title="6. 遍历集合"></a>6. 遍历集合</h4><p>与数组类型一样，Set类型上也有<code>forEach(callback , thisArg)</code>方法支持对集合元素的遍历，可以传入callback参数对每个元素进行处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">set.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">value , value , set</span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(value); <span class="comment">// string</span></div><div class="line">                      <span class="comment">// Object&#123;&#125;</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>注意forEach方法中回调函数参数的前两个都是value，因为这是为了与之前Array的<code>forEach(value , index , array)</code>在回调参数的形式上保持一致。
此外也可以forEach的第二个参数中，传入callback函数的上下文this对象，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> array = [];</div><div class="line">set.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">value , value , set</span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(value);</div><div class="line">  <span class="keyword">this</span>.push(value);</div><div class="line">&#125;,array);</div><div class="line"><span class="built_in">console</span>.log(array); <span class="comment">// ['string' , Object]</span></div></pre></td></tr></table></figure>
<h4 id="7-清空Set"><a href="#7-清空Set" class="headerlink" title="7. 清空Set"></a>7. 清空Set</h4><p>使用<code>clear()</code>方法可以清空Set中所有的元素</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">set.clear();</div><div class="line"><span class="built_in">console</span>.log(set); <span class="comment">// Set&#123;&#125;</span></div></pre></td></tr></table></figure>
<h4 id="8-Set与数组的转换"><a href="#8-Set与数组的转换" class="headerlink" title="8. Set与数组的转换"></a>8. Set与数组的转换</h4><p>数组转换为集合，只要在新建Set的时候传入数组即可，如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> array = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</div><div class="line"><span class="keyword">var</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>(array);</div><div class="line"><span class="built_in">console</span>.log(set); <span class="comment">// Set &#123;1, 2, 3&#125;</span></div></pre></td></tr></table></figure>
<p>集合转换为数组，只要使用Spread运算符即可
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]);</div><div class="line"><span class="keyword">var</span> array = [...set];</div><div class="line"><span class="built_in">console</span>.log(array); <span class="comment">// [1, 2, 3. 4]</span></div></pre></td></tr></table></figure></p>
<p>利用集合元素的唯一性，可以用来对数组进行去重操作，如
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> array = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>];</div><div class="line"><span class="keyword">var</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>(array);</div><div class="line">array = [...set];</div><div class="line"><span class="built_in">console</span>.log(array); <span class="comment">// [1, 2, 3, 4];</span></div></pre></td></tr></table></figure></p>
<h3 id="WeakSet"><a href="#WeakSet" class="headerlink" title="WeakSet"></a>WeakSet</h3><p>如果说Set是强类型Set（保存对象的引用），WeakSet类型则是弱类型Set（不保存对象的引用），WeakSet与Set的主要区别为：</p>
<ul>
<li>WeakSet中的元素只能是对象类型。</li>
<li>WeakSet中元素对象的引用都是弱类型的，如果元素没有其它强类型引用，那么这个元素就可以被垃圾回收了，也因此WeakSet是不可遍历的，因为无法保证元素的存在性。</li>
</ul>
<p>由于WeakSet的不可遍历性，因此它没有Set的<code>size</code>属性，<code>forEach()</code>方法，它只有以下几个方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">WeakSet</span>.prototype.add(value); <span class="comment">// 添加元素</span></div><div class="line"><span class="built_in">WeakSet</span>.prototype.delete(value); <span class="comment">// 删除元素</span></div><div class="line"><span class="built_in">WeakSet</span>.prototype.has(value); <span class="comment">// 判断元素是否存在</span></div></pre></td></tr></table></figure>
<p>WeakSet可以用来追踪元素的引用。</p>
<h3 id="Map类型"><a href="#Map类型" class="headerlink" title="Map类型"></a>Map类型</h3><p>先前，我们通常利用对象来模拟实现map的功能，ES6中新的Map类型正式实现了此功能。与其它语言的map类型一样，ES6中的Map也是一组key/value的映射组合，Map中的key和value都可以是基本数据类型或对象类型。相比较JavaScript对象的属性名只能为String和Symbol类型，Map的引入无疑更加方便，</p>
<h4 id="1-创建Map"><a href="#1-创建Map" class="headerlink" title="1.创建Map"></a>1.创建Map</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>();</div></pre></td></tr></table></figure>
<h4 id="2-设置key的值"><a href="#2-设置key的值" class="headerlink" title="2.设置key的值"></a>2.设置key的值</h4><p>使用<code>set(key , value)</code>将指定key对应的value存储在Map中,如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> strKey = <span class="string">'strKey'</span>,</div><div class="line">    numKey = <span class="number">4</span>,</div><div class="line">    objKey = &#123;&#125;;</div><div class="line">map.set(strKey , <span class="string">'strKeyValue'</span>);</div><div class="line">map.set(numKey , <span class="string">'numKeyValue'</span>);</div><div class="line">map.set(objKey , <span class="string">'objKeyValue'</span>);</div><div class="line"><span class="built_in">console</span>.log(map); <span class="comment">// Map &#123;"strKey" =&gt; "strKeyValue", 4 =&gt; "numKeyValue", Object &#123;&#125; =&gt; "objKeyValue"&#125;</span></div></pre></td></tr></table></figure>
<h4 id="3-判断key的值是否存在"><a href="#3-判断key的值是否存在" class="headerlink" title="3.判断key的值是否存在"></a>3.判断key的值是否存在</h4><p>使用<code>has(key)</code>方法判断给定key是否存在map中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> exist = map.has(<span class="string">'strKey'</span>);</div><div class="line"><span class="built_in">console</span>.log(exist); <span class="comment">// true</span></div></pre></td></tr></table></figure>
<h4 id="4-获取key对应的值"><a href="#4-获取key对应的值" class="headerlink" title="4.获取key对应的值"></a>4.获取key对应的值</h4><p>使用<code>get(key)</code>方法获取key是在map中值，如果不存在则返回<code>undefined</code>值，如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> val = map.get(<span class="string">'strKey'</span>);</div><div class="line"><span class="built_in">console</span>.log(val); <span class="comment">// strKeyValue</span></div><div class="line">val = map.get(<span class="string">'someKey'</span>);</div><div class="line"><span class="built_in">console</span>.log(val); <span class="comment">// undefined</span></div></pre></td></tr></table></figure>
<h4 id="5-从Map中移除某个key"><a href="#5-从Map中移除某个key" class="headerlink" title="5.从Map中移除某个key"></a>5.从Map中移除某个key</h4><p>使用<code>delete(key)</code>方法，从Map中移除给定的key对应的value，并将<code>has(key)</code>的判断值返回，如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> res = map.delete(<span class="string">'strKey'</span>);</div><div class="line"><span class="built_in">console</span>.log(res); <span class="comment">// true</span></div><div class="line">res = map.delete(<span class="string">'someKey'</span>);</div><div class="line"><span class="built_in">console</span>.log(res); <span class="comment">// false</span></div></pre></td></tr></table></figure>
<h4 id="6-返回Map中key-value映射的个数"><a href="#6-返回Map中key-value映射的个数" class="headerlink" title="6.返回Map中key/value映射的个数"></a>6.返回Map中key/value映射的个数</h4><p>Map类型中的<code>size</code>属性保存了当前Map中key/value映射的个数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> kvSize = map.size ;</div><div class="line"><span class="built_in">console</span>.log(kvSize); <span class="comment">// 2</span></div></pre></td></tr></table></figure>
<h4 id="7-Map的遍历"><a href="#7-Map的遍历" class="headerlink" title="7. Map的遍历"></a>7. Map的遍历</h4><p>Map类型与Set类型一样拥有<code>forEach(callback , thisArg)</code>用于Map遍历。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">map.forEach(map , <span class="function"><span class="keyword">function</span>(<span class="params">value , key , map</span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(key+<span class="string">": "</span>+value);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>callback回调函数，接收三个参数，依次是Map的key,value以及map对象本身。也可以指定回调函数执行时上下文this对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> anotherMap = <span class="keyword">new</span> <span class="built_in">Map</span>();</div><div class="line">map.forEach(map , <span class="function"><span class="keyword">function</span>(<span class="params">value , key , map</span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(key+<span class="string">": "</span>+value);</div><div class="line">  <span class="keyword">this</span>.set(key , value);</div><div class="line">&#125;,anotherMap);</div><div class="line"><span class="built_in">console</span>.log(anotherMap); <span class="comment">// Map &#123;4 =&gt; "numKeyValue",  Object &#123;&#125;  =&gt; "objKeyValue"&#125;</span></div></pre></td></tr></table></figure>
<h4 id="8-清空Map"><a href="#8-清空Map" class="headerlink" title="8.清空Map"></a>8.清空Map</h4><p>使用<code>clear()</code>方法可以将Map上所有的key/value依次清空</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">map.clear();</div><div class="line"><span class="built_in">console</span>.log(map.size); <span class="comment">// 0</span></div></pre></td></tr></table></figure>
<h4 id="9-Map与数组的转换"><a href="#9-Map与数组的转换" class="headerlink" title="9.Map与数组的转换"></a>9.Map与数组的转换</h4><p>数组转换为Map，需要使用二位数组，第一个元素为key，第二个元素为value</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> arr = [[<span class="number">1</span>, <span class="string">'1'</span>] , [<span class="number">2</span>, <span class="string">'2'</span>]];</div><div class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>(arr);</div><div class="line"><span class="built_in">console</span>.log(map); <span class="comment">// Map &#123;1 =&gt; "1", 2 =&gt; "2"&#125;</span></div></pre></td></tr></table></figure>
<p>使用Spread操作符，可以将Map转换为二位数组，与以上的操作互为逆序，如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> arr = [...map];</div><div class="line"></div><div class="line">arr.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">value , index , arr</span>)</span>&#123;</div><div class="line"><span class="built_in">console</span>.log(value); <span class="comment">// [1, "1"]</span></div><div class="line">                    <span class="comment">// [2, "2"]</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="WeakMap类型"><a href="#WeakMap类型" class="headerlink" title="WeakMap类型"></a>WeakMap类型</h3><p>WeakMap与WeakSet形式上类似，WeakMap上所有的key都是若类型的，因此key的类型必须时对象类型，但值可以时任意类型。WeakMap与Map的区别：</p>
<ul>
<li>key值必须是对象类型，基本数据类型是不允许的。</li>
<li>key都是弱类型，若key没有其它强类型引用，那么这个key/value实体就可以被垃圾回收了。因此，WeakMap也是不可遍历的。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">WeakMap</span>.prototype.delete(key);</div><div class="line"><span class="built_in">WeakMap</span>.prototype.get(key);</div><div class="line"><span class="built_in">WeakMap</span>.prototype.has(key);</div><div class="line"><span class="built_in">WeakMap</span>.prototype.set(key, value);</div></pre></td></tr></table></figure>
<p>完！</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set" target="_blank" rel="external">MDN Set</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakSet" target="_blank" rel="external">MDN WeakSet</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map" target="_blank" rel="external">MDN Map</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap" target="_blank" rel="external">MDN WeakMap</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2016/05/15/ES6笔记-变量的解构赋值/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/15/ES6笔记-变量的解构赋值/" itemprop="url">ES6笔记 - 变量的解构赋值</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-15T14:52:35+08:00">
                2016-05-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/05/15/ES6笔记-变量的解构赋值/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/15/ES6笔记-变量的解构赋值/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="变量解构赋值"><a href="#变量解构赋值" class="headerlink" title="变量解构赋值"></a>变量解构赋值</h3><p>在以往JavaScript日常编码中，我们通常做的最多也是最熟悉的操作是从一个选项对象中提取某些值来赋值给本地变量，如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setPersonInfo</span>(<span class="params">option</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> name = option.name ;</div><div class="line">    <span class="keyword">var</span> age = option.age ;</div><div class="line">    <span class="comment">// to do</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上例子中我们传入<code>option</code>选项对象，并把其中的<code>name</code>属性和<code>age</code>属性赋值给本地定义的同名变量来做进一步处理，当要赋值的变量个数增加或存在嵌套对象时，这种操作通常会显得十分冗繁啰嗦。好在ES6提供了<strong>变量解构赋值</strong>这一新的语法特性来解决这个问题。</p>
<p>所谓变量解构赋值，指的是将一个对象或数组的数据提取出来赋值给目标变量。基本语法如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> option = &#123;</div><div class="line">  <span class="attr">name</span>: <span class="string">'Jim'</span>,</div><div class="line">  <span class="attr">age</span>: <span class="number">20</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">let</span> &#123;name , age&#125; = option;</div><div class="line"><span class="built_in">console</span>.log(name); <span class="comment">// Jim</span></div><div class="line"><span class="built_in">console</span>.log(age); <span class="comment">// 20</span></div></pre></td></tr></table></figure>
<p>以上是将<code>option</code>对象的<code>name</code>和<code>age</code>属性分别赋值给新定义的本地变量<code>name</code>和<code>age</code>，因为名称相同，所以会直接将对象值赋值给同名变量，较之前的例子来说这样的赋值操作方便了许多，别着急，这只是变量解构赋值的基本用法，以下会继续列出其它的用法。</p>
<h3 id="对象解构"><a href="#对象解构" class="headerlink" title="对象解构"></a>对象解构</h3><h4 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h4><p>声明变量的同时，为其赋值。
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> a = &#123;<span class="attr">b</span>: <span class="number">1</span> , <span class="attr">c</span>: <span class="number">2</span>&#125;;</div><div class="line"><span class="keyword">let</span> &#123;b , c&#125; = a ;</div><div class="line"><span class="built_in">console</span>.log(b); <span class="comment">// 1</span></div><div class="line"><span class="built_in">console</span>.log(c); <span class="comment">// 2</span></div></pre></td></tr></table></figure></p>
<h4 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h4><p>在声明变量后，用解构赋值语法重新赋值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> a = &#123;<span class="attr">b</span>: <span class="number">1</span> , <span class="attr">c</span>: <span class="number">2</span>&#125;;</div><div class="line"><span class="keyword">let</span> b , c ;</div><div class="line">(&#123;b , c&#125; = a );</div><div class="line"><span class="built_in">console</span>.log(b); <span class="comment">// 1</span></div><div class="line"><span class="built_in">console</span>.log(c); <span class="comment">// 2</span></div></pre></td></tr></table></figure>
<p>以上的解构赋值必须使用括号括起来，否则左边的中括号会被当做语句块儿的标识符来识别，这是会报错。</p>
<h4 id="赋值新的变量名"><a href="#赋值新的变量名" class="headerlink" title="赋值新的变量名"></a>赋值新的变量名</h4><p>可以将提取的对象属性，赋值给新名称的变量</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> a = &#123;<span class="attr">b</span>: <span class="number">1</span> , <span class="attr">c</span>: <span class="number">2</span>&#125;;</div><div class="line">&#123;<span class="attr">b</span>: e, <span class="attr">c</span>: f&#125; = a ;</div><div class="line"><span class="built_in">console</span>.log(e); <span class="comment">// 1</span></div><div class="line"><span class="built_in">console</span>.log(f); <span class="comment">// 2</span></div></pre></td></tr></table></figure>
<p>以上在左侧使用key mapping的形式，左侧是要提取对象属性名，右侧是新的本地变量名。</p>
<h4 id="默认值"><a href="#默认值" class="headerlink" title="默认值"></a>默认值</h4><p>如果某些本地变量名所对应的属性在对象上不存在，那么该本地变量的值为<code>undefined</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> a = &#123;<span class="attr">b</span>: <span class="number">1</span> , <span class="attr">c</span>: <span class="number">2</span>&#125;;</div><div class="line"><span class="keyword">let</span> &#123;b, c , e &#125; = a ;</div><div class="line"><span class="built_in">console</span>.log(b); <span class="comment">// 1</span></div><div class="line"><span class="built_in">console</span>.log(c); <span class="comment">// 2</span></div><div class="line"><span class="built_in">console</span>.log(e); <span class="comment">// undefined</span></div></pre></td></tr></table></figure>
<p>以上由于a对象上不存在<code>e</code>属性，所以本地变量的值被默认设为<code>undefined</code>。也可以为这些因属性不存在的变量设置默认值，
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> a = &#123;<span class="attr">b</span>: <span class="number">1</span> , <span class="attr">c</span>: <span class="number">2</span>&#125;;</div><div class="line"><span class="keyword">let</span> &#123;b, c , e = <span class="literal">true</span> &#125; = a ;</div><div class="line"><span class="built_in">console</span>.log(b); <span class="comment">// 1</span></div><div class="line"><span class="built_in">console</span>.log(c); <span class="comment">// 2</span></div><div class="line"><span class="built_in">console</span>.log(e); <span class="comment">// true</span></div></pre></td></tr></table></figure></p>
<p>通过<code>e = true</code>的形式，我们为e变量设置其默认值为<code>true</code>,如果变量名称也替换为不同的名字，同样也可以设置默认属性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> a = &#123;<span class="attr">b</span>: <span class="number">1</span> , <span class="attr">c</span>: <span class="number">2</span>&#125;;</div><div class="line"><span class="keyword">let</span> &#123;b, c , <span class="attr">e</span>: f = <span class="literal">true</span> &#125; = a ;</div><div class="line"><span class="built_in">console</span>.log(b); <span class="comment">// 1</span></div><div class="line"><span class="built_in">console</span>.log(c); <span class="comment">// 2</span></div><div class="line"><span class="built_in">console</span>.log(f); <span class="comment">// true</span></div></pre></td></tr></table></figure>
<p>以上我们将名称<code>e</code>换为了<code>f</code>，并设置默认值<code>true</code>。</p>
<h4 id="嵌套赋值"><a href="#嵌套赋值" class="headerlink" title="嵌套赋值"></a>嵌套赋值</h4><p>使用同样的语法，当存在嵌套对象时，也可以使用解构赋值语法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> person = &#123;</div><div class="line">  <span class="attr">name</span>:&#123;</div><div class="line">    <span class="attr">firstName</span>: <span class="string">'Whele'</span>,</div><div class="line">    <span class="attr">lastName</span>: <span class="string">'Jim'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">age</span>: <span class="number">20</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">let</span> &#123;<span class="attr">name</span>:&#123;firstName , lastName&#125; , age&#125; = person ;</div><div class="line"><span class="built_in">console</span>.log(name); <span class="comment">// Onject &#123; firstName: 'Whele', firstName: 'Whele',</span></div><div class="line"><span class="built_in">console</span>.log(firstName); <span class="comment">// Whele</span></div><div class="line"><span class="built_in">console</span>.log(lastName);  <span class="comment">// Jim</span></div><div class="line"><span class="built_in">console</span>.log(age); <span class="comment">// 20</span></div></pre></td></tr></table></figure>
<p>以上随着嵌套层次的深入，只要按照类似语法依次递归定义即可，但通常使用场景中，少有很深的嵌套赋值。</p>
<h3 id="数组解构赋值"><a href="#数组解构赋值" class="headerlink" title="数组解构赋值"></a>数组解构赋值</h3><p>同对象解构赋值一样，ES6也支持数组解构赋值，但在语法上不同的时，数组解构直接使用的时中括号<code>[]</code>来定义变量。</p>
<h4 id="基本用法-1"><a href="#基本用法-1" class="headerlink" title="基本用法"></a>基本用法</h4><p>声明变量并赋值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> colors = [<span class="string">'#ff000'</span>, <span class="string">'#00ff00'</span>, <span class="string">'#0000ff'</span>];</div><div class="line"><span class="keyword">let</span> [r , g , b] = colors ;</div><div class="line"><span class="built_in">console</span>.log(r); <span class="comment">// #ff000</span></div><div class="line"><span class="built_in">console</span>.log(g); <span class="comment">// #00ff00</span></div><div class="line"><span class="built_in">console</span>.log(b); <span class="comment">// #0000ff</span></div></pre></td></tr></table></figure>
<h4 id="声明后赋值"><a href="#声明后赋值" class="headerlink" title="声明后赋值"></a>声明后赋值</h4><p>变量声明后，赋值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> colors = [<span class="string">'#ff000'</span>, <span class="string">'#00ff00'</span>, <span class="string">'#0000ff'</span>];</div><div class="line"><span class="keyword">let</span> r , g , b ;</div><div class="line">[r , g , b] = colors ;</div><div class="line"><span class="built_in">console</span>.log(r); <span class="comment">// #ff000</span></div><div class="line"><span class="built_in">console</span>.log(g); <span class="comment">// #00ff00</span></div><div class="line"><span class="built_in">console</span>.log(b); <span class="comment">// #0000ff</span></div></pre></td></tr></table></figure>
<h4 id="默认值-1"><a href="#默认值-1" class="headerlink" title="默认值"></a>默认值</h4><p>同样可以为变量设置默认值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> colors = [<span class="string">'#ff000'</span>, <span class="string">'#00ff00'</span>, <span class="string">'#0000ff'</span>];</div><div class="line"><span class="keyword">let</span> r , g , b ;</div><div class="line">[r=<span class="string">'#ff0'</span> , g , b , a=<span class="number">.5</span>] = colors ;</div><div class="line"><span class="built_in">console</span>.log(r); <span class="comment">// #ff000</span></div><div class="line"><span class="built_in">console</span>.log(g); <span class="comment">// #00ff00</span></div><div class="line"><span class="built_in">console</span>.log(b); <span class="comment">// #0000ff</span></div><div class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 0.5</span></div></pre></td></tr></table></figure>
<h4 id="快捷的变量值互换"><a href="#快捷的变量值互换" class="headerlink" title="快捷的变量值互换"></a>快捷的变量值互换</h4><p>以前通常在互换变量时，需要定义一个临时变量，如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = <span class="number">1</span> , b = <span class="number">2</span> ,c ;</div><div class="line">c = a ;</div><div class="line">a = b ;</div><div class="line">b = a ;</div><div class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 2</span></div><div class="line"><span class="built_in">console</span>.log(b); <span class="comment">// 1</span></div></pre></td></tr></table></figure>
<p>有了数组解构赋值后，完成以上的功能更加快捷，如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = <span class="number">1</span> , b = <span class="number">2</span> ;</div><div class="line">[b , a] = [a , b];</div><div class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 2</span></div><div class="line"><span class="built_in">console</span>.log(b); <span class="comment">// 1</span></div></pre></td></tr></table></figure>
<h4 id="数组嵌套赋值"><a href="#数组嵌套赋值" class="headerlink" title="数组嵌套赋值"></a>数组嵌套赋值</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> nums = [<span class="number">1</span>, [<span class="number">2</span> , <span class="number">3</span>] ,<span class="number">4</span>];</div><div class="line"><span class="keyword">let</span> [a , [b , c] , d] = nums ;</div><div class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 1</span></div><div class="line"><span class="built_in">console</span>.log(b); <span class="comment">// 2</span></div><div class="line"><span class="built_in">console</span>.log(c); <span class="comment">// 3</span></div><div class="line"><span class="built_in">console</span>.log(d); <span class="comment">// 4</span></div></pre></td></tr></table></figure>
<p>以上可以类别对象嵌套赋值。</p>
<h4 id="使用rest项"><a href="#使用rest项" class="headerlink" title="使用rest项"></a>使用rest项</h4><p>类别函数中的rest参数，在数组解构赋值时，也有类似的rest项，使用<code>...</code>起始，可以用来将数组剩余值赋值给一个特殊的值，如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> nums = [<span class="number">1</span>, <span class="number">2</span> , <span class="number">3</span> ,<span class="number">4</span>];</div><div class="line"><span class="keyword">let</span> [a , ...restNums] = nums ;</div><div class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 1</span></div><div class="line"><span class="built_in">console</span>.log(restNums[<span class="number">0</span>]); <span class="comment">// 2</span></div><div class="line"><span class="built_in">console</span>.log(restNums[<span class="number">1</span>]); <span class="comment">// 3</span></div><div class="line"><span class="built_in">console</span>.log(restNums[<span class="number">2</span>]); <span class="comment">// 4</span></div></pre></td></tr></table></figure>
<p>以上<code>...restNums</code>即数组解构赋值中的rest项，<code>restNums</code>是一个新的数组，保存了剩余所有值。</p>
<blockquote>
<p>注：此处rest项必须在解构的最后一个位置，否则就是语法错误。</p>
</blockquote>
<h3 id="解构参数"><a href="#解构参数" class="headerlink" title="解构参数"></a>解构参数</h3><p>在开篇起始的<code>setPersonInfo</code>函数中，我们依次取出了<code>option</code>中的属性来赋值给新定义的本地变量是非常啰嗦的，现在可以使用解构参数简化这一操作了，如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setPersonInfo</span>(<span class="params">&#123;name , age&#125;</span>)</span>&#123;</div><div class="line">    <span class="comment">// to do</span></div><div class="line">    <span class="built_in">console</span>.log(name) ;</div><div class="line">    <span class="built_in">console</span>.log(age);</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> option = &#123;</div><div class="line">  <span class="attr">name</span>: <span class="string">'Jim'</span>,</div><div class="line">  <span class="attr">age</span>: <span class="number">20</span></div><div class="line">&#125;</div><div class="line">setPersonInfo(option); <span class="comment">// Jim</span></div><div class="line">                       <span class="comment">// 20</span></div></pre></td></tr></table></figure>
<h4 id="解构参数的默认值"><a href="#解构参数的默认值" class="headerlink" title="解构参数的默认值"></a>解构参数的默认值</h4><p>一旦定义解构参数，那么在调用函数时，需要传入对应的对象，否则会报语法错误,如以上例子中，直接调用函数而不传参数时，会报语法错误
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">setPersonInfo(); <span class="comment">// 语法错误</span></div><div class="line"><span class="comment">// 内部调用等同于</span></div><div class="line">setPersonInfo()&#123;</div><div class="line">  <span class="keyword">let</span> &#123;name , age&#125; = <span class="literal">undefined</span> ;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>好在同样可以为解构参数设置默认值来解决这一问题，如
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setPersonInfo</span>(<span class="params">&#123;name , age&#125; = &#123;&#125;</span>)</span>&#123;</div><div class="line">    <span class="comment">// to do</span></div><div class="line">    <span class="built_in">console</span>.log(name) ;</div><div class="line">    <span class="built_in">console</span>.log(age);</div><div class="line">&#125;</div><div class="line"></div><div class="line">setPersonInfo(); <span class="comment">// undefined</span></div><div class="line">                 <span class="comment">// undefined</span></div></pre></td></tr></table></figure></p>
<p>再具体一点，可以分别为每个参数设置默认值，如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setPersonInfo</span>(<span class="params">&#123;name=<span class="string">'Tom'</span> , age=<span class="number">10</span>&#125; = &#123;&#125;</span>)</span>&#123;</div><div class="line">    <span class="comment">// to do</span></div><div class="line">    <span class="built_in">console</span>.log(name) ;</div><div class="line">    <span class="built_in">console</span>.log(age);</div><div class="line">&#125;</div><div class="line"></div><div class="line">setPersonInfo(); <span class="comment">// Tom</span></div><div class="line">                 <span class="comment">// 10</span></div></pre></td></tr></table></figure>
<h3 id="对象与数组混合解构"><a href="#对象与数组混合解构" class="headerlink" title="对象与数组混合解构"></a>对象与数组混合解构</h3><p>在了解了对象解构和数组解构的过程后，可以结合两者完成混合解构，如
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> arr = [<span class="number">1</span> , &#123;<span class="attr">b</span>:<span class="number">2</span>&#125; , <span class="number">10</span>]</div><div class="line"><span class="keyword">let</span> [a , &#123;b&#125; , c] = arr ;</div><div class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 1</span></div><div class="line"><span class="built_in">console</span>.log(b); <span class="comment">// 2</span></div><div class="line"><span class="built_in">console</span>.log(c); <span class="comment">// 10</span></div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> person = &#123;</div><div class="line">  <span class="attr">name</span>:<span class="string">'Jim'</span>,</div><div class="line">  <span class="attr">age</span>: <span class="number">20</span> ,</div><div class="line">  <span class="attr">scores</span>:[</div><div class="line">    <span class="number">60</span> , <span class="number">61</span> , <span class="number">62</span></div><div class="line">  ]</div><div class="line">&#125;</div><div class="line"><span class="keyword">let</span> &#123;name , <span class="attr">scores</span>: [math , english , chinese] &#125;= person ;</div><div class="line"><span class="built_in">console</span>.log(name); <span class="comment">// Jim</span></div><div class="line"><span class="built_in">console</span>.log(math); <span class="comment">// 60</span></div><div class="line"><span class="built_in">console</span>.log(english); <span class="comment">// 61</span></div><div class="line"><span class="built_in">console</span>.log(chinese); <span class="comment">// 62</span></div></pre></td></tr></table></figure>
<p>完！</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" target="_blank" rel="external">MDN Destructuring assignment</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2016/05/13/ES6笔记-Object/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/13/ES6笔记-Object/" itemprop="url">ES6笔记 - Object</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-13T23:06:31+08:00">
                2016-05-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/05/13/ES6笔记-Object/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/ES6笔记-Object/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>JavaScript是一种动态的基于原型的面向对象的程序设计语言，在JavaScript中基本上所有的值都是某种类型的对象，因此ES6进一步对JavaScript中的对象进行了强化，以方便对对象进行更快捷的操作。</p>
<h3 id="属性简洁表示法"><a href="#属性简洁表示法" class="headerlink" title="属性简洁表示法"></a>属性简洁表示法</h3><p>在同一作用域下，对象的属性可以直接使用同名的本地变量表示，在ES5中，创建一个对象的化，如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> name = <span class="string">'jim'</span>;</div><div class="line"><span class="keyword">var</span> age = <span class="number">20</span> ;</div><div class="line"><span class="keyword">var</span> person = &#123;</div><div class="line">  <span class="attr">name</span>: name,</div><div class="line">  <span class="attr">age</span>: age</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>由于<code>person</code>的<code>name</code>和<code>age</code>属性与本地变量<code>name</code>和<code>age</code>同名，在ES6中可以简写为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> name = <span class="string">'jim'</span>;</div><div class="line"><span class="keyword">var</span> age = <span class="number">20</span> ;</div><div class="line"><span class="keyword">var</span> person = &#123;name , age&#125;;</div></pre></td></tr></table></figure>
<h3 id="方法简洁表示法"><a href="#方法简洁表示法" class="headerlink" title="方法简洁表示法"></a>方法简洁表示法</h3><p>在ES5中，在对象上定义方法时，必须使用分号+关键字<code>function</code>,如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> person = &#123;</div><div class="line">  <span class="attr">sayHi</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'hi !'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ES6中，可以直接省略分号和<code>function</code>关键字，如<em><code>**</code></em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> person = &#123;</div><div class="line">  sayHi()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'hi !'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>与ES5不同的是，简洁方法中，可以调用<code>super</code>关键字。</p>
</blockquote>
<h3 id="计算属性名"><a href="#计算属性名" class="headerlink" title="计算属性名"></a>计算属性名</h3><p>ES5中对象在引用对象属性时，支持两种表示法，一种是点号表示法，另一种是字面量语法即<code>[]</code>+属性名的方式，其中属性名可以使用表达式代替，如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> person = &#123;&#125;</div><div class="line">person.name = <span class="string">"jim"</span>;</div><div class="line">person[<span class="string">'age'</span>] = <span class="number">20</span> ;</div><div class="line">或</div><div class="line"><span class="keyword">var</span> age = <span class="string">'age'</span> ;</div><div class="line">person[age] = <span class="number">20</span> ;</div></pre></td></tr></table></figure>
<p>以上，使用<code>[]</code>+属性名的方式来引用age属性，但在对象字面量中，却无法定义对象属性，ES6中将计算属性作为内置特性添加到了对象字面量中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> age = <span class="string">'age'</span> ;</div><div class="line"><span class="keyword">var</span> person = &#123;</div><div class="line">  [age]:<span class="number">20</span></div><div class="line">&#125;;</div><div class="line"><span class="built_in">console</span>.log(person[<span class="string">'age'</span>]); <span class="comment">// 20</span></div><div class="line"><span class="built_in">console</span>.log(person[age]); <span class="comment">// 20</span></div></pre></td></tr></table></figure>
<p>也可是是表达式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> prefix = <span class="string">'my_'</span> ;</div><div class="line"><span class="keyword">var</span> name = <span class="string">'name'</span> ;</div><div class="line"><span class="keyword">var</span> age = <span class="string">'age'</span>;</div><div class="line"><span class="keyword">var</span> person = &#123;</div><div class="line">  [prefix + age]: <span class="number">20</span>,</div><div class="line">  [prefix + name]: <span class="string">'Jim'</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(person[<span class="string">"my_name"</span>]);</div><div class="line"><span class="built_in">console</span>.log(person[<span class="string">"my_age"</span>]);</div></pre></td></tr></table></figure>
<h3 id="Object-is-方法"><a href="#Object-is-方法" class="headerlink" title="Object.is()方法"></a><code>Object.is()</code>方法</h3><p>在ES5中，通常我们使用非严格<code>等于==</code>或严格等于<code>===</code>进行对象或数值的比较判断，其中<code>==</code>会对左右两边的对象进行类型转换后进行比较（0 == “0”为true），<code>===</code>不会进行类型转换，类型不同肯定得到false(0 === “0”为false)ES6新增<code>Object.is()</code>方法来进行更加严格的比较，多数情况下该方法与<code>===</code>效果相同，但在处理<code>0</code>和<code>NaN</code>时却不同，如</p>
<p>console.log(+0 == -0);              // true
console.log(+0 === -0);             // true
console.log(Object.is(+0, -0));     // false</p>
<p>console.log(NaN == NaN);            // false
console.log(NaN === NaN);           // false
console.log(Object.is(NaN, NaN));   // true</p>
<h3 id="Object-assign-方法"><a href="#Object-assign-方法" class="headerlink" title="Object.assign()方法"></a><code>Object.assign()</code>方法</h3><p>在多数的工具库中都有一个称为mixin的函数，用来进行对象属性的合并或拷贝，如underscore的<code>_.extend()</code>方法，jQuery的<code>jQuery.extend()</code>方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> personA = &#123;</div><div class="line">  <span class="attr">name</span>:<span class="string">'Jim'</span>,</div><div class="line">  <span class="attr">sayHi</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> personB = &#123;</div><div class="line">  <span class="attr">name</span>:<span class="string">'Tom'</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">Object</span>.assign(personB , personA);</div><div class="line">personB.sayHi(); <span class="comment">// Tom</span></div></pre></td></tr></table></figure>
<p>也可以拷贝多个对象的属性到目标的对象上<code>Object.assign(dest , srcA , srcB);</code>。此外该方法只能拷贝源对象自身的可枚举的属性，对于访问器属性，它会调用其getter方法，然后将结果复制给目标对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> person = &#123;&#125;,</div><div class="line">    personA = &#123;</div><div class="line">    get name() &#123;</div><div class="line">     <span class="keyword">return</span> <span class="string">"Jim"</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="built_in">Object</span>.assign(person, personA);</div><div class="line"><span class="keyword">var</span> descriptor = <span class="built_in">Object</span>.getOwnPropertyDescriptor(person, <span class="string">"name"</span>);</div><div class="line"><span class="built_in">console</span>.log(descriptor.value);      <span class="comment">// Jim</span></div><div class="line"><span class="built_in">console</span>.log(descriptor.get);        <span class="comment">// undefined</span></div><div class="line"><span class="string">`</span></div></pre></td></tr></table></figure>
<h3 id="重名的对象字面量属性、"><a href="#重名的对象字面量属性、" class="headerlink" title="重名的对象字面量属性、"></a>重名的对象字面量属性、</h3><p>ES5严格模式下，当一个对象字面量的属性重名时会抛出错误</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span></div><div class="line"><span class="keyword">var</span> person = &#123;</div><div class="line">  <span class="attr">name</span>:<span class="string">'Jim'</span>,</div><div class="line">  <span class="attr">name</span>:<span class="string">'Tom'</span></div><div class="line">&#125;; <span class="comment">// 语法错误</span></div><div class="line"><span class="built_in">console</span>.log(person.name);</div></pre></td></tr></table></figure>
<p>ES6取消了这个限制，允许同名的属性出现在同一对象内，但后面的属性会覆盖前面的
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// in ES6</span></div><div class="line"><span class="meta">"use strict"</span></div><div class="line"><span class="keyword">var</span> person = &#123;</div><div class="line">  <span class="attr">name</span>:<span class="string">'Jim'</span>,</div><div class="line">  <span class="attr">name</span>:<span class="string">'Tom'</span></div><div class="line">&#125;;</div><div class="line"><span class="built_in">console</span>.log(person.name); <span class="comment">// Tom</span></div></pre></td></tr></table></figure></p>
<h3 id="自有属性的枚举顺序"><a href="#自有属性的枚举顺序" class="headerlink" title="自有属性的枚举顺序"></a>自有属性的枚举顺序</h3><p>ES5之前，在遍历对象属性的时候，属性的遍历是无序的，但ES6规定了属性的遍历顺序</p>
<ol>
<li>所有数字类型的属性最先，且按降序排序；</li>
<li>所有字符串属性按照其添加到对象中的顺序排序；</li>
<li>所有symbole属性按照其添加到对象中的顺序排序；</li>
</ol>
<h3 id="可变原型对象"><a href="#可变原型对象" class="headerlink" title="可变原型对象"></a>可变原型对象</h3><p>通常情况下，对象在创建后，其原型对象就不能在更改，可以使用<code>Object.getPrototypeOf()</code>方法获得一个对象的原型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> proto = &#123;&#125;;</div><div class="line"><span class="keyword">var</span> obj = <span class="built_in">Object</span>.create(proto);</div><div class="line"><span class="built_in">Object</span>.getPrototypeOf(obj) === proto; <span class="comment">// true</span></div></pre></td></tr></table></figure>
<p>ES5中<code>Object.getPrototypeOf()</code>方法的参数，必须是对象类型，否则会抛出异常,ES6中则没有此限制</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Object</span>.getPrototypeOf(<span class="string">"foo"</span>);</div><div class="line"><span class="comment">// ES5中，TypeError</span></div><div class="line"><span class="built_in">Object</span>.getPrototypeOf(<span class="string">"foo"</span>);</div><div class="line"><span class="comment">// ES6中，String.prototype</span></div></pre></td></tr></table></figure>
<p>ES6中对此做出了更改，添加了<code>Object.setPrototypeOf()</code>方法来更改对象的原型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> graphical = &#123;</div><div class="line">  showType()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.type);</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">let</span> rect = &#123;</div><div class="line">  <span class="attr">type</span>: <span class="string">'rect'</span></div><div class="line">&#125;;</div><div class="line"><span class="built_in">Object</span>.setPrototypeOf(rect , graphical);</div><div class="line"><span class="built_in">console</span>.log(rect.showType()) ; <span class="comment">// rect</span></div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getPrototypeOf(rect) == graphical); <span class="comment">// true</span></div></pre></td></tr></table></figure>
<h3 id="使用super访问遍历原型链"><a href="#使用super访问遍历原型链" class="headerlink" title="使用super访问遍历原型链"></a>使用<code>super</code>访问遍历原型链</h3><p>JavaScript是依赖于原型链模式来完成类的继承，ES6引入了<code>super</code>关键字来很方便的在子类中调用父类的属性和方法。</p>
<blockquote>
<p>尤其在多级继承关系下，子类覆盖父类的方法时，使用<code>super</code>会更方便的在子类中调用父类方法。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> person = &#123;</div><div class="line">  sayHi()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'person sayHi'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">let</span> chinaPerson = &#123;</div><div class="line">  sayHi()&#123;</div><div class="line">    <span class="keyword">super</span>.sayHi();</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'你好'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="built_in">Object</span>.setPrototypeOf(chinaPerson , person);</div><div class="line">chinaPerson.sayHi(); <span class="comment">// person sayHi</span></div><div class="line">                     <span class="comment">// 你好</span></div></pre></td></tr></table></figure>
<h3 id="正式的方法定义"><a href="#正式的方法定义" class="headerlink" title="正式的方法定义"></a>正式的方法定义</h3><p>在ES6之前，JavaScript中方法的概念并不是很清晰，它只是一个对象上类型为函数的属性而已，ES6中正式对方法做出了规范，每个方法内部都有一隐式的<code>[[HomeObject]]</code>属性来引用方法所属的对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> person = &#123;</div><div class="line">  sayHi()&#123; <span class="comment">// sayHi一个方法,它的[[HomeObject]]属性指向person对象</span></div><div class="line">    <span class="comment">// to do</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">syyHi</span>(<span class="params"></span>)</span>&#123; <span class="comment">// sayHi不是方法</span></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在方法中可以使用<code>super</code>关键字调用父类方法，但在普通函数中是不能使用<code>super</code>的。
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> person = &#123;</div><div class="line">  sayHi()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'person sayHi'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">let</span> chinaPerson = &#123;</div><div class="line">  sayHi()&#123;</div><div class="line">    <span class="keyword">super</span>.sayHi();</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="built_in">Object</span>.setPrototypeOf(chinaPerson , person);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">outSayHi</span>(<span class="params"></span>)</span>&#123; <span class="comment">// sayHi不是方法</span></div><div class="line">  <span class="keyword">super</span>.sayHi();</div><div class="line">&#125;</div><div class="line"></div><div class="line">chinaPerson.sayHi();  <span class="comment">// person sayHi</span></div><div class="line">outSayHi(); <span class="comment">// 错误</span></div><div class="line"></div><div class="line">chinaPerson.sayHi = outSayHi ;</div><div class="line">chinaPerson.sayHi(); <span class="comment">// 错误，outSayHi中没有[[HomeObject]]</span></div></pre></td></tr></table></figure></p>
<p>每个方法中super是通过<code>[[HomeObject]]</code>来获取父类的引用的,<code>super = Object.getProtptypeOf(HomeObject);</code>。</p>
<p>完！</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Equality_comparisons_and_sameness" target="_blank" rel="external">MDN - Equality comparisons and sameness</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/super" target="_blank" rel="external">MDN - super</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2016/05/13/ES6笔记-Function扩展/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/13/ES6笔记-Function扩展/" itemprop="url">ES6笔记 - Function扩展</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-13T23:04:44+08:00">
                2016-05-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/05/13/ES6笔记-Function扩展/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/ES6笔记-Function扩展/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>在任何的编程语言中，函数都是最基本的构建，用来将复杂的任务分解成一个个相互独立而又协同工作小的功能单元。在ES6之前，JavaScript的函数并没有很大的变化，
但ES6为JavaScript的函数带来了许多新特性，包括<strong>默认参数</strong>，<strong>rest参数</strong>，<strong>箭头函数</strong>,以下时这些特性的简单介绍。</p>
<h3 id="默认参数"><a href="#默认参数" class="headerlink" title="默认参数"></a>默认参数</h3><p>JavaScript的函数允许我们定义任意个数的参数，ES5之前函数的参数默认值为<code>undefined</code>，但是通常情况下，我们需要为函数的参数添加一个合理的默认值，而不是<code>undefined</code>，
这也是我们在使用函数时最常见的操作。</p>
<p>ES6之前我们使这样处理的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajaxCall</span>(<span class="params">url , success , fail , timeout</span>)</span>&#123;</div><div class="line">  success = success || <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125; ;</div><div class="line">  fail = fail || <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125; ;</div><div class="line">  timeout = timeout || <span class="number">1000</span> ;</div><div class="line">  <span class="comment">// ajax请求</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">ajaxCall(<span class="string">'/get.do'</span>);</div></pre></td></tr></table></figure>
<p>以上是使用逻辑或来为参数添加默认参数，因为在第一个条件为false时逻辑或总返回第二个操作数，但更加严谨的做法是严格判断参数类型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajaxCall</span>(<span class="params">url , success , fail , timeout</span>)</span>&#123;</div><div class="line">  success = (<span class="keyword">typeof</span> success == <span class="string">'undefined'</span>) ?  <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125; : success;</div><div class="line">  fail = (<span class="keyword">typeof</span> fail == <span class="string">'undefined'</span>) ?  <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125; : success;</div><div class="line">  timeout = (<span class="keyword">typeof</span> timeout == <span class="string">'undefined'</span>) ? <span class="number">1000</span> : timeout;</div><div class="line">  <span class="comment">// ajax请求</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">ajaxCall(<span class="string">'/get.do'</span>);</div></pre></td></tr></table></figure>
<p>ES6后可以使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajaxCall</span>(<span class="params">url , success= function(</span>)</span>&#123;&#125; , fail=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125; , timeout=<span class="number">1000</span>)&#123;</div><div class="line">  <span class="comment">// ajax请求</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">ajaxCall(<span class="string">'/get.do'</span>);</div></pre></td></tr></table></figure>
<p>可以对任意位置的参数给定默认值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajaxCall</span>(<span class="params">url , success= function(</span>)</span>&#123;&#125; , fail=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125; , timeout)&#123;</div><div class="line">  <span class="comment">// ajax请求</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">ajaxCall(<span class="string">'/get.do'</span>);</div><div class="line">ajaxCall(<span class="string">'/get.do'</span> , <span class="function"><span class="keyword">function</span> <span class="title">success</span>(<span class="params"></span>)</span>&#123;&#125; , <span class="function"><span class="keyword">function</span> <span class="title">fail</span>(<span class="params"></span>)</span>&#123;&#125;);</div></pre></td></tr></table></figure>
<p>还可以以表达式的形式为参数指定默认值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getValue</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a , b = getValue(</span>))</span>&#123;</div><div class="line"><span class="keyword">return</span> a+b;</div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(add(<span class="number">1</span>)); <span class="comment">// 2</span></div><div class="line"><span class="built_in">console</span>.log(add(<span class="number">3</span>)); <span class="comment">// 4</span></div></pre></td></tr></table></figure>
<p>ES5非严格模式下，参数的更改会影响<code>arguments</code>对象的值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFn</span>(<span class="params">a , b</span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(a == <span class="built_in">arguments</span>[<span class="number">0</span>]);</div><div class="line">  <span class="built_in">console</span>.log(b == <span class="built_in">arguments</span>[<span class="number">1</span>]);</div><div class="line">  a = <span class="string">'e'</span> ;</div><div class="line">  b = <span class="string">'f'</span>;</div><div class="line">  <span class="built_in">console</span>.log(a == <span class="built_in">arguments</span>[<span class="number">0</span>]);</div><div class="line">  <span class="built_in">console</span>.log(b == <span class="built_in">arguments</span>[<span class="number">1</span>]);</div><div class="line">&#125;</div><div class="line">testFn(<span class="string">'a'</span> , <span class="string">'b'</span>);</div><div class="line"><span class="comment">// true</span></div><div class="line"><span class="comment">// true</span></div><div class="line"><span class="comment">// true</span></div><div class="line"><span class="comment">// true</span></div></pre></td></tr></table></figure>
<p>ES6后，参数的更改不会影响<code>arguments</code>对象的值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFn</span>(<span class="params">a , b</span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(a == <span class="built_in">arguments</span>[<span class="number">0</span>]);</div><div class="line">  <span class="built_in">console</span>.log(b == <span class="built_in">arguments</span>[<span class="number">1</span>]);</div><div class="line">  a = <span class="string">'e'</span> ;</div><div class="line">  b = <span class="string">'f'</span>;</div><div class="line">  <span class="built_in">console</span>.log(a == <span class="built_in">arguments</span>[<span class="number">0</span>]);</div><div class="line">  <span class="built_in">console</span>.log(b == <span class="built_in">arguments</span>[<span class="number">1</span>]);</div><div class="line">&#125;</div><div class="line">testFn(<span class="string">'a'</span> , <span class="string">'b'</span>);</div><div class="line"><span class="comment">// true</span></div><div class="line"><span class="comment">// true</span></div><div class="line"><span class="comment">// false</span></div><div class="line"><span class="comment">// false</span></div></pre></td></tr></table></figure>
<h3 id="rest参数"><a href="#rest参数" class="headerlink" title="rest参数"></a>rest参数</h3><p>JavaScript函数使用<code>arguments</code>对象来保存所有传入函数的参数，<code>arguments</code>是一个arraylike对象，可以向数组那样按索引来访问每个元素，例如
<code>arguments[0]</code>代表函数的第一个参数，依次类推，通过这种方式，JavaScript的函数可以支持任意个数的参数，如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">plus</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> res = <span class="number">0</span>;</div><div class="line">  <span class="keyword">var</span> length = <span class="built_in">arguments</span>.length ;</div><div class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; length ; i++)&#123;</div><div class="line">    res += <span class="built_in">arguments</span>[i];</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> res ;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上函数<code>plus()</code>函数用来对传入的任意个数的数值进行累加计算，但可以看出<code>plus</code>函数本身至关上并没有很好的展示出可以传入任意多个参数，好在ES6添加了
剩余参数(rest parameters)以更加语义化的方式来表达这一行为，剩余参数是设计用来代替<code>arguments</code>对象的。</p>
<p>剩余参数以<code>...参数名</code>来标识，用来获取函数的剩余的参数，由这些参数组成一个数组，<code>...</code>在ES6中称为Spread运算符，如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">plus</span>(<span class="params">...values</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> res = <span class="number">0</span>;</div><div class="line">  <span class="keyword">var</span> length = values.length ;</div><div class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; length ; i++)&#123;</div><div class="line">    res += values[i];</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> res ;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上<code>...values</code>包含了所有传入<code>plus()</code>函数的数值，现在第一眼我们就能判断出<code>plus()</code>函数的参数可以时任意多个，语义上更加明确。
在使用剩余参数时，语法上也是有一些限制条件的：</p>
<ul>
<li><p>一个函数剩余参数有且仅有一个，而且必须放在函数所有参数的最后一个。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 错误，剩余参数后不能再有其它摊书</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFn</span>(<span class="params">paramA , ...restParam , paramLast</span>)</span>&#123;</div><div class="line">  <span class="comment">// to do</span></div><div class="line">&#125;</div><div class="line"><span class="comment">//错误，一个函数剩余参数有且仅有一个</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFn</span>(<span class="params">...restParamsA , ...restParamB</span>)</span>&#123;</div><div class="line">  <span class="comment">// to do</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>剩余参数不能用在对象字面量的setter方法中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> obj = &#123;</div><div class="line">  <span class="comment">// 错误</span></div><div class="line">  set values(...values)&#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>rest参数变量是一个数组类型，因此它可以使用所有数组的方法。</p>
<h3 id="name属性"><a href="#name属性" class="headerlink" title="name属性"></a>name属性</h3><p>ES6中函数<code>Function.name</code>属性用来返回一个函数的名称，<code>name</code>属性可以用来作为函数的一种标识，可以用来在debug时使用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line"><span class="built_in">console</span>.log(doSomething.name); <span class="comment">// "doSomething"</span></div></pre></td></tr></table></figure>
<p>匿名函数覆盖一个变量后，该函数的name属性在ES5下为空值，ES6后为变量名称</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> testFn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line"><span class="built_in">console</span>.log(testFn.name); <span class="comment">// es5为 ""</span></div><div class="line"><span class="built_in">console</span>.log(testFn.name); <span class="comment">// es6为 "testFn"</span></div></pre></td></tr></table></figure>
<p>函数表达式的<code>name</code>属性为表达式的名称，即使是将它赋值给另一个函数，或添加到对象的方法上</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> f = <span class="function"><span class="keyword">function</span> <span class="title">fnExpress</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line"><span class="built_in">console</span>.log(f.name);<span class="comment">// "fnExpress"</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> person = &#123;</div><div class="line">  <span class="attr">sayHi</span>: <span class="function"><span class="keyword">function</span> <span class="title">fnExpress</span>(<span class="params"></span>)</span>&#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(person.sayHi);<span class="comment">// "fnExpress"</span></div></pre></td></tr></table></figure>
<p>使用<code>Function</code>创建的函数的名称为”anonymous”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Function</span>().name); <span class="comment">// "anonymous"</span></div></pre></td></tr></table></figure>
<p>使用<code>bind()</code>方法创建的函数，名称前会添加一个”bound”前缀</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFn</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line"><span class="built_in">console</span>.log(testFn.bind().name); <span class="comment">// "bound testFn"</span></div></pre></td></tr></table></figure>
<h3 id="new-target元属性"><a href="#new-target元属性" class="headerlink" title="new.target元属性"></a><code>new.target</code>元属性</h3><p>JavaScript中function既能定义函数，也能定义创建对象的构造器，因此函数可以有多种调用方式，如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 定义Dog类</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">  <span class="keyword">this</span>.name = name ;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> Dog(<span class="string">'拉布拉多'</span>);</div><div class="line"><span class="keyword">var</span> errCall = Dog(<span class="string">'拉布拉多'</span>); <span class="comment">// 错误的用法,错误的为全局对象添加了一个name属性</span></div></pre></td></tr></table></figure>
<p>以上我们以大写的D开头意在定义<code>Dog</code>类型，并使用<code>new</code>操作符来创建对象，但我们依然可以直接以普通函数的形式调用<code>Dog</code>,这时<code>this</code>指向的时全局对象，
在浏览器中指的是<code>window</code>对象，这显然是与我们的初衷背离的。ES5之前，我们可以使用<code>instanceof</code>关键字对<code>this</code>做检测，检查<code>this</code>兑现是否时类的实例，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">DOg</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">  <span class="keyword">if</span>(<span class="keyword">this</span> <span class="keyword">instanceof</span> Dog)&#123;</div><div class="line">    <span class="keyword">this</span>.name = name ;</div><div class="line">  &#125;<span class="keyword">else</span>&#123;</div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'请使用new关键字调用Dog'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> Dog(<span class="string">'拉布拉多'</span>);</div><div class="line"><span class="keyword">var</span> errCall = Dog(<span class="string">'拉布拉多'</span>); <span class="comment">// error</span></div></pre></td></tr></table></figure>
<p>以上可以初步解决类构造器当做函数调用，但也不是完美的，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> Dog(<span class="string">'拉布拉多-1'</span>);</div><div class="line">Dog.call(dog , <span class="string">'拉布拉多-2'</span>); <span class="comment">// 这也是可以的</span></div></pre></td></tr></table></figure>
<p>使用<code>call()</code>和<code>apply()</code>，我们可以改变函数调用时上下文this对象。</p>
<p>ES6添加<code>new.target</code>属性来判断函数是否使用的是<code>new</code>调用的。当函数直接调用时，<code>new.target</code>值为<code>undefined</code>，函数使用<code>new</code>调用时，<code>new.target</code>
指向的该函数的构造器。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">  <span class="keyword">if</span>(!<span class="keyword">new</span>.target)&#123;</div><div class="line">    <span class="keyword">this</span>.name = name ;</div><div class="line">  &#125;<span class="keyword">else</span>&#123;</div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'请使用new关键字调用Dog'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> Dog(<span class="string">'拉布拉多'</span>);</div><div class="line"><span class="keyword">var</span> errCall = Dog(<span class="string">'拉布拉多'</span>); <span class="comment">// error</span></div></pre></td></tr></table></figure>
<p>虽然<code>new.target</code>乍看起来有点奇怪，因为<code>new</code>在JavaScript中属于操作符，但在函数内，<code>new</code>却变成了一种“特殊”的对象(其实不是真正的对象)</p>
<h3 id="箭头函数-Arrow-function"><a href="#箭头函数-Arrow-function" class="headerlink" title="箭头函数 - Arrow function"></a>箭头函数 - Arrow function</h3><p>arrow函数表达式是ES6中函数最特殊的变化，它引入了一种新的语法，<code>=&gt;</code>，来使用函数。arrow函数相比较其它普通函数来，有一些特点</p>
<ul>
<li>语法更精简。</li>
<li>没有this, super, arguments, 和new.target的绑定问题，所有这些值都取离arrow函数的最近的上下文所指的值或引用。</li>
<li>不能在arrow函数上使用new调用。</li>
<li>没有原型属性prototype。</li>
<li>this不能改变，尽管是使用<code>call()</code>和<code>apply()</code>调用，this不受影响。</li>
</ul>
<p>在JavaScript的function中，this绑定是最常见的操作，也是最容易让人困惑和容易出错的地儿，arrow函数的特性避免this绑定的问题，与此同时arrow函数
也会带来进一步的代码优化。</p>
<p>arrow函数的语法比较灵活，可以有多种写法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// 空函数,返回undefined，没有参数传入时，必须使用括号</span></div><div class="line"><span class="keyword">let</span> empty = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125; ;</div><div class="line"><span class="comment">// 等价于ES5的</span></div><div class="line"><span class="keyword">var</span> empty = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="comment">// 接受单个参数并返回,</span></div><div class="line"><span class="keyword">let</span> identity = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="keyword">return</span> value ;&#125;</div><div class="line"><span class="comment">// 单个参数可以省略括号</span></div><div class="line"><span class="keyword">let</span> identity = <span class="function"><span class="params">value</span> =&gt;</span> vlaue ;</div><div class="line"><span class="comment">// 等价于ES5的</span></div><div class="line"><span class="keyword">var</span> identity = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> value ;</div><div class="line">&#125;</div><div class="line"><span class="comment">// add函数，返回两个参数的和</span></div><div class="line"><span class="keyword">let</span> add = <span class="function">(<span class="params">valA , valB</span>) =&gt;</span> valA + valB ;</div><div class="line"><span class="comment">// 或</span></div><div class="line"><span class="keyword">let</span> add = <span class="function">(<span class="params">valA , valB</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> valA + valB ;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 等价于ES5的</span></div><div class="line"><span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span>(<span class="params">valA , valB</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> valA + valB ;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 用括号包裹的形式直接返回对象字面量</span></div><div class="line"><span class="keyword">let</span> randomObj = <span class="function"><span class="params">id</span> =&gt;</span> (&#123;<span class="attr">id</span>:id&#125;) ;</div><div class="line"><span class="comment">//等价于ES5的</span></div><div class="line"><span class="keyword">var</span> randomObj = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">id</span>: id</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 立即执行的函数调用IIFES</span></div><div class="line"><span class="keyword">var</span> obj = <span class="function">(<span class="params">(id</span>)=&gt;</span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">id</span>: id</div><div class="line">  &#125;;</div><div class="line">&#125;)(<span class="number">1</span>);</div><div class="line">等价于ES5的</div><div class="line"><span class="keyword">var</span> obj = (<span class="function"><span class="keyword">function</span>(<span class="params">id</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">id</span>: id</div><div class="line">  &#125;;</div><div class="line">&#125;)(<span class="number">1</span>);</div><div class="line"></div><div class="line"><span class="comment">// 使用rest参数</span></div><div class="line"><span class="keyword">let</span> multip = <span class="function">(<span class="params">...vals</span>)=&gt;</span>&#123;</div><div class="line">  <span class="keyword">var</span> res = <span class="number">1</span> ;</div><div class="line">  vals.forEach(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</div><div class="line">    res *= val;</div><div class="line">  &#125;);</div><div class="line">  <span class="keyword">return</span> res ;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 等价于ES5的</span></div><div class="line"><span class="keyword">var</span> multip = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> args = <span class="built_in">arguments</span>;</div><div class="line">  <span class="keyword">var</span> res = <span class="number">1</span> ;</div><div class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> , l = args.lengh ; i &lt; l ; i++)&#123;</div><div class="line">    res *= args[i];</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> res ;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 默认参数</span></div><div class="line"><span class="keyword">var</span> ajax = <span class="function">(<span class="params">url , data=&#123;&#125; , onSuccess=<span class="keyword">function</span>(</span>)&#123;&#125;)=&gt;</span>&#123;</div><div class="line">  <span class="comment">// ajax call</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 没有this绑定问题,arrow函数的this指向的其所在上下文环境</span></div><div class="line"><span class="comment">// 即使是通过call()和apply()也无法改变其this指向。</span></div><div class="line"><span class="keyword">var</span> person = &#123;</div><div class="line">  <span class="attr">name</span>:<span class="string">'Jim'</span>,</div><div class="line">  <span class="attr">delaySayHi</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">'sayHi'</span>);</div><div class="line">    &#125;, <span class="number">1000</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">person.delaySayHi();</div><div class="line"><span class="comment">// 等价于ES5的</span></div><div class="line"><span class="keyword">var</span> person = &#123;</div><div class="line">  <span class="attr">name</span>:<span class="string">'Jim'</span>,</div><div class="line">  <span class="attr">delaySayHi</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span> ;</div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="comment">// 通过创建闭包来完成对this的指向转换</span></div><div class="line">      <span class="built_in">console</span>.log(self.name + <span class="string">'sayHi'</span>);</div><div class="line">    &#125;, <span class="number">1000</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 没有arguments对象</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">let</span> arrFn = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">arguments</span>[<span class="number">0</span>];</div><div class="line">  <span class="built_in">console</span>.log(arrFn());</div><div class="line">&#125;</div><div class="line">fn(<span class="number">100</span>); <span class="comment">// 100， 此处的arrFn中引用的是其作用域链也就是fn所暴露的argumens对象</span></div><div class="line"></div><div class="line"><span class="comment">// arrow函数的类型判断</span></div><div class="line"><span class="keyword">let</span> arrFn = <span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;</div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> arrFn); <span class="comment">// function</span></div><div class="line"><span class="built_in">console</span>.log(arrFn <span class="keyword">instanceof</span> <span class="built_in">Function</span>)); <span class="comment">// true</span></div><div class="line"></div><div class="line"><span class="comment">// arrow函数与数组方法,数组中有多个遍历元素的方法使用arrow函数会很方便</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> res = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].map( <span class="function">(<span class="params">val</span>)=&gt;</span> val * <span class="number">2</span>);</div><div class="line"><span class="built_in">console</span>.log(res); <span class="comment">// [2, 4, 6]</span></div></pre></td></tr></table></figure>
<h3 id="严格模式下的尾调优化"><a href="#严格模式下的尾调优化" class="headerlink" title="严格模式下的尾调优化"></a>严格模式下的尾调优化</h3><p>ES6在严格模式下会进行一项称为尾调优化的行为，尾调是指一个函数在另一个函数的最后调用，如以下形式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">outerFn</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="comment">// to do</span></div><div class="line">  <span class="keyword">return</span> innerFn(); <span class="comment">// 在尾部调用函数并返回</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>需要满足四个条件</p>
<ul>
<li>严格模式。</li>
<li>尾部调用函数不会引用当前调用栈的变量（即，没有创建闭包）。</li>
<li>尾部调用必须是最后一个处理，之后没有其它调用语句。</li>
<li>必须返回尾部调用的调用值。</li>
</ul>
<p>所以以下几种都不属于尾部调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 1</span></div><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">outerFn</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// 没有返回值</span></div><div class="line">  innerFn();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 2</span></div><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">outerFn</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// 不能有进一步操作</span></div><div class="line">  <span class="keyword">return</span> <span class="number">1</span> + innerFn();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 3</span></div><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">outerFn</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// 调用不在尾部</span></div><div class="line">  <span class="keyword">var</span> res = innerFn();</div><div class="line">  <span class="keyword">return</span> res ;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 4</span></div><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">outerFn</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> num = <span class="number">2</span> ;</div><div class="line">  <span class="comment">// 此处创建了闭包</span></div><div class="line">  <span class="keyword">let</span> innerFn = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</div><div class="line">    <span class="keyword">return</span> num ;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> innerFn();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在计算机中调用栈是用来存储当前子程序信息的栈型数据结构，主要用来记录函数调用时的位置，局部变量等信息，又称作调用帧（Call frame），调用栈就是由一个个调用帧组成的，每次函数的调用都会创建一个调用帧，然后push到调用栈顶，如A调用B,B调用C，那么调用栈上从顶向下记录的是callFrameC-&gt;callFrameB-&gt;callFrameA。当出现多级嵌套调用时就有可能发生栈溢出（Stack overflow）的错误，由于尾掉函数处于最后，不再需要保留外层调用帧，直接使用当前帧去掉外层帧即可，以达到优化的目的。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new.target" target="_blank" rel="external">MDN new.target</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/rest_parameters" target="_blank" rel="external">MDN Rest parameters</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions" target="_blank" rel="external">MDN Arrow Function</a></li>
<li><a href="https://en.wikipedia.org/wiki/Call_stack#CALL-FRAME" target="_blank" rel="external">Wiki Call stack</a></li>
<li><a href="https://en.wikipedia.org/wiki/Stack_overflow" target="_blank" rel="external">Stack overflow</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2016/05/10/ES6笔记-块级作用域/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/10/ES6笔记-块级作用域/" itemprop="url">ES6笔记 - 块级作用域</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-10T21:34:27+08:00">
                2016-05-10
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/05/10/ES6笔记-块级作用域/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/10/ES6笔记-块级作用域/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="语句块-Block-和块级作用域-Block-Scope"><a href="#语句块-Block-和块级作用域-Block-Scope" class="headerlink" title="语句块(Block)和块级作用域(Block Scope)"></a>语句块(Block)和块级作用域(Block Scope)</h3><p>在计算机语言中，语句块或代码快顾名思义，是一组代码的集合，包含零个或多个变量声明或语句。在基于C结构的语言中，语句块开始于<code>{</code>,结束于<code>}</code>,
语句块通常在流程控制语句(<code>if</code>，<code>for</code>，<code>while</code>)中使用和。每个语句块都会生成与之对应的<em>块级作用域</em>，其内部声明的变量只在自身可见，在外部访问这些变量将引发错误。</p>
<h3 id="var和变量声明提升"><a href="#var和变量声明提升" class="headerlink" title="var和变量声明提升"></a>var和变量声明提升</h3><p>在ES6之前，JavaScript没有块级作用域，使用<code>var</code>声明的变量会解析为其所处上下文的最起始的位置，这称作<em>变量声明提升(Variable hoisting)</em> ,
函数内部声明的变量为局部变量，函数外部声明的变量称为全局变量，在对应的上下文中这些变量声明总会被“提前”到所有语句前,访问这些“提升后”的变量会返回<code>undefined</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// demo-1</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">// 局部变量</span></div><div class="line">    <span class="built_in">console</span>.log(x); <span class="comment">// undefined ， 变量提前访问</span></div><div class="line">    <span class="keyword">var</span> x = <span class="string">'local variable'</span> ; <span class="comment">// 变量声明</span></div><div class="line">    <span class="built_in">console</span>.log(x); <span class="comment">// local variable</span></div><div class="line">&#125;</div><div class="line">fun();</div><div class="line"></div><div class="line"><span class="comment">// demo-2</span></div><div class="line"><span class="built_in">console</span>.log(y);  <span class="comment">// undefined,变量提前访问</span></div><div class="line"><span class="keyword">var</span> y = <span class="string">'global variable'</span> ;</div><div class="line"><span class="built_in">console</span>.log(y);  <span class="comment">// global variable</span></div></pre></td></tr></table></figure>
<p>以上变量<code>x</code>,<code>y</code>在正式声明前就可以直接访问，只不过变量值为<code>undefined</code>，这就是所谓的变量提升，以上js代码可以理解为</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// demo-1</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> x ;</div><div class="line">    <span class="comment">// 局部变量</span></div><div class="line">    <span class="built_in">console</span>.log(x); <span class="comment">// undefined ， 变量提前访问</span></div><div class="line">    x = <span class="string">'local variable'</span> ; <span class="comment">// 变量声明</span></div><div class="line">    <span class="built_in">console</span>.log(x); <span class="comment">// local variable</span></div><div class="line">&#125;</div><div class="line">fun();</div><div class="line"></div><div class="line"><span class="comment">// demo-2</span></div><div class="line"><span class="keyword">var</span> y ;</div><div class="line"><span class="built_in">console</span>.log(y);  <span class="comment">// undefined,变量提前访问</span></div><div class="line">y = <span class="string">'global variable'</span> ;</div><div class="line"><span class="built_in">console</span>.log(y);  <span class="comment">// global variable</span></div></pre></td></tr></table></figure>
<h3 id="ES6块级作用域声明"><a href="#ES6块级作用域声明" class="headerlink" title="ES6块级作用域声明"></a>ES6块级作用域声明</h3><p>块级作用域声明指的那些只能在指定语句快内可以访问的变量声明，在函数声明或者一个<code>{</code>，<code>}</code>语句块都可以创建一个块级作用域。ES6中引入了<code>let</code>声明和
<code>const</code>声明来支持块级作用域。</p>
<h4 id="let变量声明"><a href="#let变量声明" class="headerlink" title="let变量声明"></a>let变量声明</h4><p><code>let</code>关键字声明变量的语法与原来的<code>var</code>关键字声明变量的语法时类似的，不同的时<code>let</code>声明的变量不存在<em>变量提升</em>的效果，所有使用<code>let</code>声明的变量都只能
在当前的代码块中使用，试图在变量声明前或在外部作用域访问这些变量会引发错误。
以下代码是错误的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(x); <span class="comment">// 错误，变量x未定义</span></div><div class="line"><span class="keyword">let</span> x = <span class="number">10</span> ;</div></pre></td></tr></table></figure>
<p>更正后
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> x = <span class="number">10</span> ;</div><div class="line"><span class="built_in">console</span>.log(x); <span class="comment">// 错误，变量x未定义</span></div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="keyword">let</span> x = <span class="number">10</span> ;</div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(x); <span class="comment">// 错误，变量x未定义</span></div></pre></td></tr></table></figure>
<p>更正
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="keyword">let</span> x = <span class="number">10</span>;</div><div class="line">  <span class="built_in">console</span>.log(x);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="const变量声明"><a href="#const变量声明" class="headerlink" title="const变量声明"></a>const变量声明</h4><p>ES6之前部支持常量的声明，对常量的需求要求我们通过一些约定和规范来实现类似于常量的实现，如常量一律使用大写字母
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> MAX_COUNT = <span class="string">'10'</span>;</div></pre></td></tr></table></figure></p>
<p>但这些所谓的常量仍然有可能被错误的覆盖，<code>MAX_COUNT = &#39;something else&#39;</code>。
现在ES6支持使用<code>const</code>关键子来声明常量，所有<code>const</code>变量必须在声明时进行初始化，并且声明后是不能对其进行赋值。
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> MAX_COUNT = <span class="number">10</span>; <span class="comment">// 正确</span></div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> MAX_COUNT ; <span class="comment">// 错误，变量未初始化</span></div><div class="line">MAX_COUNT = <span class="number">10</span> ;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> MAX_COUNT = <span class="number">10</span> ;</div><div class="line">MAX_COUNT = <span class="number">100</span> ; <span class="comment">// 错误，const变量不能覆盖</span></div></pre></td></tr></table></figure>
<p>与<code>let</code>一样，<code>const</code>变量也是块级声明，变量只存在于当前块级作用域之内。
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="keyword">const</span> MAX_COUNT = <span class="number">10</span> ;</div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(MAX_COUNT); <span class="comment">// 错误，变量未定义</span></div></pre></td></tr></table></figure></p>
<p><code>const</code>变量阻止的是对变量绑定的覆盖，而这并不妨碍我们对其变量内容进行修改，如
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> CONF = &#123;</div><div class="line">  <span class="attr">maxCount</span>: <span class="number">10</span></div><div class="line">&#125;;</div><div class="line">CONF.maxCount = <span class="number">100</span>; <span class="comment">// 正确</span></div><div class="line">CONF = &#123;&#125;; <span class="comment">// 错误</span></div></pre></td></tr></table></figure></p>
<h4 id="不允许变量重复声明"><a href="#不允许变量重复声明" class="headerlink" title="不允许变量重复声明"></a>不允许变量重复声明</h4><p>在<strong>同一个作用域</strong>之内使用<code>let</code>和<code>const</code>声明的变量不允许重复声明</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="keyword">let</span> a = <span class="number">1</span> ;</div><div class="line">  <span class="keyword">var</span> a = <span class="number">1</span> ; <span class="comment">// 错误，变量重复声明</span></div><div class="line">&#125;</div><div class="line">&#123;</div><div class="line">  <span class="keyword">const</span> MAX_COUNT = <span class="number">10</span>;</div><div class="line">  <span class="keyword">var</span> MAX_COUNT = <span class="number">10</span>; <span class="comment">// 错误，变量重复声明</span></div><div class="line">&#125;</div><div class="line">&#123;</div><div class="line">  <span class="keyword">let</span> a = <span class="number">1</span> ;</div><div class="line">  <span class="keyword">const</span> a = <span class="number">1</span> ; <span class="comment">// 错误，变量重复声明</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">opt</span>)</span>&#123;</div><div class="line">  <span class="keyword">let</span> opt ; <span class="comment">// 错误，变量重复声明</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="临时性死区-The-Temporal-Dead-Zone"><a href="#临时性死区-The-Temporal-Dead-Zone" class="headerlink" title="临时性死区(The Temporal Dead Zone)"></a>临时性死区(The Temporal Dead Zone)</h4><p>临时性死区是一个术语，用来说明<code>let</code>变量和<code>const</code>变量在声明前是不能使用的。在一个块级作用域内的变量，要么被<em>变量提升</em>至全局作用域或者函数起始处(使用<code>var</code>声明的变量)，
要么被放入临时性死区(使用<code>let</code>或<code>const</code>声明的变量)，任何访问（即使是<code>typeof</code>关键字判断变量类型）临时性死区变量的行为都会引发错误，只有一个变量被正式声明时，它才会被从临时性死区移除掉。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="keyword">typeof</span> value);  <span class="comment">// 引用错误</span></div><div class="line">  <span class="keyword">let</span> value = <span class="number">10</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="for循环和函数内的let"><a href="#for循环和函数内的let" class="headerlink" title="for循环和函数内的let"></a>for循环和函数内的<code>let</code></h4><p>ES6之前for循环的存在这变量作用域的问题，如
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; <span class="number">10</span> ; i++)&#123;</div><div class="line">  <span class="comment">// so something</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(i); <span class="comment">// 10</span></div></pre></td></tr></table></figure></p>
<p>使用<code>let</code>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span> ; i &lt; <span class="number">10</span> ; i++)&#123;</div><div class="line">  <span class="comment">// so something</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(i); <span class="comment">// 错误，变量i未定义</span></div></pre></td></tr></table></figure></p>
<p>ES6之前for循环内函数使用存在这变量作用域的问题，如
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> funs = [];</div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; <span class="number">10</span> ; i++)&#123;</div><div class="line">  funs.push(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(i);</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line">funs.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">fn</span>)</span>&#123;</div><div class="line">  fn(); <span class="comment">// 打印十次10</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>在ES6之前这可以使用一种IIFE(立即执行函数表达式 -  immediately-invoked function expressions )来解决，如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> funs = [];</div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; <span class="number">10</span> ; i++)&#123;</div><div class="line">  funs.push((<span class="function"><span class="keyword">function</span>(<span class="params">num</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(num);</div><div class="line">    &#125;</div><div class="line">  &#125;)(i));</div><div class="line">&#125;</div><div class="line">funs.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">fn</span>)</span>&#123;</div><div class="line">  fn(); <span class="comment">// 依次打印数字0到9</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>在ES6中可以使用<code>let</code>关键字直接解决这个问题
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> funs = [];</div><div class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span> ; i &lt; <span class="number">10</span> ; i++)&#123;</div><div class="line">  funs.push(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(i);</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line">funs.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">fn</span>)</span>&#123;</div><div class="line">  fn(); <span class="comment">// 依次打印数字0到9</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h4 id="全局作用域下的块绑定"><a href="#全局作用域下的块绑定" class="headerlink" title="全局作用域下的块绑定"></a>全局作用域下的块绑定</h4><p>在全局作用域下使用<code>var</code>声明的变量为全局变量，全局变量会自动变为全局对象的属性，在浏览器中全局对象指的是<code>window</code>对象,在node中指的是<code>global</code>对象,如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = &#123;</div><div class="line">  <span class="attr">length</span>:<span class="number">0</span></div><div class="line">&#125; ;</div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.a.length); <span class="comment">// 0</span></div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.a == a); <span class="comment">// true</span></div></pre></td></tr></table></figure>
<p>带来的风险是现存的全局对象可能会被错误的覆盖掉</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> <span class="built_in">Date</span> = <span class="string">"something else"</span>;</div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.Date); <span class="comment">// something else</span></div><div class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="comment">// TypeError: Date is not a constructor</span></div></pre></td></tr></table></figure>
<p>相反，在全局作用域下使用<code>let</code>或<code>const</code>声明的变量不会成为全局对象的属性，而会创建一个新的变量绑定。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> <span class="built_in">Date</span> = <span class="string">"something else"</span>;</div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.Date); <span class="comment">// something else</span></div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.Date == <span class="built_in">Date</span>); <span class="comment">// false</span></div><div class="line"><span class="keyword">let</span> d = <span class="keyword">new</span> <span class="built_in">window</span>.Date(); <span class="comment">// d为Date类型对象</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> MAX_COUNT = <span class="number">10</span> ;</div><div class="line"><span class="built_in">console</span>.log(MAX_COUNT <span class="keyword">in</span> <span class="built_in">window</span>); <span class="comment">// false</span></div></pre></td></tr></table></figure>
<h4 id="let和const最佳实践"><a href="#let和const最佳实践" class="headerlink" title="let和const最佳实践"></a>let和const最佳实践</h4><ul>
<li>使用<code>let</code>替换<code>var</code>；</li>
<li>默认使用<code>const</code>声明变量，在你支持变量修改的时候使用<code>let</code>；<blockquote>
<p>背后的依据是：变量未知的改动是bug的重要来源。</p>
</blockquote>
</li>
</ul>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://en.wikipedia.org/wiki/Block_(programming" target="_blank" rel="external">Block (programming)</a>)</li>
<li><a href="https://en.wikipedia.org/wiki/Scope_(computer_science" target="_blank" rel="external">Block Scope</a>#Block_scope)</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Grammar_and_types" target="_blank" rel="external">Grammar and types</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2016/05/09/检测IE和Edge/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/09/检测IE和Edge/" itemprop="url">检测IE和Edge</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-09T17:37:49+08:00">
                2016-05-09
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/05/09/检测IE和Edge/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/09/检测IE和Edge/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="使用条件语句"><a href="#使用条件语句" class="headerlink" title="使用条件语句"></a>使用条件语句</h3><p>条件判断是IE引进的一种用来检测浏览器版本的方法，用来检测早前旧版本的IE，可以用条件语句方便的实现不同IE版本，不同样式的切换。</p>
<p>语法</p>
<table style="font-size:12px;">
<tbody>
  <tr>
    <th>注释类型</th><th>语法</th>
  </tr>
  <tr>
    <td>
      <span>downlevel-hidden</span>
      <span>(不支持条件判断的隐藏内容，支持的根据表达式判断)</span>
    </td>
    <td>&lt;!–[if <em>expression</em>]&gt; <em>HTML</em> &lt;![endif]–&gt;</td>
  </tr>
  <tr>
    <td>
      <span>downlevel-revealed</span>
      <small style="font-size: 10px;">(不支持条件判断的显示内容，支持的根据表达式判断)</small>
    </td>
    <td>&lt;![if <em>expression</em>]&gt; <em>HTML</em> &lt;![endif]&gt;</td>
  </tr>
</tbody>
</table>
表达式是有特性，操作符，逻辑与或组成
<table style="font-size:12px;">
  <tbody>
      <tr>
          <th></th>
          <th>示例</th>
          <th>解释</th>
      </tr>
      <tr>
        <td>IE</td>
        <td>[if IE]</td>
        <td>当前IE浏览器的版本号。</td>
      </tr>
      <tr>
          <td>!</td>
          <td>[if !IE]</td>
          <td>逻辑非操作。</td>
      </tr>
      <tr>
          <td>lt</td>
          <td>[if lt IE 5.5]</td>
          <td>小于操作符。如果第一个参数小于第二个参数，则返回true。</td>
      </tr>
      <tr>
          <td>lte</td>
          <td>[if lte IE 6]</td>
          <td>小于等于操作符。如果第一个参数小于或等于第二个参数，则返回true。</td>
      </tr>
      <tr>
          <td>gt</td>
          <td>[if gt IE 5]</td>
          <td>大于操作符。如果第一个参数大于第二个参数，则返回true。</td>
      </tr>
      <tr>
          <td>gte</td>
          <td>[if gte IE 7]</td>
          <td>大于等于操作符。如果第一个参数大于或等于第二个参数，则返回true&lt;。/td&gt;
      </td></tr>
      <tr>
          <td>( )</td>
          <td>[if !(IE 7)]</td>
          <td>子表达式。用来创建更复杂的组合表达式。 </td>
      </tr>
      <tr>
          <td>&amp;</td>
          <td>[if (gt IE 5)&amp;(lt IE 7)]</td>
          <td>逻辑与。所有表达式为true时，返回true。</td>
      </tr>
      <tr>
          <td>|</td>
          <td>[if (IE 6)|(IE 7)]</td>
          <td>逻辑或。 至少有一个表达式为true时，返回true。</td>
      </tr>
  </tbody>
</table>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">&lt;!--[if !IE]&gt;&lt;html class=&quot;not-ie&quot;&gt;&lt;![endif]--&gt;</div><div class="line">&lt;!--[if lt IE 7]&gt; &lt;html class=&quot;lt-ie9 lt-ie8 lt-ie7&quot;&gt; &lt;![endif]--&gt;</div><div class="line">&lt;!--[if IE 7]&gt; &lt;html class=&quot;lt-ie9 lt-ie8 ie7&quot;&gt; &lt;![endif]--&gt;</div><div class="line">&lt;!--[if lt IE 8]&gt; &lt;html class=&quot;lt-ie9 lt-ie8&quot;&gt; &lt;![endif]--&gt;</div><div class="line">&lt;!--[if IE 8]&gt; &lt;html class=&quot;lt-ie9 ie8&quot;&gt; &lt;![endif]--&gt;</div><div class="line">&lt;!--[if lt IE 9]&gt;&lt;html class=&quot;lt-ie9&quot;&gt; &lt;![endif]--&gt;</div><div class="line">&lt;!--[if IE 9]&gt;&lt;html class=&quot;ie9&quot;&gt; &lt;![endif]--&gt;</div><div class="line"></div><div class="line">&lt;style&gt;</div><div class="line"></div><div class="line">  .lt-ie9 .someClassForIE9Below&#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">  .ie9 .someClassForIE9&#123;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line"></div><div class="line">&lt;/style&gt;</div><div class="line"></div><div class="line">&lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">  var isIE  = $(&apos;html&apos;).hasClass(&apos;not-ie&apos;);</div><div class="line">  var isIE7 = $(&apos;html&apos;).hasClass(&apos;ie7&apos;);</div><div class="line">  var isIE8 = $(&apos;html&apos;).hasClass(&apos;ie8&apos;);</div><div class="line">  var isIE9 = $(&apos;html&apos;).hasClass(&apos;ie8&apos;);</div><div class="line"></div><div class="line">  var isIE7Beblow = $(&apos;html&apos;).hasClass(&apos;lt-ie7&apos;);</div><div class="line">  var isIE8Beblow = $(&apos;html&apos;).hasClass(&apos;lt-ie8&apos;);</div><div class="line">  var isIE9Beblow = $(&apos;html&apos;).hasClass(&apos;lt-ie9&apos;);</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
<p>由于IE10之后不再支持条件语句了，所以条件语句仅可以使用在IE9之前的浏览器上。</p>
<h3 id="检测UserAgent字符串"><a href="#检测UserAgent字符串" class="headerlink" title="检测UserAgent字符串"></a>检测UserAgent字符串</h3><p>user-agent字符串用来描述当前浏览器的信息，包括浏览器的类型，版本，平台等等，<code>navigator.userAgent</code>只读字符串属性声明了浏览器用于HTTP请求的用户代理的字符串，可以针对该字符串进行分析判断。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> ua = navigator.userAgent ;</div><div class="line"><span class="keyword">var</span> ie = ua.match(<span class="regexp">/MSIE\s([\d.]+)/</span>) || ua.match(<span class="regexp">/Trident\/.*rv:([0-9.].)/</span>) ;</div><div class="line"><span class="keyword">var</span> edge = ua.match(<span class="regexp">/Edge\/(\d*)/</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> isIE = !!ie;</div><div class="line"><span class="keyword">var</span> ieVer = isIE &amp;&amp; <span class="built_in">parseInt</span>(ie[<span class="number">1</span>]);</div><div class="line"><span class="keyword">var</span> isIE6 = ieVer == <span class="number">6</span> ;</div><div class="line"><span class="keyword">var</span> isIE7 = ieVer == <span class="number">7</span> ;</div><div class="line"><span class="keyword">var</span> isIE8 = ieVer == <span class="number">8</span> ;</div><div class="line"><span class="keyword">var</span> isIE9 = ieVer == <span class="number">9</span> ;</div><div class="line"><span class="keyword">var</span> isIE10 = ieVer == <span class="number">10</span> ;</div><div class="line"><span class="keyword">var</span> isIE11 = ieVer == <span class="number">11</span> ;</div><div class="line"></div><div class="line"><span class="keyword">var</span> isEdge = edge ;</div><div class="line">edgeVer = edge &amp;&amp; <span class="built_in">parseInt</span>(edge[<span class="number">1</span>]) ;</div></pre></td></tr></table></figure>
<ul>
<li><a href="https://msdn.microsoft.com/en-us/library/ms537503(v=vs.85).aspx#UnderstandUA" target="_blank" rel="external">MDN Understanding user-agent strings</a></li>
<li><a href="https://msdn.microsoft.com/en-us/library/ms537509(v=vs.85).aspx" target="_blank" rel="external">MDN Detecting Windows Internet Explorer More Effectively</a></li>
<li><a href="https://msdn.microsoft.com/en-us/library/bg182625(v=vs.85).aspx" target="_blank" rel="external">MDN Compatibility changes in IE11</a></li>
<li><a href="http://tanalin.com/en/articles/ie-version-js/" target="_blank" rel="external">Internet Explorer (IE) version detection in JavaScript</a></li>
<li><a href="http://codepen.io/gapcode/pen/vEJNZN" target="_blank" rel="external">Detect Internet Explorer (IE) up to version 11 and Edge (12+)</a></li>
<li><a href="http://www.quirksmode.org/css/condcom.html" target="_blank" rel="external">Conditional comments</a></li>
<li><a href="http://useragentstring.com/pages/Internet%20Explorer/" target="_blank" rel="external">Internet Explorer User Agent Strings</a></li>
<li><a href="https://developer.microsoft.com/zh-cn/microsoft-edge/platform/faq/open-source-engine" target="_blank" rel="external">Edge 常见问题</a></li>
</ul>
<p><a href="http://stackoverflow.com/questions/1358540/how-to-count-all-the-lines-of-code-in-a-directory-recursively" target="_blank" rel="external">http://stackoverflow.com/questions/1358540/how-to-count-all-the-lines-of-code-in-a-directory-recursively</a>
<a href="http://xmodulo.com/how-to-count-lines-of-code.html" target="_blank" rel="external">http://xmodulo.com/how-to-count-lines-of-code.html</a>
<a href="http://www.cyberciti.biz/faq/linux-unix-bsd-xargs-construct-argument-lists-utility/" target="_blank" rel="external">http://www.cyberciti.biz/faq/linux-unix-bsd-xargs-construct-argument-lists-utility/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2016/05/07/为input元素设置焦点/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/07/为input元素设置焦点/" itemprop="url">为input元素设置焦点</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-07T10:59:09+08:00">
                2016-05-07
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/05/07/为input元素设置焦点/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/07/为input元素设置焦点/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><a href="http://stackoverflow.com/questions/4166423/default-html-form-focus-without-javascript" target="_blank" rel="external">Default html form focus without JavaScript</a></li>
<li><a href="http://caniuse.com/#feat=autofocus" target="_blank" rel="external">Can I Use autofocus</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input" target="_blank" rel="external">MDN input autofocus</a></li>
<li><a href="http://stackoverflow.com/questions/17500704/javascript-set-focus-to-html-form-element?rq=1" target="_blank" rel="external">JavaScript set focus to HTML form element</a></li>
<li><a href="http://stackoverflow.com/questions/6287478/mobile-safari-autofocus-text-field" target="_blank" rel="external">Mobile Safari Autofocus text field</a></li>
<li><a href="http://stackoverflow.com/questions/12204571/mobile-safari-javascript-focus-method-on-inputfield-only-works-with-click" target="_blank" rel="external">Mobile Safari: Javascript focus() method on inputfield only works with click?</a></li>
<li><a href="https://github.com/jquery/jquery-mobile/issues/3016" target="_blank" rel="external">iOS does not show keyboard on .focus() #3016</a></li>
<li><a href="http://stackoverflow.com/questions/979309/how-do-i-focus-an-html-text-field-on-an-iphone-causing-the-keyboard-to-come-up" target="_blank" rel="external">How do I focus an HTML text field on an iPhone (causing the keyboard to come up)?</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2016/05/03/JavaScript严格模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/03/JavaScript严格模式/" itemprop="url">JavaScript严格模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-03T16:09:09+08:00">
                2016-05-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/05/03/JavaScript严格模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/03/JavaScript严格模式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>ES5作为ES3的补充，在语法层面上并没有进一步的更新，所有ES5的新特性基本上是在ES3上下文上进行的补充和完善。但历来ES的特性和其松散性的语法在为开发者提供
灵活便捷的同时，也同样带来了诸多瑕疵，这些特性和语法中许多会容易引发错误，带来安全问题，并且没有较强的错误检测机制。此外，随着ES本身版本的更新和发展，
一些特性会过时，甚至在将来的版本中直接移除掉。因此在这样的背景下ES5中引入可一种特殊的模式：<strong>严格模式</strong>（Strict Mode）来解决这些问题。</p>
<p>严格模式下的JavaScript代码会得到以下几方面的好处：</p>
<ul>
<li>消除无声错误（slient errors），转化为错误或异常抛出。</li>
<li>修正一些妨碍JavaScript引擎进行代码优化的错误。</li>
<li>带来更快的代码执行速度。</li>
<li>更加安全，语法更加严谨。</li>
</ul>
<p>基本上所有现代的主流浏览器都支持严格模式的语法，包括<a href="https://msdn.microsoft.com/zh-cn/library/br230269(v=vs.94).aspx" target="_blank" rel="external">IE10</a>及其以上版本的浏览器。</p>
<h3 id="声明方式"><a href="#声明方式" class="headerlink" title="声明方式"></a>声明方式</h3><p>开启JavaScript代码的严格模式，只需要使用<code>&quot;use strict&quot;</code>在JavaScript文件的起始位置，程序段的起始位置，或函数的起始位置进行声明即可。这种声明方式称作
<em>指令序言</em>(directive prologue)。严格模式的范围依赖于其声明的上下文：</p>
<p>可以是全局范围</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFunction</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> testvar = <span class="number">4</span>;</div><div class="line">    <span class="keyword">return</span> testvar;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 语法错误，syntax error.</span></div><div class="line">testvar = <span class="number">5</span>;</div></pre></td></tr></table></figure>
<p>也可以是某个函数范围。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFunction</span>(<span class="params"></span>)</span>&#123;</div><div class="line"><span class="meta">    "use strict"</span>;</div><div class="line">    <span class="comment">// 语法错误，syntax error.</span></div><div class="line">    testvar = <span class="number">4</span>;</div><div class="line">    <span class="keyword">return</span> testvar;</div><div class="line">&#125;</div><div class="line">testvar = <span class="number">5</span>; <span class="comment">// 正确</span></div></pre></td></tr></table></figure>
<p>也可以为某个脚本范围</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 严格模式 --&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="meta"></span></span></span></div><div class="line">  "use strict";</div><div class="line">   testVar = <span class="number">4</span> ;<span class="comment">// 语法错误</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">&lt;!-- 非严格模式 --&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="actionscript"></span></span></div><div class="line">   testVar2 = <span class="number">4</span> ;<span class="comment">// 正确</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>在脚本中直接声明严格模式，在多个脚本文件合并时会出现问题，这种情况发生在一部分脚本声明了严格模式，而另一些是非严格模式。
所以一种变通的做法是将脚本文件的代码包含在一个立即执行函数内，如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line"><span class="meta">  "use strict"</span>;</div><div class="line">  <span class="comment">// code below</span></div><div class="line">&#125;)();</div></pre></td></tr></table></figure>
</blockquote>
<h3 id="限制说明"><a href="#限制说明" class="headerlink" title="限制说明"></a>限制说明</h3><h4 id="保留关键字的限制"><a href="#保留关键字的限制" class="headerlink" title="保留关键字的限制"></a>保留关键字的限制</h4><p>这些关键字：<code>implements</code>, <code>interface</code>, <code>let</code>, <code>package</code>, <code>private</code>, <code>protected</code>, <code>public</code>, <code>static</code>, <code>yield</code>为保留字，不能被当做变量名
或函数名
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="keyword">var</span> implements = <span class="string">'implements'</span> ; <span class="comment">// 错误</span></div></pre></td></tr></table></figure></p>
<h4 id="变量限制"><a href="#变量限制" class="headerlink" title="变量限制"></a>变量限制</h4><p>不能使用未声明的变量
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line">testVar = <span class="number">4</span> ; <span class="comment">// 错误</span></div><div class="line"><span class="keyword">var</span> testVar = <span class="number">4</span>; <span class="comment">// 正确</span></div></pre></td></tr></table></figure></p>
<h4 id="只读属性的限制"><a href="#只读属性的限制" class="headerlink" title="只读属性的限制"></a>只读属性的限制</h4><p>不能为一个只读属性赋值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="keyword">var</span> testObj = <span class="built_in">Object</span>.defineProperties(&#123;&#125;, &#123;</div><div class="line">    <span class="attr">prop1</span>: &#123;</div><div class="line">        <span class="attr">value</span>: <span class="number">10</span>,</div><div class="line">        <span class="attr">writable</span>: <span class="literal">false</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">prop2</span>: &#123;</div><div class="line">        <span class="attr">get</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line">testObj.prop1 = <span class="number">20</span>; <span class="comment">// 错误</span></div><div class="line">testObj.prop2 = <span class="number">30</span>; <span class="comment">// 错误</span></div></pre></td></tr></table></figure>
<h4 id="不可扩展对象的限制"><a href="#不可扩展对象的限制" class="headerlink" title="不可扩展对象的限制"></a>不可扩展对象的限制</h4><p>不能向一个不可扩展的对象(extensible值为false的对象)添加新的属性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="keyword">var</span> testObj = <span class="keyword">new</span> <span class="built_in">Object</span>();</div><div class="line"></div><div class="line"><span class="built_in">Object</span>.preventExtensions(testObj);</div><div class="line"></div><div class="line">testObj.name = <span class="string">"name"</span>; <span class="comment">// 错误</span></div></pre></td></tr></table></figure>
<h4 id="delete操作符的限制"><a href="#delete操作符的限制" class="headerlink" title="delete操作符的限制"></a><code>delete</code>操作符的限制</h4><p>不能删除一个对象，或函数，或参数argument，或一个不可配置(non-configurable)属性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> testObj = &#123;&#125;;</div><div class="line"><span class="keyword">var</span> testFn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> testObj2 = <span class="built_in">Object</span>.defineProperty(&#123;&#125;, <span class="string">"testProp"</span>, &#123;</div><div class="line">    <span class="attr">value</span>: <span class="number">10</span>,</div><div class="line">    <span class="attr">configurable</span>: <span class="literal">false</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">delete</span> testObj ; <span class="comment">// 错误</span></div><div class="line"><span class="keyword">delete</span> testFn ; <span class="comment">// 错误</span></div><div class="line"><span class="keyword">delete</span> testObj2.testProp ; <span class="comment">// 错误</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFn2</span>(<span class="params">x</span>)</span>&#123;</div><div class="line">  <span class="keyword">delete</span> x ;<span class="comment">// 错误</span></div><div class="line">&#125;</div><div class="line">testFn2();</div><div class="line"><span class="string">`</span></div></pre></td></tr></table></figure>
<h4 id="属性复制限制"><a href="#属性复制限制" class="headerlink" title="属性复制限制"></a>属性复制限制</h4><p>不能在同一个对象上定义多个同名属性
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">  <span class="attr">x</span>: <span class="number">10</span>,</div><div class="line">  <span class="attr">x</span>: <span class="number">100</span></div><div class="line">&#125;; <span class="comment">// 语法错误</span></div><div class="line"></div><div class="line"><span class="comment">// 语法错误</span></div><div class="line"><span class="keyword">var</span> foo = &#123;</div><div class="line">  get x() &#123;&#125;,</div><div class="line">  get x() &#123;&#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 语法错误</span></div><div class="line"><span class="keyword">var</span> bar = &#123;</div><div class="line">  set y(value) &#123;&#125;,</div><div class="line">  set y(value) &#123;&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h4 id="函数参数复制限制"><a href="#函数参数复制限制" class="headerlink" title="函数参数复制限制"></a>函数参数复制限制</h4><p>不能在同一个函数内使用多个同名参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFn</span>(<span class="params">x , x</span>)</span>&#123; <span class="comment">// 错误</span></div><div class="line">  <span class="keyword">return</span> ;</div><div class="line">&#125;</div><div class="line">testFn(<span class="number">10</span> , <span class="number">10</span>);</div></pre></td></tr></table></figure>
<h4 id="八进制表示法限制"><a href="#八进制表示法限制" class="headerlink" title="八进制表示法限制"></a>八进制表示法限制</h4><p>禁止将一个八进制数值赋值给数值变量，禁止在八进制数字上使用转义符</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="keyword">var</span> testOctal = <span class="number">010</span>; <span class="comment">// 错误</span></div><div class="line"><span class="keyword">var</span> testOctal2 = \<span class="number">010</span>; <span class="comment">//错误</span></div></pre></td></tr></table></figure>
<h4 id="this值的限制"><a href="#this值的限制" class="headerlink" title="this值的限制"></a>this值的限制</h4><p>this值不再自动强制转换为对象。当this值为null或undefined时不再强制转换为全局对象。
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFn</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>); <span class="comment">// undefined,而不是全局对象</span></div><div class="line">&#125;</div><div class="line">testFn();</div><div class="line">testFn.call(<span class="literal">null</span>); <span class="comment">// null</span></div><div class="line">testFn.apply(<span class="literal">undefined</span>); <span class="comment">// undefined</span></div></pre></td></tr></table></figure></p>
<p>构造函数忘记使用<code>new</code>关键字，this不再指向全局对象，而是直接报错，可以用来避免错误的将类用作函数使用。
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">  <span class="keyword">this</span>.name = name; <span class="comment">// undefined,而不是全局对象</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> p = Person(<span class="string">'nameA'</span>); <span class="comment">// 错误</span></div><div class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> Person(<span class="string">'name2'</span>); <span class="comment">// 正确</span></div></pre></td></tr></table></figure></p>
<h4 id="eval限制"><a href="#eval限制" class="headerlink" title="eval限制"></a>eval限制</h4><p>严格模式下,<code>eval</code>类似于关键字，不能被用来作为标识符，如变量名，函数名，参数名
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="keyword">var</span> <span class="built_in">eval</span> = <span class="string">"test"</span>; <span class="comment">// 错误</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">eval</span>(<span class="params"></span>)</span>&#123; <span class="comment">// 错误</span></div><div class="line">  <span class="comment">// do something</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFn</span>(<span class="params">eval</span>)</span>&#123; <span class="comment">// 错误</span></div><div class="line">  <span class="keyword">return</span> ;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> testObj = &#123;</div><div class="line">  <span class="attr">eval</span>:<span class="string">'prop'</span> <span class="comment">// 错误</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="声明在eval内变量的限制"><a href="#声明在eval内变量的限制" class="headerlink" title="声明在eval内变量的限制"></a>声明在eval内变量的限制</h4><p>在<code>eval</code>内声明的变量和函数只能在<code>eval</code>内部使用，如同创建了一个作用域一样。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"><span class="meta">    "use strict"</span>;</div><div class="line">    <span class="built_in">eval</span>(<span class="string">"var x = 10;"</span>);</div><div class="line">    <span class="comment">// 错误， x未定义</span></div><div class="line">    alert(x);</div><div class="line">&#125;());</div></pre></td></tr></table></figure>
<h4 id="函数定义限制"><a href="#函数定义限制" class="headerlink" title="函数定义限制"></a>函数定义限制</h4><p>函数不能在语句或块中定义，也就是说函数只能在全局作用域或者函数作用域内
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="keyword">if</span>(<span class="literal">true</span>)&#123;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">testFun</span>(<span class="params"></span>)</span>&#123; <span class="comment">// 错误</span></div><div class="line">    <span class="comment">// do something</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> funs = [];</div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; <span class="number">10</span> ; i++)&#123;</div><div class="line">  funs.push(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">// 错误</span></div><div class="line">    <span class="built_in">console</span>.log(i);</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">globalScopeFun</span>(<span class="params"></span>) // 正确</span></div><div class="line">&#123;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">funcScopeFun</span>(<span class="params"></span>) </span>&#123; &#125; <span class="comment">// 正确</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="禁止使用with语句"><a href="#禁止使用with语句" class="headerlink" title="禁止使用with语句"></a>禁止使用with语句</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">x</span>:<span class="number">10</span>&#125;;</div><div class="line"><span class="keyword">var</span> x = <span class="number">17</span>;</div><div class="line"><span class="keyword">with</span> (obj) <span class="comment">// 语法错误</span></div><div class="line">&#123;</div><div class="line">  x;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="arguments的限制"><a href="#arguments的限制" class="headerlink" title="arguments的限制"></a>arguments的限制</h4><p>1.与eval一样，禁止使用arguments作为标识符，如变量名，函数名，函数参数名
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="keyword">var</span> <span class="built_in">arguments</span> = <span class="string">"test"</span>; <span class="comment">// 错误</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">arguments</span>(<span class="params"></span>)</span>&#123; <span class="comment">// 错误</span></div><div class="line">  <span class="comment">// do something</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFn</span>(<span class="params">arguments</span>)</span>&#123; <span class="comment">// 错误</span></div><div class="line">  <span class="keyword">return</span> ;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> testObj = &#123;</div><div class="line">  <span class="attr">arguments</span>:<span class="string">'prop'</span> <span class="comment">// 错误</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2.禁止更改函数内arguments任意成员的值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFn</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="built_in">arguments</span>[<span class="number">0</span>] = <span class="number">20</span> ; <span class="comment">// 错误</span></div><div class="line">&#125;</div><div class="line">testFn(<span class="number">100</span>);</div></pre></td></tr></table></figure>
<p>3.禁止使用<code>arguments.callee</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">recurse</span>(<span class="params">num</span>)</span>&#123;</div><div class="line">  <span class="keyword">if</span>(num == <span class="number">-1</span>)&#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="built_in">arguments</span>.callee(num - <span class="number">1</span>); <span class="comment">// 错误</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://msdn.microsoft.com/zh-cn/library/br230269(v=vs.94).aspx" target="_blank" rel="external">MSDN JavaScript Strict Mode</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode" target="_blank" rel="external">MDN JavaScript Strict mode</a></li>
<li><a href="http://dmitrysoshnikov.com/ecmascript/es5-chapter-2-strict-mode/" target="_blank" rel="external">ECMA-262-5 in detail. Chapter 2. Strict Mode.</a></li>
<li><a href="https://www.nczonline.net/blog/2012/03/13/its-time-to-start-using-javascript-strict-mode/" target="_blank" rel="external">It’s time to start using JavaScript strict mode</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://monjer.github.io/2016/04/27/iOS中Web页面的打开场景及判断/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="monjer">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="monjer's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/27/iOS中Web页面的打开场景及判断/" itemprop="url">iOS中Web页面的打开场景及判断</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-27T16:11:56+08:00">
                2016-04-27
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/04/27/iOS中Web页面的打开场景及判断/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/27/iOS中Web页面的打开场景及判断/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在iOS中打开页面的场景通常包括三种</p>
<ul>
<li>在Safari打开；</li>
<li>在native应用中的WebView打开；</li>
<li>以主屏Web Application，使用standalone模式打开；</li>
</ul>
<p>不同的场景通常某些页面的JavaScript代码的调用逻辑需要进行特殊的处理，所以打开页面后，我们需要在前台准确的判断当前页面所处iOS的容器环境，以下是使用JavaScript代码进行的检测：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> userAgent = <span class="built_in">window</span>.navigator.userAgent.toLowerCase(),</div><div class="line">    standalone = <span class="built_in">window</span>.navigator.standalone,</div><div class="line">    safari = <span class="regexp">/safari/</span>.test( userAgent ) ,</div><div class="line">    isIOS = <span class="regexp">/iphone|ipod|ipad/</span>.test( userAgent ),</div><div class="line">    isSafari =  <span class="literal">false</span> ,</div><div class="line">    isWebView =  <span class="literal">false</span> ,</div><div class="line">    isStandalone = <span class="literal">false</span> ;</div><div class="line"></div><div class="line"><span class="keyword">if</span>(isIOS)&#123;</div><div class="line">  isSafari = safari &amp;&amp; !standalone ;</div><div class="line">  isStandalone = standalone &amp;&amp; !isSafari;</div><div class="line">  isWebView = (!isSafari &amp;&amp; !isStandalone);</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">  <span class="comment">// not iOS</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上代码主要使用正则表达式结合特殊的字符串对UserAgent进行检测，此外iOS下的Safari添加了一个特殊的只读属性<code>window.navigator.standalone</code>来判断一个页面是否在全屏模式下打开。在页面中加入以下meta声明可以触发全屏模式。
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"apple-mobile-web-app-capable"</span> <span class="attr">content</span>=<span class="string">"yes"</span>&gt;</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>使用<a href="https://www.npmjs.com/package/is-webview" target="_blank" rel="external">is-webview</a>也可以完成类似的功能，同时支持在node端判断请求是否来自WebView。</p>
</blockquote>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://developer.apple.com/library/ios/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html" target="_blank" rel="external">Configuring Web Applications</a></li>
<li><a href="http://stackoverflow.com/questions/4460205/detect-ipad-iphone-webview-via-javascript" target="_blank" rel="external">detect ipad/iphone webview via javascript</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="monjer" />
          <p class="site-author-name" itemprop="name">monjer</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">135</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">82</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">monjer</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"monjer"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  
















  





  

  

  

  

  

</body>
</html>
